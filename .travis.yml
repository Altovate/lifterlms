language: php

sudo: false

# blacklist branches
branches:
  except:
    - trunk
    - assets
    - /^release-v.*$/

matrix:
  # allow_failures:
    # - php: hhvm
  include:
    # - php: 7.0
    #   env: WP_VERSION=4.4
    - php: 5.6
      env: WP_VERSION=4.4 PHPLINT=1 PHPCS=1
    # - php: 5.6
    #   env: WP_VERSION=4.3
    # - php: 5.6
    #   env: WP_VERSION=4.2
    # - php: 5.6
    #   env: WP_VERSION=4.1
    # - php: 5.6
    #   env: WP_VERSION=4.0
    # - php: 5.5
    #   env: WP_VERSION=4.4
    # - php: 5.4
    #   env: WP_VERSION=4.4
    # - php: 5.3
    #   env: WP_VERSION=4.4
    # - php: hhvm
    #   env: WP_VERSION=4.4

cache:
  directories:
    - vendor
    - node_modules
    - $HOME/.composer/cache

before_script:
- phpenv local 5.6
- composer selfupdate --no-interaction
- composer install --no-interaction
- phpenv local --unset
- PLUGIN_SLUG=$(basename $(pwd))
# - export WP_DEVELOP_DIR=/tmp/wordpress/
# - git clone --depth=50 --branch="$WP_VERSION" git://develop.git.wordpress.org/ /tmp/wordpress
# - cd ..
# - cp -r "$PLUGIN_SLUG" "/tmp/wordpress/src/wp-content/plugins/$PLUGIN_SLUG"
# - cd /tmp/wordpress/
# - cp wp-tests-config-sample.php wp-tests-config.php
# - sed -i "s/youremptytestdbnamehere/wordpress_tests/" wp-tests-config.php
# - sed -i "s/yourusernamehere/travis/" wp-tests-config.php
# - sed -i "s/yourpasswordhere//" wp-tests-config.php
# - mysql -e "CREATE DATABASE wordpress_tests;" -uroot
# - cd "/tmp/wordpress/src/wp-content/plugins/$PLUGIN_SLUG"
- phpenv rehash

script:
- if [[ "$PHPLINT" == "1" ]]; then find -L . -path ./vendor -prune -o -name '*.php' -print0 | xargs -0 -n 1 -P 4 php -l; fi
- if [[ "$PHPCS" == "1" ]]; then npm install -g gulp && npm install --no-optional && gulp phpcs --warning 0; fi
# - if [[ "$COVERAGE" == "1" ]]; then phpunit -c phpunit.xml --coverage-clover build/logs/clover.xml; else phpunit -c phpunit.xml; fi
# - if [[ "$COVERAGE" == "1" ]]; then vendor/bin/test-reporter; fi

notifications:
  slack:
    rooms:
      secure: XLkE7Vn2H0CgFjid0Y+mTE578SMTnrSb545ls+P1vwkpg4QuzwK0e/yAPuqjZ2/vhVAqm+VbnP+94XHxbfAEamVdPwzKU+Sas5tO0kLt0gOk/L2exbO5ZrNCqxSfNUmb7KKHbl4G7PcXhoAFmrFQxIBDBwT8br21kMn6d4zdUIn6cWDXlOF6xUtdcOAC18T96fbRA5recUEbhTv3TKHTbRAW+08y7IdGmcXu7zvtoIf+22bMsWk59m9i2EW5q3whiDqdXFrlUHhYo9qMkBb0E9dPlLhAxVk6smvX751HRUc09VhJnaYz7fctY7f8LKpjS3dm4T6KqS9ZSi6ekYJfXeJCBfEu1g7xMhuPypvUMUJSp6cddcH+c3fDe1JpNGEhNGqygc9NCP+rO+9iL7LyhmcukkCjPZVKEMmbOxRnmN4K8FEj78Teip6T80E40X6EHId5ygo6W8Ab7RATqlJw21jPyhLbXoNH8yQKso2+CYryroaEEw9d21drJn83USmTb9CYDkPsjTIzg3dJPDOinwC+AhYYSlBZUQQZ+EvAUss/sQ+WBktVG8v4DxGsR6YgRkmwSrZDD3bUCKg0gtkLMJEWLK0o0Z0lxWIYtvv3t3KWKdhMjSOkOG4lJ1aU3W7uc5TtwEWDTtRoD+S/atiO7Q1b7tpH0yLdRbU1pKIohR4=
  email: false
