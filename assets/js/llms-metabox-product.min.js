!function(o){window.llms=window.llms||{},window.llms.metabox_product=function(){this.$plans=null,this.$save=null,this.temp_id=Math.floor(7777*Math.random()+777),this.validation_class="llms-invalid",this.init=function(e){var t=this;t.$plans=o("#llms-access-plans"),t.$save=o("#llms-save-access-plans"),t.bind_visibility();var a=o("#lifterlms-product #llms-product-options-access-plans");if(a.length)if(e)t.bind();else{LLMS.Spinner.start(a);var l,s=0;l=setInterval(function(){if(300<=s)a.html(LLMS.l10n.translate("There was an error loading the necessary resources. Please try again."));else{if("undefined"==typeof tinyMCE)return void s++;t.bind()}clearInterval(l),LLMS.Spinner.stop(a)},100)}},this.bind=function(){var s=this;(setTimeout(function(){s.has_plan_limit_been_reached()&&s.toggle_create_button("disable")},500),0===s.get_current_plan_count()&&s.toggle_save_button("disable"),s.$save.on("click",function(e){e.preventDefault(),s.save_plans()}),s.$plans.on("change","[data-controller-id]",function(){s.controller_change(o(this))}),o("#llms-access-plans .llms-access-plan-datepicker").datepicker({dateFormat:"mm/dd/yy"}),o("#llms-access-plans [data-controller-id]").trigger("change"),o("#llms-new-access-plan").on("click",function(){s.init_plan(),s.toggle_create_button("disable"),s.toggle_save_button("enable"),setTimeout(function(){s.has_plan_limit_been_reached()||s.toggle_create_button("enable")},500)}),s.$plans.sortable({handle:".llms-drag-handle",items:".llms-access-plan",start:function(e,t){s.$plans.addClass("dragging")},stop:function(e,t){s.$plans.removeClass("dragging"),s.update_plan_orders()}}),s.$plans.on("keyup","input.llms-plan-title",function(){var e=o(this),t=e.closest(".llms-access-plan").find("span.llms-plan-title"),a=e.val(),l=a||t.attr("data-default");t.text(l)}),s.$plans.on("focusin","input",function(e,t){o(this).addClass("llms-has-been-focused")}),s.$plans.on("keyup focusout llms-validate-plan-field","input",function(e,t){var a=o(this);a[0].checkValidity()?a.removeClass(s.validation_class):(a.addClass(s.validation_class),"keyup"===e.type&&a[0].reportValidity()),t&&!t.cascade||a.closest(".llms-access-plan").trigger("llms-validate-plan",{original_event:e.type})}),s.$plans.on("llms-validate-plan",".llms-access-plan",function(e,t){t=t||{};var a=o(this),l=t.original_event?"input.llms-has-been-focused":"input";a.find(l).each(function(){o(this).trigger("llms-validate-plan-field",{cascade:!1})}),a.find("."+s.validation_class).length?a.addClass(s.validation_class):a.removeClass(s.validation_class)}),s.$plans.on("llms-collapsible-toggled",".llms-access-plan",function(){var e=o(this);e.hasClass("opened")&&setTimeout(function(){e.find("input.llms-invalid").each(function(){o(this)[0].reportValidity()})},500)}),s.$plans.on("click",".llms-plan-delete",function(e){e.stopPropagation(),s.delete_plan(o(this))}),window.llms.metaboxes.post_select(o("#llms-access-plans .llms-availability-restrictions")),o("#_llms_plans_content_llms-new-access-plan-model").attr("disabled","disabled"),tinyMCE.EditorManager.execCommand("mceRemoveEditor",!0,"_llms_plans_content_llms-new-access-plan-model"),wp.data)||o("form#post").on("submit",function(e){s.get_current_plan_count()&&(e.preventDefault(),s.$save.trigger("click"))})},this.bind_visibility=function(){var t=o("#llms-catalog-visibility-select"),a=o("a.llms-edit-catalog-visibility"),e=o("a.llms-save-catalog-visibility"),l=o("a.llms-cancel-catalog-visibility");a.on("click",function(e){e.preventDefault(),t.slideDown("fast"),a.hide()}),e.on("click",function(e){e.preventDefault(),t.slideUp("fast"),a.show(),o("#llms-catalog-visibility-display").text(o('input[name="_llms_visibility"]:checked').attr("data-label"))}),l.on("click",function(e){e.preventDefault(),t.slideUp("fast"),a.show()})},this.delete_plan=function(e){var t=this,a=e.closest(".llms-access-plan"),l=a.attr("data-id"),s=LLMS.l10n.translate("After deleting this access plan, any students subscribed to this plan will still have access and will continue to make recurring payments according to the access plan's settings. If you wish to terminate their plans you must do so manually. This action cannot be reversed.");l?window.confirm(s)&&(LLMS.Spinner.start(a),window.LLMS.Ajax.call({data:{action:"delete_access_plan",plan_id:l},success:function(e){setTimeout(function(){LLMS.Spinner.stop(a)},550),e.success?(t.remove_plan_el(a),t.trigger_update_hook(),setTimeout(function(){t.update_plan_orders()},500)):e.message&&alert(e.message)}})):t.remove_plan_el(a)},this.controller_change=function(e){var t=e.attr("data-controller-id"),i=e.val(),a=e.closest(".llms-access-plan").find('[data-controller="'+t+'"]');"checkbox"===e.attr("type")&&(i=e.is(":checked")?i:"no"),a.each(function(){var e,t,a=o(this),l="SELECT"===a[0].nodeName||"INPUT"===a[0].nodeName||"TEXTAREA"===a[0].nodeName?a:a.find("input, select, textarea"),s=a.attr("data-value-is"),n=a.attr("data-value-is-not");switch(void 0!==s&&!1!==s?t="==":void 0!==n&&!1!==n&&(t="!="),t){case"==":e=i==s?"show":"hide";break;case"!=":e=i!=n?"show":"hide"}"show"===e?(a.show(),l.removeAttr("disabled").trigger("change")):"hide"===e&&(a.hide(),l.attr("disabled","disabled"))})},this.get_current_plan_count=function(){return this.$plans.find(".llms-access-plan").length},this.get_plans_array=function(){tinyMCE.triggerSave();for(var e=this.$plans.closest("form").serializeArray(),t=[],a=0;a<e.length;a++)if(-1!==e[a].name.indexOf("_llms_plans")){var l=e[a].name.replace("_llms_plans[","").split("]["),s=1*l[0]-1,n=l[1].replace("]",""),i=3===l.length?"array":"single";t[s]||(t[s]={}),"array"===i?(t[s][n]||(t[s][n]=[]),t[s][n].push(e[a].value)):t[s][n]=e[a].value}return t},this.has_plan_limit_been_reached=function(){var e=window.llms.product.access_plan_limit;return this.get_current_plan_count()>=e},this.init_plan=function(){if(!this.has_plan_limit_been_reached()){var e=o("#llms-new-access-plan-model").clone();$existing_plans=o("#llms-access-plans .llms-access-plan"),$editor=e.find("#_llms_plans_content_llms-new-access-plan-model"),e.removeAttr("id"),$editor.removeAttr("id").attr("id","_llms_plans_content_"+this.temp_id),this.temp_id++,e.find("select, input, textarea").each(function(){o(this).removeAttr("disabled")}),e.find(".llms-access-plan-datepicker").datepicker({dateFormat:"mm/dd/yy"}),e.appendTo("#llms-access-plans"),this.update_plan_orders(),e.find(".llms-collapsible-header").trigger("click"),this.has_plan_limit_been_reached()&&this.toggle_create_button("disable"),window.llms.metaboxes.post_select(e.find(".llms-availability-restrictions")),e.find("[data-controller-id]").trigger("change"),o(document).trigger("llms-plan-init",e)}},this.save_plans=function(){var t=this;if(t.$plans.find(".llms-access-plan").each(function(){o(this).trigger("llms-validate-plan")}),t.$plans.find("."+t.validation_class).length)return t.$plans.find(".llms-access-plan."+t.validation_class).not(".opened").first().find(".llms-collapsible-header").trigger("click"),void o(document).trigger("llms-access-plan-validation-errors");LLMS.Spinner.start(t.$plans),t.$save.attr("disabled","disabled"),window.LLMS.Ajax.call({data:{action:"llms_update_access_plans",plans:t.get_plans_array()},complete:function(){LLMS.Spinner.stop(t.$plans),t.$save.removeAttr("disabled")},error:function(e,t,a){console.error("llms access plan save error encounterd:",e),alert(LLMS.l10n.translate("An error was encounterd during the save attempt. Please try again.")+" ["+t+": "+a+"]")},success:function(e){!e.success&&e.code&&"error"===e.code?alert(e.message):e.data&&e.data.html&&(o("#llms-product-options-access-plans").replaceWith(e.data.html),t.init(!0),window.llms.metaboxes.init(),t.update_plan_orders(),t.trigger_update_hook())}})},this.toggle_button=function(e,t){"disable"===t?e.attr("disabled","disabled"):e.removeAttr("disabled")},this.toggle_create_button=function(e){this.toggle_button(o("#llms-new-access-plan"),e)},this.toggle_save_button=function(e){this.toggle_button(this.$save,e)},this.remove_plan_el=function(e){var t=this;e.fadeOut(400),setTimeout(function(){e.remove(),t.has_plan_limit_been_reached()||t.toggle_create_button("enable"),0===t.get_current_plan_count()&&t.toggle_save_button("disable")},450)},this.trigger_update_hook=function(){o(document).trigger("llms-access-plans-updated")},this.update_plan_orders=function(){o("#llms-access-plans .llms-access-plan").each(function(){var e=o(this),t=e.find(".plan-order"),a=e.find('textarea[id^="_llms_plans_content_"]').attr("id"),l=1*t.val(),s=e.index();tinyMCE.EditorManager.execCommand("mceRemoveEditor",!0,a),e.find("select, input, textarea").each(function(){var e=o(this).attr("name");e&&o(this).attr("name",e.replace(l,s))}),tinyMCE.EditorManager.execCommand("mceAddEditor",!0,a),t.val(s)})},this.init()};new window.llms.metabox_product}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxsbXMtbWV0YWJveC1wcm9kdWN0LmpzIl0sIm5hbWVzIjpbIiQiLCJ3aW5kb3ciLCJsbG1zIiwibWV0YWJveF9wcm9kdWN0IiwidGhpcyIsIiRwbGFucyIsIiRzYXZlIiwidGVtcF9pZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInZhbGlkYXRpb25fY2xhc3MiLCJpbml0Iiwic2tpcF9kZXBfY2hlY2tzIiwic2VsZiIsImJpbmRfdmlzaWJpbGl0eSIsIiRtYiIsImxlbmd0aCIsImJpbmQiLCJMTE1TIiwiU3Bpbm5lciIsInN0YXJ0IiwiaW50ZXJ2YWwiLCJjb3VudGVyIiwic2V0SW50ZXJ2YWwiLCJodG1sIiwibDEwbiIsInRyYW5zbGF0ZSIsInRpbnlNQ0UiLCJjbGVhckludGVydmFsIiwic3RvcCIsInNldFRpbWVvdXQiLCJoYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQiLCJ0b2dnbGVfY3JlYXRlX2J1dHRvbiIsImdldF9jdXJyZW50X3BsYW5fY291bnQiLCJ0b2dnbGVfc2F2ZV9idXR0b24iLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInNhdmVfcGxhbnMiLCJjb250cm9sbGVyX2NoYW5nZSIsImRhdGVwaWNrZXIiLCJkYXRlRm9ybWF0IiwidHJpZ2dlciIsImluaXRfcGxhbiIsInNvcnRhYmxlIiwiaGFuZGxlIiwiaXRlbXMiLCJldmVudCIsInVpIiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsInVwZGF0ZV9wbGFuX29yZGVycyIsIiRpbnB1dCIsIiRkaXNwbGF5IiwiY2xvc2VzdCIsImZpbmQiLCJ2YWwiLCJ0aXRsZSIsImF0dHIiLCJ0ZXh0IiwiZGF0YSIsImNoZWNrVmFsaWRpdHkiLCJ0eXBlIiwicmVwb3J0VmFsaWRpdHkiLCJjYXNjYWRlIiwib3JpZ2luYWxfZXZlbnQiLCIkcGxhbiIsInNlbGVjdG9yIiwiZWFjaCIsImhhc0NsYXNzIiwic3RvcFByb3BhZ2F0aW9uIiwiZGVsZXRlX3BsYW4iLCJtZXRhYm94ZXMiLCJwb3N0X3NlbGVjdCIsIkVkaXRvck1hbmFnZXIiLCJleGVjQ29tbWFuZCIsIndwIiwiJHJhZGlvcyIsIiR0b2dnbGUiLCIkY2FuY2VsIiwic2xpZGVEb3duIiwiaGlkZSIsInNsaWRlVXAiLCJzaG93IiwiJGJ0biIsInBsYW5faWQiLCJ3YXJuaW5nIiwiY29uZmlybSIsIkFqYXgiLCJjYWxsIiwiYWN0aW9uIiwic3VjY2VzcyIsInIiLCJyZW1vdmVfcGxhbl9lbCIsInRyaWdnZXJfdXBkYXRlX2hvb2siLCJtZXNzYWdlIiwiYWxlcnQiLCIkZWwiLCJpZCIsIiRjb250cm9scyIsImlzIiwib3BlcmF0b3IiLCIkYyIsIiRlbHMiLCJub2RlTmFtZSIsImVxdWFscyIsIm5vdF9lcXVhbHMiLCJyZW1vdmVBdHRyIiwiZ2V0X3BsYW5zX2FycmF5IiwidHJpZ2dlclNhdmUiLCJmb3JtIiwic2VyaWFsaXplQXJyYXkiLCJwbGFucyIsImkiLCJuYW1lIiwiaW5kZXhPZiIsImtleXMiLCJyZXBsYWNlIiwic3BsaXQiLCJpbmRleCIsInB1c2giLCJ2YWx1ZSIsImxpbWl0IiwicHJvZHVjdCIsImFjY2Vzc19wbGFuX2xpbWl0IiwiJGNsb25lIiwiY2xvbmUiLCIkZXhpc3RpbmdfcGxhbnMiLCIkZWRpdG9yIiwiYXBwZW5kVG8iLCJkb2N1bWVudCIsIm5vdCIsImZpcnN0IiwiY29tcGxldGUiLCJlcnJvciIsImpxWEhSIiwidGV4dFN0YXR1cyIsImVycm9yVGhyb3duIiwiY29uc29sZSIsInJlcyIsImNvZGUiLCJyZXBsYWNlV2l0aCIsInRvZ2dsZV9idXR0b24iLCJzdGF0dXMiLCJmYWRlT3V0IiwicmVtb3ZlIiwiJHAiLCIkb3JkZXIiLCJlZGl0b3JfaWQiLCJvcmlnIiwiY3VyciIsImpRdWVyeSJdLCJtYXBwaW5ncyI6IkNBTUEsU0FBWUEsR0FFWEMsT0FBT0MsS0FBT0QsT0FBT0MsTUFBUSxHQUU3QkQsT0FBT0MsS0FBS0MsZ0JBQWtCLFdBTTdCQyxLQUFLQyxPQUFTLEtBTWRELEtBQUtFLE1BQVEsS0FPYkYsS0FBS0csUUFB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L0IsS0FBSzJGLG9CQUFzQixXQUUxQi9GLEVBQUdtSSxVQUFXeEYsUUFBUyw4QkFheEJ2QyxLQUFLZ0QsbUJBQXFCLFdBRXpCcEQsRUFBRyx3Q0FBeUNxRSxLQUFNLFdBRWpELElBQUk4RSxFQUFLbkosRUFBR0ksTUFDWGdKLEVBQVNELEVBQUczRixLQUFNLGVBRWxCNkYsRUFEVUYsRUFBRzNGLEtBQU0sd0NBQ0NHLEtBQU0sTUFDMUIyRixFQUFzQixFQUFmRixFQUFPM0YsTUFDZDhGLEVBQU9KLEVBQUczQixRQUdYNUYsUUFBUStDLGNBQWNDLFlBQWEsbUJBQW1CLEVBQU15RSxHQUc1REYsRUFBRzNGLEtBQU0sMkJBQTRCYSxLQUFNLFdBRTFDLElBQUk4QyxFQUFPbkgsRUFBR0ksTUFBT3VELEtBQU0sUUFDdEJ3RCxHQUNKbkgsRUFBR0ksTUFBT3VELEtBQU0sT0FBUXdELEVBQUtHLFFBQVNnQyxFQUFNQyxNQU05QzNILFFBQVErQyxjQUFjQyxZQUFhLGdCQUFnQixFQUFNeUUsR0FFekRELEVBQU8zRixJQUFLOEYsTUFPZG5KLEtBQUtRLFFBSUUsSUFBSVgsT0FBT0MsS0FBS0MsZ0JBNXVCekIsQ0E4dUJLcUoiLCJmaWxlIjoibGxtcy1tZXRhYm94LXByb2R1Y3QubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQcm9kdWN0IE9wdGlvbnMgTWV0YUJveFxuICogRGlzcGxheXMgb24gQ291cnNlICYgTWVtYmVyc2hpcCBQb3N0IFR5cGVzXG4gKiBAc2luY2UgICAgMy4wLjBcbiAqIEB2ZXJzaW9uICAzLjI5LjFcbiAqL1xuKCBmdW5jdGlvbiggJCApIHtcblxuXHR3aW5kb3cubGxtcyA9IHdpbmRvdy5sbG1zIHx8IHt9O1xuXG5cdHdpbmRvdy5sbG1zLm1ldGFib3hfcHJvZHVjdCA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0LyoqXG5cdFx0ICogalF1ZXJ5IG9iaiBmb3IgdGhlIG1haW4gJCggJyNsbG1zLWFjY2Vzcy1wbGFucycgKSBlbGVtZW50LlxuXHRcdCAqIEB0eXBlIG9ialxuXHRcdCAqL1xuXHRcdHRoaXMuJHBsYW5zID0gbnVsbDtcblxuXHRcdC8qKlxuXHRcdCAqIGpRdWVyeSBvYmogZm9yIHRoZSBtYWluICQoICcjbGxtcy1zYXZlLWFjY2Vzcy1wbGFucycgKSBzYXZlIGJ1dHRvbiBlbGVtZW50LlxuXHRcdCAqIEB0eXBlIG9ialxuXHRcdCAqL1xuXHRcdHRoaXMuJHNhdmUgPSBudWxsO1xuXG5cdFx0LyoqXG5cdFx0ICogQSByYW5kb21seSBnZW5lcmF0ZWQgdGVtcG9yYXJ5IElEIHVzZWQgZm9yIHRoZSB0aW55TUNFIGVkaXRvcidzIGlkXG5cdFx0ICogd2hlbiBhIG5ldyBwbGFuIGlzIGFkZGVkXG5cdFx0ICogQHR5cGUgaW50XG5cdFx0ICovXG5cdFx0dGhpcy50ZW1wX2lkID0gTWF0aC5mbG9vciggKCBNYXRoLnJhbmRvbSgpICogNzc3NyApICsgNzc3ICk7XG5cblx0XHQvKipcblx0XHQgKiBDU1MgY2xhc3MgbmFtZSB1c2VkIHRvIGhpZ2hsaWdodCB2YWxpZGF0aW9uIGVycm9ycyBmb3IgcGxhbiBmaWVsZHNcblx0XHQgKiBAdHlwZSBzdHJpbmdcblx0XHQgKi9cblx0XHR0aGlzLnZhbGlkYXRpb25fY2xhc3MgPSAnbGxtcy1pbnZhbGlkJztcblxuXHRcdC8qKlxuXHRcdCAqIEluaXRpYWxpemVcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSAgIGJvb2wgc2tpcF9kZXBfY2hlY2tzIGlmIHRydWUsIHNraXBzIGRlcGVuZGVuY3kgY2hlY2tzLlxuXHRcdCAqIEByZXR1cm4gIHZvaWRcblx0XHQgKiBAc2luY2UgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uIDMuMjkuMFxuXHRcdCAqL1xuXHRcdHRoaXMuaW5pdCA9IGZ1bmN0aW9uKCBza2lwX2RlcF9jaGVja3MgKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi4kcGxhbnMgPSAkKCAnI2xsbXMtYWNjZXNzLXBsYW5zJyApO1xuXHRcdFx0c2VsZi4kc2F2ZSA9ICQoICcjbGxtcy1zYXZlLWFjY2Vzcy1wbGFucycgKTtcblxuXHRcdFx0c2VsZi5iaW5kX3Zpc2liaWxpdHkoKTtcblxuXHRcdFx0dmFyICRtYiA9ICQoICcjbGlmdGVybG1zLXByb2R1Y3QgI2xsbXMtcHJvZHVjdC1vcHRpb25zLWFjY2Vzcy1wbGFucycgKTtcblxuXHRcdFx0aWYgKCAhICRtYi5sZW5ndGggKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH0gZWxzZSBpZiAoIHNraXBfZGVwX2NoZWNrcyApIHtcblx0XHRcdFx0c2VsZi5iaW5kKCk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0TExNUy5TcGlubmVyLnN0YXJ0KCAkbWIgKTtcblxuXHRcdFx0Ly8gd2UgcmVseSBvbiBUaW55TUNFIGJ1dCBXb3JkUHJlc3MgZG9lc24ndCByZWdpc3RlciBUaW55TUNFXG5cdFx0XHQvLyBsaWtlIGV2ZXJ5IG90aGVyIGFkbWluIHNjcmlwdCBzbyB3ZSdsbCBkbyBhIGxpdHRsZSBkZXBlbmRlbmN5IGNoZWNrIGhlcmUuLi5cblx0XHRcdHZhciBjb3VudGVyID0gMCxcblx0XHRcdFx0aW50ZXJ2YWw7XG5cblx0XHRcdGludGVydmFsID0gc2V0SW50ZXJ2YWwoIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdC8vIGlmIHdlIGdldCB0byAzMCBzZWNvbmRzIGRpc3BsYXkgYW4gZXJyb3IgbWVzc2FnZVxuXHRcdFx0XHRpZiAoIGNvdW50ZXIgPj0gMzAwICkge1xuXG5cdFx0XHRcdFx0JG1iLmh0bWwoIExMTVMubDEwbi50cmFuc2xhdGUoICdUaGVyZSB3YXMgYW4gZXJyb3IgbG9hZGluZyB0aGUgbmVjZXNzYXJ5IHJlc291cmNlcy4gUGxlYXNlIHRyeSBhZ2Fpbi4nICkgKTtcblxuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIGlmIHdlIGNhbid0IGFjY2VzcyB0aW55TUNFLCBpbmNyZW1lbnQgYW5kIHdhaXQuLi5cblx0XHRcdFx0ZWxzZSBpZiAoICd1bmRlZmluZWQnID09PSB0eXBlb2YgdGlueU1DRSApIHtcblxuXHRcdFx0XHRcdGNvdW50ZXIrKztcblx0XHRcdFx0XHRyZXR1cm47XG5cblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBiaW5kIHRoZSBldmVudHMsIHdlJ3JlIGdvb2QhXG5cdFx0XHRcdGVsc2Uge1xuXG5cdFx0XHRcdFx0c2VsZi5iaW5kKCk7XG5cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNsZWFySW50ZXJ2YWwoIGludGVydmFsICk7XG5cdFx0XHRcdExMTVMuU3Bpbm5lci5zdG9wKCAkbWIgKTtcblxuXHRcdFx0fSwgMTAwICk7XG5cblx0XHR9O1xuXG5cblx0XHQvKipcblx0XHQgKiBCaW5kIERPTSBFdmVudHNcblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqIEBzaW5jZSAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAzLjI5LjBcblx0XHQgKi9cblx0XHR0aGlzLmJpbmQgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKCBzZWxmLmhhc19wbGFuX2xpbWl0X2JlZW5fcmVhY2hlZCgpICkge1xuXHRcdFx0XHRcdHNlbGYudG9nZ2xlX2NyZWF0ZV9idXR0b24oICdkaXNhYmxlJyApO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCA1MDAgKTtcblxuXHRcdFx0aWYgKCAwID09PSBzZWxmLmdldF9jdXJyZW50X3BsYW5fY291bnQoKSApIHtcblx0XHRcdFx0c2VsZi50b2dnbGVfc2F2ZV9idXR0b24oICdkaXNhYmxlJyApO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBzYXZlIGFjY2VzcyBwbGFucyBidXR0b24uXG5cdFx0XHRzZWxmLiRzYXZlLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRzZWxmLnNhdmVfcGxhbnMoKTtcblx0XHRcdH0gKTtcblxuXHRcdFx0Ly8gYmluZCBjaGFuZ2UgZXZlbnRzIHRvIGZvcm0gZWxlbWVudCB0aGF0IGNvbnRyb2xzIGFub3RoZXIgZm9ybSBlbGVtZW50XG5cdFx0XHRzZWxmLiRwbGFucy5vbiggJ2NoYW5nZScsICdbZGF0YS1jb250cm9sbGVyLWlkXScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRzZWxmLmNvbnRyb2xsZXJfY2hhbmdlKCAkKCB0aGlzICkgKTtcblx0XHRcdH0gKVxuXG5cdFx0XHQkKCAnI2xsbXMtYWNjZXNzLXBsYW5zIC5sbG1zLWFjY2Vzcy1wbGFuLWRhdGVwaWNrZXInICkuZGF0ZXBpY2tlcigge1xuXHRcdFx0XHRkYXRlRm9ybWF0OiBcIm1tL2RkL3l5XCJcblx0XHRcdH0gKTtcblxuXHRcdFx0Ly8gdHJpZ2dlciBjaGFuZ2VzIG9uIGxvYWQgZm9yIGFsbCBleGlzdGluZyBwbGFuc1xuXHRcdFx0JCggJyNsbG1zLWFjY2Vzcy1wbGFucyBbZGF0YS1jb250cm9sbGVyLWlkXScgKS50cmlnZ2VyKCAnY2hhbmdlJyApO1xuXG5cdFx0XHQvLyBhZGQgYSBuZXcgZW1wdHkgcGxhbiBpbnRlcmZhY2Ugb24gbmV3IHBsYW4gYnV0dG9uIGNsaWNrLlxuXHRcdFx0JCggJyNsbG1zLW5ldy1hY2Nlc3MtcGxhbicgKS5vbiggJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHNlbGYuaW5pdF9wbGFuKCk7XG5cdFx0XHRcdHNlbGYudG9nZ2xlX2NyZWF0ZV9idXR0b24oICdkaXNhYmxlJyApO1xuXHRcdFx0XHRzZWxmLnRvZ2dsZV9zYXZlX2J1dHRvbiggJ2VuYWJsZScgKTtcblx0XHRcdFx0c2V0VGltZW91dCggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0aWYgKCAhIHNlbGYuaGFzX3BsYW5fbGltaXRfYmVlbl9yZWFjaGVkKCkgKSB7XG5cdFx0XHRcdFx0XHRzZWxmLnRvZ2dsZV9jcmVhdGVfYnV0dG9uKCAnZW5hYmxlJyApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSwgNTAwICk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdHNlbGYuJHBsYW5zLnNvcnRhYmxlKCB7XG5cdFx0XHRcdGhhbmRsZTogJy5sbG1zLWRyYWctaGFuZGxlJyxcblx0XHRcdFx0aXRlbXM6ICcubGxtcy1hY2Nlc3MtcGxhbicsXG5cdFx0XHRcdHN0YXJ0OiBmdW5jdGlvbiggZXZlbnQsIHVpICkge1xuXHRcdFx0XHRcdHNlbGYuJHBsYW5zLmFkZENsYXNzKCAnZHJhZ2dpbmcnICk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHN0b3A6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7XG5cdFx0XHRcdFx0c2VsZi4kcGxhbnMucmVtb3ZlQ2xhc3MoICdkcmFnZ2luZycgKTtcblx0XHRcdFx0XHRzZWxmLnVwZGF0ZV9wbGFuX29yZGVycygpO1xuXHRcdFx0XHR9LFxuXHRcdFx0fSApO1xuXG5cdFx0XHQvLyBiaW5kIHRleHQgZW50ZXJlZCBpbnRvIHRoZSB0aXRsZSB0byB0aGUgZGlzcGxheWVkIHRpdGxlIGZvciBmYW5jeSBmdW5cblx0XHRcdHNlbGYuJHBsYW5zLm9uKCAna2V5dXAnLCAnaW5wdXQubGxtcy1wbGFuLXRpdGxlJywgZnVuY3Rpb24oICkge1xuXG5cdFx0XHRcdHZhciAkaW5wdXQgPSAkKCB0aGlzICksXG5cdFx0XHRcdFx0JHBsYW4gPSAkaW5wdXQuY2xvc2VzdCggJy5sbG1zLWFjY2Vzcy1wbGFuJyApLFxuXHRcdFx0XHRcdCRkaXNwbGF5ID0gJHBsYW4uZmluZCggJ3NwYW4ubGxtcy1wbGFuLXRpdGxlJyApLFxuXHRcdFx0XHRcdHZhbCA9ICRpbnB1dC52YWwoKSxcblx0XHRcdFx0XHR0aXRsZSA9ICggdmFsICkgPyB2YWwgOiAkZGlzcGxheS5hdHRyKCAnZGF0YS1kZWZhdWx0JyApO1xuXG5cdFx0XHRcdCRkaXNwbGF5LnRleHQoIHRpdGxlICk7XG5cblx0XHRcdH0gKTtcblxuXHRcdFx0Ly8gUmVjb3JkIHRoYXQgYSBmaWVsZCBoYXMgYmVlbiBmb2N1c2VkIHNvIHdlIGNhbiB0d2VhayB2YWxpZGF0aW9uIHRvIG9ubHkgdmFsaWRhdGUgXCJlZGl0ZWRcIiBmaWVsZHMuXG5cdFx0XHRzZWxmLiRwbGFucy5vbiggJ2ZvY3VzaW4nLCAnaW5wdXQnLCBmdW5jdGlvbiggZSwgZGF0YSApIHtcblx0XHRcdFx0JCggdGhpcyApLmFkZENsYXNzKCAnbGxtcy1oYXMtYmVlbi1mb2N1c2VkJyApO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQvLyBWYWxpZGF0ZSBhIHNpbmdsZSBpbnB1dCBmaWVsZFxuXHRcdFx0c2VsZi4kcGxhbnMub24oICdrZXl1cCBmb2N1c291dCBsbG1zLXZhbGlkYXRlLXBsYW4tZmllbGQnLCAnaW5wdXQnLCBmdW5jdGlvbiggZSwgZGF0YSApIHtcblxuXHRcdFx0XHR2YXIgJGlucHV0ID0gJCggdGhpcyApO1xuXG5cdFx0XHRcdGlmICggJGlucHV0WzBdLmNoZWNrVmFsaWRpdHkoKSApIHtcblx0XHRcdFx0XHQkaW5wdXQucmVtb3ZlQ2xhc3MoIHNlbGYudmFsaWRhdGlvbl9jbGFzcyApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdCRpbnB1dC5hZGRDbGFzcyggc2VsZi52YWxpZGF0aW9uX2NsYXNzICk7XG5cdFx0XHRcdFx0aWYgKCAna2V5dXAnID09PSBlLnR5cGUgKSB7XG5cdFx0XHRcdFx0XHQkaW5wdXRbMF0ucmVwb3J0VmFsaWRpdHkoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoICEgZGF0YSB8fCBkYXRhLmNhc2NhZGUgKSB7XG5cdFx0XHRcdFx0JGlucHV0LmNsb3Nlc3QoICcubGxtcy1hY2Nlc3MtcGxhbicgKS50cmlnZ2VyKCAnbGxtcy12YWxpZGF0ZS1wbGFuJywgeyBvcmlnaW5hbF9ldmVudDogZS50eXBlIH0gKTtcblx0XHRcdFx0fVxuXG5cblx0XHRcdH0gKTtcblxuXHRcdFx0c2VsZi4kcGxhbnMub24oICdsbG1zLXZhbGlkYXRlLXBsYW4nLCAnLmxsbXMtYWNjZXNzLXBsYW4nLCBmdW5jdGlvbiggZSwgZGF0YSApIHtcblxuXHRcdFx0XHRkYXRhID0gZGF0YSB8fCB7fTtcblxuXHRcdFx0XHR2YXIgJHBsYW4gPSAkKCB0aGlzICksXG5cdFx0XHRcdFx0Ly8gb25seSB2YWxpZGF0ZSBcImVkaXRlZFwiIGZpZWxkcyBkdXJpbmcgY2FzY2FkaW5nIHZhbGlkYXRpb24gZnJvbSBpbnB1dCB2YWxpZGF0aW9ucy5cblx0XHRcdFx0XHRzZWxlY3RvciA9IGRhdGEub3JpZ2luYWxfZXZlbnQgPyAnaW5wdXQubGxtcy1oYXMtYmVlbi1mb2N1c2VkJyA6ICdpbnB1dCc7XG5cblx0XHRcdFx0JHBsYW4uZmluZCggc2VsZWN0b3IgKS5lYWNoKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQkKCB0aGlzICkudHJpZ2dlciggJ2xsbXMtdmFsaWRhdGUtcGxhbi1maWVsZCcsIHsgY2FzY2FkZTogZmFsc2UgfSApO1xuXHRcdFx0XHR9ICk7XG5cblx0XHRcdFx0aWYgKCAkcGxhbi5maW5kKCAnLicgKyBzZWxmLnZhbGlkYXRpb25fY2xhc3MgKS5sZW5ndGggKSB7XG5cdFx0XHRcdFx0JHBsYW4uYWRkQ2xhc3MoIHNlbGYudmFsaWRhdGlvbl9jbGFzcyApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdCRwbGFuLnJlbW92ZUNsYXNzKCBzZWxmLnZhbGlkYXRpb25fY2xhc3MgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9ICk7XG5cblx0XHRcdHNlbGYuJHBsYW5zLm9uKCAnbGxtcy1jb2xsYXBzaWJsZS10b2dnbGVkJywgJy5sbG1zLWFjY2Vzcy1wbGFuJywgZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0dmFyICRwbGFuID0gJCggdGhpcyApO1xuXG5cdFx0XHRcdGlmICggJHBsYW4uaGFzQ2xhc3MoICdvcGVuZWQnICkgKSB7XG5cdFx0XHRcdFx0Ly8gd2FpdCBmb3IgYW5pbWF0aW9uIHRvIGNvbXBsZXRlIHRvIHByZXZlbnQgZm9jdXNhYmxlIGVycm9ycyBpbiB0aGUgY29uc29sZS5cblx0XHRcdFx0XHRzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdCRwbGFuLmZpbmQoICdpbnB1dC5sbG1zLWludmFsaWQnICkuZWFjaCggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdCQoIHRoaXMgKVswXS5yZXBvcnRWYWxpZGl0eSgpO1xuXHRcdFx0XHRcdFx0fSApO1xuXHRcdFx0XHRcdH0sIDUwMCApO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gKTtcblxuXHRcdFx0c2VsZi4kcGxhbnMub24oICdjbGljaycsICcubGxtcy1wbGFuLWRlbGV0ZScsIGZ1bmN0aW9uKCBlICkge1xuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRzZWxmLmRlbGV0ZV9wbGFuKCAkKCB0aGlzICkgKTtcblx0XHRcdH0gKTtcblxuXHRcdFx0Ly8gc2VsZWN0MmlmeSBtZW1iZXJzaGlwIGF2YWlsYWJpbGl0eSBmaWVsZHNcblx0XHRcdHdpbmRvdy5sbG1zLm1ldGFib3hlcy5wb3N0X3NlbGVjdCggJCggJyNsbG1zLWFjY2Vzcy1wbGFucyAubGxtcy1hdmFpbGFiaWxpdHktcmVzdHJpY3Rpb25zJyApICk7XG5cblx0XHRcdC8vIGRpc2FibGUgdGhlIHRleHRhcmVhIGdlbmVyYXRlZCBieSB0aGUgd3BfZWRpdG9yIGZ1bmN0aW9uXG5cdFx0XHQvLyBjYW4ndCBmaWd1cmUgb3V0IGhvdyB0byBkbyB0aGlzIGR1cmluZyBpbml0aWFsaXphdGlvblxuXHRcdFx0JCggJyNfbGxtc19wbGFuc19jb250ZW50X2xsbXMtbmV3LWFjY2Vzcy1wbGFuLW1vZGVsJyApLmF0dHIoICdkaXNhYmxlZCcsICdkaXNhYmxlZCcgKTtcblx0XHRcdHRpbnlNQ0UuRWRpdG9yTWFuYWdlci5leGVjQ29tbWFuZCggJ21jZVJlbW92ZUVkaXRvcicsIHRydWUsICdfbGxtc19wbGFuc19jb250ZW50X2xsbXMtbmV3LWFjY2Vzcy1wbGFuLW1vZGVsJyApO1xuXG5cdFx0XHQvLyBDbGFzc2ljIEVkaXRvclxuXHRcdFx0aWYgKCAhIHdwLmRhdGEgKSB7XG5cblx0XHRcdFx0Ly8gRW5zdXJlIGRhdGEgaXMgc2F2ZWQgd2hlbiB0aGUgQ2xhc3NpYyBFZGl0b3IgcG9zdCBmb3JtIGlzIHN1Ym1pdHRlZC5cblx0XHRcdFx0dmFyIHdwX3Bvc3RfZm9ybSA9ICQoICdmb3JtI3Bvc3QnICk7XG5cdFx0XHRcdHdwX3Bvc3RfZm9ybS5vbiggJ3N1Ym1pdCcsIGZ1bmN0aW9uKCBlICkge1xuXHRcdFx0XHRcdGlmICggc2VsZi5nZXRfY3VycmVudF9wbGFuX2NvdW50KCkgKSB7XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRzZWxmLiRzYXZlLnRyaWdnZXIoICdjbGljaycgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gKTtcblxuXHRcdFx0fVxuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEJpbmQgRE9NIGV2ZW50cyBmb3IgZWRpdGluZyBwcm9kdWN0IHZpc2liaWxpdHlcblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjYuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjYuMFxuXHRcdCAqL1xuXHRcdHRoaXMuYmluZF92aXNpYmlsaXR5ID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciAkcmFkaW9zID0gJCggJyNsbG1zLWNhdGFsb2ctdmlzaWJpbGl0eS1zZWxlY3QnICksXG5cdFx0XHRcdCR0b2dnbGUgPSAkKCAnYS5sbG1zLWVkaXQtY2F0YWxvZy12aXNpYmlsaXR5JyApLFxuXHRcdFx0XHQkc2F2ZSA9ICQoICdhLmxsbXMtc2F2ZS1jYXRhbG9nLXZpc2liaWxpdHknICksXG5cdFx0XHRcdCRjYW5jZWwgPSAgJCggJ2EubGxtcy1jYW5jZWwtY2F0YWxvZy12aXNpYmlsaXR5JyApO1xuXG5cdFx0XHQkdG9nZ2xlLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHQkcmFkaW9zLnNsaWRlRG93biggJ2Zhc3QnICk7XG5cdFx0XHRcdCR0b2dnbGUuaGlkZSgpO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQkc2F2ZS5vbiggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0JHJhZGlvcy5zbGlkZVVwKCAnZmFzdCcgKTtcblx0XHRcdFx0JHRvZ2dsZS5zaG93KCk7XG5cdFx0XHRcdCQoICcjbGxtcy1jYXRhbG9nLXZpc2liaWxpdHktZGlzcGxheScgKS50ZXh0KCAkKCAnaW5wdXRbbmFtZT1cIl9sbG1zX3Zpc2liaWxpdHlcIl06Y2hlY2tlZCcgKS5hdHRyKCAnZGF0YS1sYWJlbCcgKSApO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQkY2FuY2VsLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHQkcmFkaW9zLnNsaWRlVXAoICdmYXN0JyApO1xuXHRcdFx0XHQkdG9nZ2xlLnNob3coKTtcblx0XHRcdH0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBIYW5kbGUgcGh5c2ljYWwgZGVsZXRpb24gb2YgYSBwbGFuIGVsZW1lbnRcblx0XHQgKiBJZiB0aGUgcGxhbiBoYXNuJ3QgYmUgcGVyc2lzdGVkIHRvIHRoZSBkYXRhYnNlIGl0J3MgcmVtb3ZlZCBmcm9tIHRoZSBkb21cblx0XHQgKiBpZiBpdCBhbHJlYWR5IGV4aXN0cyBpbiB0aGUgZGF0YWJhc2UgYSBjb25maXJtIG1vZGFsIGlzIGRpc3BsYXllZFxuXHRcdCAqIHVwb24gY29uZmlybWF0aW9uIEFKQVggY2FsbCB3aWxsIGJlIG1hZGUgdG8gbW92ZSB0aGUgcGxhbiB0byB0aGUgdHJhc2hcblx0XHQgKiBhbmQgdXBvbiBzdWNjZXNzIHRoZSBlbGVtZW50IHdpbGwgYmUgcmVtb3ZlZCBmcm9tIHRoZSBkb21cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSAgb2JqICRidG4galF1ZXJ5IHNlbGVjdG9yIG9mIHRoZSBcIlhcIiBidXR0b24gY2xpY2tlZCB0byBpbml0aWF0ZSBkZWxldGlvblxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqIEBzaW5jZSAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAzLjI5LjFcblx0XHQgKi9cblx0XHR0aGlzLmRlbGV0ZV9wbGFuID0gZnVuY3Rpb24oICRidG4gKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0JHBsYW4gPSAkYnRuLmNsb3Nlc3QoICcubGxtcy1hY2Nlc3MtcGxhbicgKSxcblx0XHRcdFx0cGxhbl9pZCA9ICRwbGFuLmF0dHIoICdkYXRhLWlkJyApLFxuXHRcdFx0XHR3YXJuaW5nID0gTExNUy5sMTBuLnRyYW5zbGF0ZSggJ0FmdGVyIGRlbGV0aW5nIHRoaXMgYWNjZXNzIHBsYW4sIGFueSBzdHVkZW50cyBzdWJzY3JpYmVkIHRvIHRoaXMgcGxhbiB3aWxsIHN0aWxsIGhhdmUgYWNjZXNzIGFuZCB3aWxsIGNvbnRpbnVlIHRvIG1ha2UgcmVjdXJyaW5nIHBheW1lbnRzIGFjY29yZGluZyB0byB0aGUgYWNjZXNzIHBsYW5cXCdzIHNldHRpbmdzLiBJZiB5b3Ugd2lzaCB0byB0ZXJtaW5hdGUgdGhlaXIgcGxhbnMgeW91IG11c3QgZG8gc28gbWFudWFsbHkuIFRoaXMgYWN0aW9uIGNhbm5vdCBiZSByZXZlcnNlZC4nICk7XG5cblx0XHRcdC8vIGlmIHRoZXJlJ3Mgbm8gSUQganVzdCByZW1vdmUgdGhlIGVsZW1lbnQgZnJvbSB0aGUgRE9NXG5cdFx0XHRpZiAoICEgcGxhbl9pZCApIHtcblxuXHRcdFx0XHRzZWxmLnJlbW92ZV9wbGFuX2VsKCAkcGxhbiApO1xuXG5cdFx0XHQvLyBUaHJvdyBhIGNvbmZpcm1hdGlvbiB3YXJuaW5nXG5cdFx0XHR9IGVsc2UgaWYgKCB3aW5kb3cuY29uZmlybSggd2FybmluZyApICkge1xuXG5cdFx0XHRcdExMTVMuU3Bpbm5lci5zdGFydCggJHBsYW4gKTtcblx0XHRcdFx0d2luZG93LkxMTVMuQWpheC5jYWxsKCB7XG5cdFx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdFx0YWN0aW9uOiAnZGVsZXRlX2FjY2Vzc19wbGFuJyxcblx0XHRcdFx0XHRcdHBsYW5faWQ6IHBsYW5faWQsXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbiggciApIHtcblx0XHRcdFx0XHRcdHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0XHRMTE1TLlNwaW5uZXIuc3RvcCggJHBsYW4gKTtcblx0XHRcdFx0XHRcdH0sIDU1MCApO1xuXHRcdFx0XHRcdFx0aWYgKCByLnN1Y2Nlc3MgKSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYucmVtb3ZlX3BsYW5fZWwoICRwbGFuICk7XG5cdFx0XHRcdFx0XHRcdHNlbGYudHJpZ2dlcl91cGRhdGVfaG9vaygpO1xuXHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLnVwZGF0ZV9wbGFuX29yZGVycygpO1xuXHRcdFx0XHRcdFx0XHR9LCA1MDAgKTtcblx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoIHIubWVzc2FnZSApIHtcblx0XHRcdFx0XHRcdFx0YWxlcnQoIHIubWVzc2FnZSApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9ICk7XG5cblx0XHRcdH1cblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBIYW5kbGUgaGlkaW5nICYgc2hvd2luZyB2YXJpb3MgcGllY2VzIG9mIGFuIGFjY2VzcyBwbGFuIGZvcm1cblx0XHQgKiBUaGlzIGlzIGJvdW5kIHRvIGFueSBmb3JtIGVsZW1lbnQgd2l0aCBhIFwiZGF0YS1jb250cm9sbGVyLWlkXCIgcHJvcGVydHlcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSAgb2JqICAkZWwgICBqUXVlcnkgc2VsZWN0b3IgZm9yIHRoZSBjaGFuZ2VkIGZvcm0gZWxlbWVudFxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqIEBzaW5jZSAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmNvbnRyb2xsZXJfY2hhbmdlID0gZnVuY3Rpb24oICRlbCApIHtcblxuXHRcdFx0dmFyIGlkID0gJGVsLmF0dHIoICdkYXRhLWNvbnRyb2xsZXItaWQnICksXG5cdFx0XHRcdHZhbCA9ICRlbC52YWwoKSxcblx0XHRcdFx0JGZvcm0gPSAkZWwuY2xvc2VzdCggJy5sbG1zLWFjY2Vzcy1wbGFuJyApLFxuXHRcdFx0XHQkY29udHJvbHMgPSAkZm9ybS5maW5kKCAnW2RhdGEtY29udHJvbGxlcj1cIicgKyBpZCArICdcIl0nKTtcblxuXHRcdFx0aWYgKCAnY2hlY2tib3gnID09PSAkZWwuYXR0ciggJ3R5cGUnICkgKSAge1xuXHRcdFx0XHR2YWwgPSAoICRlbC5pcyggJzpjaGVja2VkJyApICkgPyB2YWwgOiAnbm8nO1xuXHRcdFx0fVxuXG5cdFx0XHQkY29udHJvbHMuZWFjaCggZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0dmFyICRjID0gJCggdGhpcyApLFxuXHRcdFx0XHRcdCRlbHMgPSAoICdTRUxFQ1QnID09PSAkY1swXS5ub2RlTmFtZSB8fCAnSU5QVVQnICA9PT0gJGNbMF0ubm9kZU5hbWUgfHwgJ1RFWFRBUkVBJyAgPT09ICRjWzBdLm5vZGVOYW1lICkgPyAkYyA6ICRjLmZpbmQoICdpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYScgKSxcblx0XHRcdFx0XHRlcXVhbHMgPSAkYy5hdHRyKCAnZGF0YS12YWx1ZS1pcycgKSxcblx0XHRcdFx0XHRub3RfZXF1YWxzID0gJGMuYXR0ciggJ2RhdGEtdmFsdWUtaXMtbm90JyApLFxuXHRcdFx0XHRcdGFjdGlvbiwgb3BlcmF0b3I7XG5cblx0XHRcdFx0aWYgKCB0eXBlb2YgZXF1YWxzICE9PSB0eXBlb2YgdW5kZWZpbmVkICYmIGVxdWFscyAhPT0gZmFsc2UgKSB7XG5cblx0XHRcdFx0XHRvcGVyYXRvciA9ICc9PSc7XG5cblx0XHRcdFx0fSBlbHNlIGlmICggdHlwZW9mIG5vdF9lcXVhbHMgIT09IHR5cGVvZiB1bmRlZmluZWQgJiYgbm90X2VxdWFscyAhPT0gZmFsc2UgKSB7XG5cblx0XHRcdFx0XHRvcGVyYXRvciA9ICchPSc7XG5cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHN3aXRjaCAoIG9wZXJhdG9yICkge1xuXG5cdFx0XHRcdFx0Y2FzZSAnPT0nOlxuXG5cdFx0XHRcdFx0XHRpZiAoIHZhbCA9PSBlcXVhbHMgKSB7XG5cdFx0XHRcdFx0XHRcdGFjdGlvbiA9ICdzaG93Jztcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGFjdGlvbiA9ICdoaWRlJztcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdFx0Y2FzZSAnIT0nOlxuXG5cdFx0XHRcdFx0XHRpZiAoIHZhbCAhPSBub3RfZXF1YWxzICkge1xuXHRcdFx0XHRcdFx0XHRhY3Rpb24gPSAnc2hvdyc7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRhY3Rpb24gPSAnaGlkZSc7XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCAnc2hvdycgPT09IGFjdGlvbiApIHtcblx0XHRcdFx0XHQkYy5zaG93KCk7XG5cdFx0XHRcdFx0JGVscy5yZW1vdmVBdHRyKCAnZGlzYWJsZWQnICkudHJpZ2dlciggJ2NoYW5nZScgKTtcblx0XHRcdFx0fSBlbHNlIGlmICggJ2hpZGUnID09PSBhY3Rpb24gKSB7XG5cdFx0XHRcdFx0JGMuaGlkZSgpO1xuXHRcdFx0XHRcdCRlbHMuYXR0ciggJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyApO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXRyaWV2ZSB0aGUgY3VycmVudCBudW1iZXIgb2YgYWNjZXNzIHBsYW5zIGZvciB0aGUgY291cnNlIC8gbWVtYmVyc2hpcCAoc2F2ZWQgb3IgdW5zYXZlZClcblx0XHQgKiBAcmV0dXJuICBpbnRcblx0XHQgKiBAc2luY2UgICAzLjI5LjBcblx0XHQgKiBAdmVyc2lvbiAzLjI5LjBcblx0XHQgKi9cblx0XHR0aGlzLmdldF9jdXJyZW50X3BsYW5fY291bnQgPSBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRwbGFucy5maW5kKCAnLmxsbXMtYWNjZXNzLXBsYW4nICkubGVuZ3RoO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFJldHJpZXZlIGFjY2VzcyBwbGFuIGRhdGEgYXMgYW4gYXJyYXkgb2YgSlNPTiBidWlsdCBmcm9tIHRoZSBkb20gZWxlbWVudCBmaWVsZCB2YWx1ZXMuXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuICBhcnJheVxuXHRcdCAqIEBzaW5jZSAgIDMuMjkuMFxuXHRcdCAqIEB2ZXJzaW9uIDMuMjkuMFxuXHRcdCAqL1xuXHRcdHRoaXMuZ2V0X3BsYW5zX2FycmF5ID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdC8vIGVuc3VyZSBhbGwgY29udGVudCBlZGl0b3JzIGFyZSBzYXZlZCBwcm9wZXJseS5cblx0XHRcdHRpbnlNQ0UudHJpZ2dlclNhdmUoKTtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRmb3JtID0gc2VsZi4kcGxhbnMuY2xvc2VzdCggJ2Zvcm0nICkuc2VyaWFsaXplQXJyYXkoKSxcblx0XHRcdFx0cGxhbnMgPSBbXTtcblxuXHRcdFx0Zm9yICggdmFyIGkgPSAwOyBpIDwgZm9ybS5sZW5ndGg7IGkrKyApIHtcblxuXHRcdFx0XHQvLyBTa2lwIG5vbiBwbGFuIGRhdGEgZnJvbSB0aGUgZm9ybS5cblx0XHRcdFx0aWYgKCAtMSA9PT0gZm9ybVsgaSBdLm5hbWUuaW5kZXhPZiggJ19sbG1zX3BsYW5zJyApICkge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dmFyIGtleXMgPSBmb3JtWyBpIF0ubmFtZS5yZXBsYWNlKCAnX2xsbXNfcGxhbnNbJywgJycgKS5zcGxpdCggJ11bJyApLFxuXHRcdFx0XHRcdGluZGV4ID0gKCBrZXlzWzBdICogMSApIC0gMSxcblx0XHRcdFx0XHRuYW1lID0ga2V5c1sxXS5yZXBsYWNlKCAnXScsICcnICksXG5cdFx0XHRcdFx0dHlwZSA9IDMgPT09IGtleXMubGVuZ3RoID8gJ2FycmF5JyA6ICdzaW5nbGUnO1xuXG5cdFx0XHRcdGlmICggISBwbGFuc1sgaW5kZXggXSApIHtcblx0XHRcdFx0XHRwbGFuc1sgaW5kZXggXSA9IHt9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCAnYXJyYXknID09PSB0eXBlICkge1xuXG5cdFx0XHRcdFx0aWYgKCAhIHBsYW5zWyBpbmRleCBdWyBuYW1lIF0gKSB7XG5cdFx0XHRcdFx0XHRwbGFuc1sgaW5kZXggXVsgbmFtZSBdID0gW107XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHBsYW5zWyBpbmRleCBdWyBuYW1lIF0ucHVzaCggZm9ybVsgaSBdLnZhbHVlICk7XG5cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHBsYW5zWyBpbmRleCBdWyBuYW1lIF0gPSBmb3JtWyBpIF0udmFsdWU7XG5cblx0XHRcdFx0fVxuXG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBwbGFucztcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBEZXRlcm1pbmUgaWYgdGhlIGFjY2VzcyBwbGFuIGxpbWl0IGhhcyBiZWVuIHJlYWNoZWRcblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gQm9vbGVhblxuXHRcdCAqIEBzaW5jZSAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4yOS4wXG5cdFx0ICovXG5cdFx0dGhpcy5oYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIGxpbWl0ID0gd2luZG93LmxsbXMucHJvZHVjdC5hY2Nlc3NfcGxhbl9saW1pdDtcblx0XHRcdHJldHVybiB0aGlzLmdldF9jdXJyZW50X3BsYW5fY291bnQoKSA+PSBsaW1pdDtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBJbml0YWxpemVzIGEgbmV3IHBsYW4gYW5kIGFkZHMgaXQgdG8gdGhlIGxpc3Qgb2YgcGxhbnMgaW4gdGhlIERPTVxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMjMuMFxuXHRcdCAqL1xuXHRcdHRoaXMuaW5pdF9wbGFuID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdC8vIGRvbid0IGRvIGFueXRoaW5nIGlmIHdlJ3ZlIHJlYWNoZWQgdGhlIHBsYW4gbGltaXRcblx0XHRcdGlmICggdGhpcy5oYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQoKSApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgJGNsb25lID0gJCggJyNsbG1zLW5ldy1hY2Nlc3MtcGxhbi1tb2RlbCcgKS5jbG9uZSgpXG5cdFx0XHRcdCRleGlzdGluZ19wbGFucyA9ICQoICcjbGxtcy1hY2Nlc3MtcGxhbnMgLmxsbXMtYWNjZXNzLXBsYW4nICksXG5cdFx0XHRcdCRlZGl0b3IgPSAkY2xvbmUuZmluZCggJyNfbGxtc19wbGFuc19jb250ZW50X2xsbXMtbmV3LWFjY2Vzcy1wbGFuLW1vZGVsJyApO1xuXG5cdFx0XHQvLyByZW1vdmUgSUQgZnJvbSB0aGUgaXRlbVxuXHRcdFx0JGNsb25lLnJlbW92ZUF0dHIoICdpZCcgKTtcblxuXHRcdFx0Ly8gZ2l2ZSBhIHRlbXBvcmFyeSBpZCB0byB0aGUgZWRpdG9yIGVsZW1lbnRcblx0XHRcdCRlZGl0b3IucmVtb3ZlQXR0ciggJ2lkJyApLmF0dHIoICdpZCcsICdfbGxtc19wbGFuc19jb250ZW50XycgKyB0aGlzLnRlbXBfaWQgKTtcblx0XHRcdHRoaXMudGVtcF9pZCsrOyAvLyBpbmNyZW1lbnQgdGhlIHRlbXBfaWQgSUQgc28gd2UgZG9uJ3QgdXNlIGl0IGFnYWluXG5cblxuXHRcdFx0Ly8gYWN0aXZhdGUgYWxsIGVsZW1lbnRzXG5cdFx0XHQkY2xvbmUuZmluZCggJ3NlbGVjdCwgaW5wdXQsIHRleHRhcmVhJyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKCB0aGlzICkucmVtb3ZlQXR0ciggJ2Rpc2FibGVkJyApOyAvLyBlbmFibGVkIHRoZSBmaWVsZFxuXHRcdFx0fSApO1xuXG5cblx0XHRcdCRjbG9uZS5maW5kKCAnLmxsbXMtYWNjZXNzLXBsYW4tZGF0ZXBpY2tlcicgKS5kYXRlcGlja2VyKCB7XG5cdFx0XHRcdGRhdGVGb3JtYXQ6IFwibW0vZGQveXlcIlxuXHRcdFx0fSApO1xuXG5cdFx0XHQkY2xvbmUuYXBwZW5kVG8oICcjbGxtcy1hY2Nlc3MtcGxhbnMnICk7XG5cblx0XHRcdC8vIHJld3JpdGUgdGhlIG9yZGVyIG9mIGFsbCBlbGVtZW50c1xuXHRcdFx0dGhpcy51cGRhdGVfcGxhbl9vcmRlcnMoKTtcblxuXHRcdFx0JGNsb25lLmZpbmQoICcubGxtcy1jb2xsYXBzaWJsZS1oZWFkZXInICkudHJpZ2dlciggJ2NsaWNrJyApO1xuXG5cdFx0XHQvLyBjaGVjayBpZiB0aGUgbGltaXQgaGFzIGJlZW4gcmVhY2hlZCBhbmQgdG9nZ2xlIHRoZSBidXR0b24gaWYgaXQgaGFzXG5cdFx0XHRpZiAoIHRoaXMuaGFzX3BsYW5fbGltaXRfYmVlbl9yZWFjaGVkKCkgKSB7XG5cdFx0XHRcdHRoaXMudG9nZ2xlX2NyZWF0ZV9idXR0b24oICdkaXNhYmxlJyApO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBzZWxlY3QyaWZ5IG1lbWJlcnNoaXAgYXZhaWxhYmlsaXR5IGZpZWxkXG5cdFx0XHR3aW5kb3cubGxtcy5tZXRhYm94ZXMucG9zdF9zZWxlY3QoICRjbG9uZS5maW5kKCAnLmxsbXMtYXZhaWxhYmlsaXR5LXJlc3RyaWN0aW9ucycgKSApO1xuXG5cdFx0XHQkY2xvbmUuZmluZCggJ1tkYXRhLWNvbnRyb2xsZXItaWRdJyApLnRyaWdnZXIoICdjaGFuZ2UnICk7XG5cdFx0XHQkKCBkb2N1bWVudCApLnRyaWdnZXIoICdsbG1zLXBsYW4taW5pdCcsICRjbG9uZSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFBlcnNpc3QgYWNjZXNzIHBsYW5zIHRvIHRoZSBEQiBpZiB0aGV5IHBhc3MgdmFsaWRhdGlvblxuXHRcdCAqXG5cdFx0ICogQHJldHVybiAge1t0eXBlXX1cblx0XHQgKiBAc2luY2UgICAzLjI5LjBcblx0XHQgKiBAdmVyc2lvbiAzLjI5LjBcblx0XHQgKi9cblx0XHR0aGlzLnNhdmVfcGxhbnMgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHRzZWxmLiRwbGFucy5maW5kKCAnLmxsbXMtYWNjZXNzLXBsYW4nICkuZWFjaCggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdCQoIHRoaXMgKS50cmlnZ2VyKCAnbGxtcy12YWxpZGF0ZS1wbGFuJyApO1xuXHRcdFx0fSApO1xuXG5cdFx0XHRpZiAoIHNlbGYuJHBsYW5zLmZpbmQoICcuJyArIHNlbGYudmFsaWRhdGlvbl9jbGFzcyApLmxlbmd0aCApIHtcblx0XHRcdFx0c2VsZi4kcGxhbnMuZmluZCggJy5sbG1zLWFjY2Vzcy1wbGFuLicgKyBzZWxmLnZhbGlkYXRpb25fY2xhc3MgKS5ub3QoICcub3BlbmVkJyApLmZpcnN0KCkuZmluZCggJy5sbG1zLWNvbGxhcHNpYmxlLWhlYWRlcicgKS50cmlnZ2VyKCAnY2xpY2snICk7XG5cdFx0XHRcdCQoIGRvY3VtZW50ICkudHJpZ2dlciggJ2xsbXMtYWNjZXNzLXBsYW4tdmFsaWRhdGlvbi1lcnJvcnMnICk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0TExNUy5TcGlubmVyLnN0YXJ0KCBzZWxmLiRwbGFucyApO1xuXHRcdFx0c2VsZi4kc2F2ZS5hdHRyKCAnZGlzYWJsZWQnLCAnZGlzYWJsZWQnICk7XG5cdFx0XHR3aW5kb3cuTExNUy5BamF4LmNhbGwoIHtcblx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdGFjdGlvbjogJ2xsbXNfdXBkYXRlX2FjY2Vzc19wbGFucycsXG5cdFx0XHRcdFx0cGxhbnM6IHNlbGYuZ2V0X3BsYW5zX2FycmF5KCksXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGNvbXBsZXRlOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRMTE1TLlNwaW5uZXIuc3RvcCggc2VsZi4kcGxhbnMgKTtcblx0XHRcdFx0XHRzZWxmLiRzYXZlLnJlbW92ZUF0dHIoICdkaXNhYmxlZCcgKTtcblx0XHRcdFx0fSxcblx0XHRcdFx0ZXJyb3I6IGZ1bmN0aW9uKCBqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24gKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5lcnJvciggJ2xsbXMgYWNjZXNzIHBsYW4gc2F2ZSBlcnJvciBlbmNvdW50ZXJkOicsIGpxWEhSICk7XG5cdFx0XHRcdFx0YWxlcnQoIExMTVMubDEwbi50cmFuc2xhdGUoICdBbiBlcnJvciB3YXMgZW5jb3VudGVyZCBkdXJpbmcgdGhlIHNhdmUgYXR0ZW1wdC4gUGxlYXNlIHRyeSBhZ2Fpbi4nICkgKyAnIFsnICArIHRleHRTdGF0dXMgKyAnOiAnICsgZXJyb3JUaHJvd24gKyAnXScgKTtcblx0XHRcdFx0fSxcblx0XHRcdFx0c3VjY2VzczogZnVuY3Rpb24oIHJlcyApIHtcblxuXHRcdFx0XHRcdGlmICggISByZXMuc3VjY2VzcyAmJiByZXMuY29kZSAmJiAnZXJyb3InID09PSByZXMuY29kZSApIHtcblx0XHRcdFx0XHRcdGFsZXJ0KCByZXMubWVzc2FnZSApO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoIHJlcy5kYXRhICYmIHJlcy5kYXRhLmh0bWwgKSB7XG5cblx0XHRcdFx0XHRcdC8vIHJlcGxhY2UgdGhlIG1ldGFib3ggd2l0aCB1cGRhdGVkIGRhdGEgZnJvbSB0aGUgc2VydmVyLlxuXHRcdFx0XHRcdFx0JCggJyNsbG1zLXByb2R1Y3Qtb3B0aW9ucy1hY2Nlc3MtcGxhbnMnICkucmVwbGFjZVdpdGgoIHJlcy5kYXRhLmh0bWwgKTtcblxuXHRcdFx0XHRcdFx0Ly8gcmVpbml0LlxuXHRcdFx0XHRcdFx0c2VsZi5pbml0KCB0cnVlICk7XG5cdFx0XHRcdFx0XHR3aW5kb3cubGxtcy5tZXRhYm94ZXMuaW5pdCgpO1xuXHRcdFx0XHRcdFx0c2VsZi51cGRhdGVfcGxhbl9vcmRlcnMoKTtcblxuXHRcdFx0XHRcdFx0Ly8gbm90aWZ5IHRoZSBibG9jayBlZGl0b3Jcblx0XHRcdFx0XHRcdHNlbGYudHJpZ2dlcl91cGRhdGVfaG9vaygpO1xuXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0sXG5cblx0XHRcdH0gKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogVG9nZ2xlIHRoZSBzdGF0dXMgb2YgYSBidXR0b25cblx0XHQgKiBAcGFyYW0gICBPYmplY3QgICRidG4gICBqUXVlcnkgc2VsZWN0b3Igb2YgYSBidXR0b24gZWxlbWVudFxuXHRcdCAqIEBwYXJhbSAgc3RyaW5nIHN0YXR1cyBlbmFibGUgb3IgZGlzYWJsZVxuXHRcdCAqIEByZXR1cm4gIHZvaWRcblx0XHQgKiBAc2luY2UgICAzLjI5LjBcblx0XHQgKiBAdmVyc2lvbiAzLjI5LjBcblx0XHQgKi9cblx0XHR0aGlzLnRvZ2dsZV9idXR0b24gPSBmdW5jdGlvbiggJGJ0biwgc3RhdHVzICkge1xuXG5cdFx0XHRpZiAoICdkaXNhYmxlJyA9PT0gc3RhdHVzICkge1xuXHRcdFx0XHQkYnRuLmF0dHIoICdkaXNhYmxlZCcsICdkaXNhYmxlZCcgKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCRidG4ucmVtb3ZlQXR0ciggJ2Rpc2FibGVkJyApO1xuXHRcdFx0fVxuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENvbnRyb2wgdGhlIHN0YXR1cyBvZiB0aGUgXCJOZXcgQWNjZXNzIFBsYW5cIiBCdXR0b25cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSAgc3RyaW5nIHN0YXR1cyBlbmFibGUgb3IgZGlzYWJsZVxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqIEBzaW5jZSAgMy4wLjBcblx0XHQgKiBAc2luY2UgIDMuMjkuMFxuXHRcdCAqL1xuXHRcdHRoaXMudG9nZ2xlX2NyZWF0ZV9idXR0b24gPSBmdW5jdGlvbiggc3RhdHVzICkge1xuXHRcdFx0dGhpcy50b2dnbGVfYnV0dG9uKCAkKCAnI2xsbXMtbmV3LWFjY2Vzcy1wbGFuJyApLCBzdGF0dXMgKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQ29udHJvbCB0aGUgc3RhdHVzIG9mIHRoZSBcIlNhdmUgQWNjZXNzIFBsYW5zXCIgQnV0dG9uXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gIHN0cmluZyBzdGF0dXMgZW5hYmxlIG9yIGRpc2FibGVcblx0XHQgKiBAcmV0dXJuIHZvaWRcblx0XHQgKiBAc2luY2UgIDMuMC4wXG5cdFx0ICogQHNpbmNlICAzLjI5LjBcblx0XHQgKi9cblx0XHR0aGlzLnRvZ2dsZV9zYXZlX2J1dHRvbiA9IGZ1bmN0aW9uKCBzdGF0dXMgKSB7XG5cdFx0XHR0aGlzLnRvZ2dsZV9idXR0b24oIHRoaXMuJHNhdmUsIHN0YXR1cyApO1xuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIFZpc3VhbGx5IGhpZGUgYW5kIHRoZW4gcGh5c2ljYWxseSByZW1vdmUgYSBwbGFuIGVsZW1lbnQgZnJvbSB0aGUgRE9NXG5cdFx0ICogQWRkaXRpb25hbGx5IGRldGVybWluZXMgaWYgdGhlIE5ldyBQbGFuIEJ1dHRvbiBzaG91bGQgYmUgcmUtZW5hYmxlZFxuXHRcdCAqIGFmdGVyIGRlbGV0aW9uXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gIG9iaiAgICRwbGFuIGpRdWVyeSBzZWxlY3RvciBvZiB0aGUgcGxhbiBlbGVtZW50XG5cdFx0ICogQHJldHVybiB2b2lkXG5cdFx0ICogQHNpbmNlIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gMy4yOS4wXG5cdFx0ICovXG5cdFx0dGhpcy5yZW1vdmVfcGxhbl9lbCA9IGZ1bmN0aW9uKCAkcGxhbiApIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHQvLyBmYWRlIG91dCBuaWNlbHlcblx0XHRcdCRwbGFuLmZhZGVPdXQoIDQwMCApO1xuXG5cdFx0XHQvLyByZW1vdmUgZnJvbSBkb20gYWZ0ZXIgaXQncyBoaWRkZW4gdmlzdWFsbHlcblx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0JHBsYW4ucmVtb3ZlKCk7XG5cblx0XHRcdFx0Ly8gY2hlY2sgaWYgd2UgbmVlZCB0byByZWVuYWJsZSB0aGUgY3JlYXRlIGJ1dHRvbiBhbmQgaGlkZSB0aGUgbWVzc2FnZVxuXHRcdFx0XHRpZiAoICEgc2VsZi5oYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQoKSApIHtcblx0XHRcdFx0XHRzZWxmLnRvZ2dsZV9jcmVhdGVfYnV0dG9uKCAnZW5hYmxlJyApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCAwID09PSBzZWxmLmdldF9jdXJyZW50X3BsYW5fY291bnQoKSApIHtcblx0XHRcdFx0XHRzZWxmLnRvZ2dsZV9zYXZlX2J1dHRvbiggJ2Rpc2FibGUnICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSwgNDUwICk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogVHJpZ2dlciBXUCBCbG9jayBFZGl0b3IgaG9vayBzbyB0aGUgcHJpY2luZyB0YWJsZSBibG9jayBjYW4gYmUgcmUtcmVuZGVyZWQgd2l0aCBuZXcgcGxhbiBpbmZvcm1hdGlvbi5cblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gIHZvaWRcblx0XHQgKiBAc2luY2UgICAzLjI5LjBcblx0XHQgKiBAdmVyc2lvbiAzLjI5LjBcblx0XHQgKi9cblx0XHR0aGlzLnRyaWdnZXJfdXBkYXRlX2hvb2sgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0JCggZG9jdW1lbnQgKS50cmlnZ2VyKCAnbGxtcy1hY2Nlc3MtcGxhbnMtdXBkYXRlZCcgKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZW9yZGVyIHRoZSBhcnJheSBpbmRleGVzIGFuZCB0aGUgbWVudSBvcmRlciBoaWRkZW4gaW5wdXRzXG5cdFx0ICogQ2FsbGVkIGJ5IGpRdWVyeSBVSSBTb3J0YWJsZSBvbiBzb3J0IGNvbXBsZXRpb25cblx0XHQgKiBBbHNvIGNhbGxlZCBhZnRlciBhZGRpbmcgYSBuZXcgcGxhbiB0byB0aGUgRE9NIHNvIHRoZSBuZXdlc3QgaXRlbSBpcyBhbHdheXNcblx0XHQgKiBwZXJzaXN0ZWQgYXMgdGhlIGxhc3QgaW4gdGhlIGRhdGFiYXNlIGlmIG5vIFVYIHJlb3JkZXJzIHRoZSBpdGVtXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuIHZvaWRcblx0XHQgKiBAc2luY2UgIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy51cGRhdGVfcGxhbl9vcmRlcnMgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0JCggJyNsbG1zLWFjY2Vzcy1wbGFucyAubGxtcy1hY2Nlc3MtcGxhbicgKS5lYWNoKCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHR2YXIgJHAgPSAkKCB0aGlzICksXG5cdFx0XHRcdFx0JG9yZGVyID0gJHAuZmluZCggJy5wbGFuLW9yZGVyJyApLFxuXHRcdFx0XHRcdCRlZGl0b3IgPSAkcC5maW5kKCAndGV4dGFyZWFbaWRePVwiX2xsbXNfcGxhbnNfY29udGVudF9cIl0nICksXG5cdFx0XHRcdFx0ZWRpdG9yX2lkID0gJGVkaXRvci5hdHRyKCAnaWQnICksXG5cdFx0XHRcdFx0b3JpZyA9ICRvcmRlci52YWwoKSAqIDEsXG5cdFx0XHRcdFx0Y3VyciA9ICRwLmluZGV4KCk7XG5cblx0XHRcdFx0Ly8gZGUtaW5pdCB0aW55TUNFIGZyb20gdGhlIGVkaXRvclxuXHRcdFx0XHR0aW55TUNFLkVkaXRvck1hbmFnZXIuZXhlY0NvbW1hbmQoICdtY2VSZW1vdmVFZGl0b3InLCB0cnVlLCBlZGl0b3JfaWQgKTtcblxuXHRcdFx0XHQvLyB1cGRhdGUgdGhlIG9yZGVyIG9mIGVhY2ggZmllbGQgaW4gdGhlIHBsYW5cblx0XHRcdFx0JHAuZmluZCggJ3NlbGVjdCwgaW5wdXQsIHRleHRhcmVhJyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdFx0dmFyIG5hbWUgPSAkKCB0aGlzICkuYXR0ciggJ25hbWUnICk7XG5cdFx0XHRcdFx0aWYgKCBuYW1lICkge1xuXHRcdFx0XHRcdFx0JCggdGhpcyApLmF0dHIoICduYW1lJywgbmFtZS5yZXBsYWNlKCBvcmlnLCBjdXJyICkgKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdC8vIHJlLWluaXQgdGlueU1DRSBvbiB0aGUgZWRpdG9yXG5cdFx0XHRcdHRpbnlNQ0UuRWRpdG9yTWFuYWdlci5leGVjQ29tbWFuZCggJ21jZUFkZEVkaXRvcicsIHRydWUsIGVkaXRvcl9pZCApO1xuXG5cdFx0XHRcdCRvcmRlci52YWwoIGN1cnIgKTtcblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8vIGdvXG5cdFx0dGhpcy5pbml0KCk7XG5cblx0fTtcblxuXHR2YXIgYSA9IG5ldyB3aW5kb3cubGxtcy5tZXRhYm94X3Byb2R1Y3QoKTtcblxufSApKCBqUXVlcnkgKTtcbiJdfQ==
