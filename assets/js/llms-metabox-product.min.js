!function(c){window.llms=window.llms||{},window.llms.metabox_product=function(){this.$plans=null,this.temp_id=Math.floor(7777*Math.random()+777),this.validation_class="llms-invalid",this.init=function(a){var e=this;e.$plans=c("#llms-access-plans"),e.bind_visibility();var l=c("#lifterlms-product #llms-product-options-access-plans");if(l.length)if(a)e.bind();else{LLMS.Spinner.start(l);var t,s=0;t=setInterval(function(){if(300<=s)l.html(LLMS.l10n.translate("There was an error loading the necessary resources. Please try again."));else{if("undefined"==typeof tinyMCE)return void s++;e.bind()}clearInterval(t),LLMS.Spinner.stop(l)},100)}},this.bind=function(){var t=this;t.has_plan_limit_been_reached()&&t.toggle_create_button(),c("#llms-save-access-plans").on("click",function(a){a.preventDefault(),t.save_plans()}),t.$plans.on("change","[data-controller-id]",function(){t.controller_change(c(this))}),c("#llms-access-plans .llms-access-plan-datepicker").datepicker({dateFormat:"mm/dd/yy"}),c("#llms-access-plans [data-controller-id]").trigger("change"),c("#llms-new-access-plan").on("click",function(){var a=c(this);t.init_plan(),a.attr("disabled","disabled"),setTimeout(function(){t.has_plan_limit_been_reached()||a.removeAttr("disabled")},500)}),t.$plans.sortable({handle:".llms-drag-handle",items:".llms-access-plan",start:function(a,e){t.$plans.addClass("dragging")},stop:function(a,e){t.$plans.removeClass("dragging"),t.update_plan_orders()}}),t.$plans.on("keyup","input.llms-plan-title",function(){var a=c(this),e=a.closest(".llms-access-plan").find("span.llms-plan-title"),l=a.val(),t=l||e.attr("data-default");e.text(t)}),t.$plans.on("keyup llms-validate-plan-field","input",function(a,e){var l=c(this);l[0].checkValidity()?l.removeClass(t.validation_class):(l.addClass(t.validation_class),"keyup"===a.type&&l[0].reportValidity()),e&&!e.cascade||l.closest(".llms-access-plan").trigger("llms-validate-plan")}),t.$plans.on("llms-validate-plan",".llms-access-plan",function(){var a=c(this);a.find("input").each(function(){c(this).trigger("llms-validate-plan-field",{cascade:!1})}),a.find("."+t.validation_class).length?a.addClass(t.validation_class):a.removeClass(t.validation_class)}),t.$plans.on("llms-collapsible-toggled",".llms-access-plan",function(){var a=c(this);a.hasClass("opened")&&setTimeout(function(){a.find("input.llms-invalid").each(function(){c(this)[0].reportValidity()})},500)}),t.$plans.on("click",".llms-plan-delete",function(a){a.stopPropagation(),t.delete_plan(c(this))}),window.llms.metaboxes.post_select(c("#llms-access-plans .llms-availability-restrictions")),c("#_llms_plans_content_llms-new-access-plan-model").attr("disabled","disabled"),tinyMCE.EditorManager.execCommand("mceRemoveEditor",!0,"_llms_plans_content_llms-new-access-plan-model")},this.bind_visibility=function(){var e=c("#llms-catalog-visibility-select"),l=c("a.llms-edit-catalog-visibility"),a=c("a.llms-save-catalog-visibility"),t=c("a.llms-cancel-catalog-visibility");l.on("click",function(a){a.preventDefault(),e.slideDown("fast"),l.hide()}),a.on("click",function(a){a.preventDefault(),e.slideUp("fast"),l.show(),c("#llms-catalog-visibility-display").text(c('input[name="_llms_visibility"]:checked').attr("data-label"))}),t.on("click",function(a){a.preventDefault(),e.slideUp("fast"),l.show()})},this.delete_plan=function(a){var e=this,l=a.closest(".llms-access-plan"),t=l.attr("data-id"),s=LLMS.l10n.translate("After deleting this access plan, any students subscribed to this plan will still have access and will continue to make recurring payments according to the access plan's settings. If you wish to terminate their plans you must do so manually. This action cannot be reversed.");t?window.confirm(s)&&(LLMS.Spinner.start(l),window.LLMS.Ajax.call({data:{action:"delete_access_plan",plan_id:t},success:function(a){LLMS.Spinner.stop(l),a.success?(e.remove_plan_el(l),e.trigger_update_hook()):a.message&&alert(a.message)}})):e.remove_plan_el(l)},this.controller_change=function(a){var e=a.attr("data-controller-id"),i=a.val(),l=a.closest(".llms-access-plan").find('[data-controller="'+e+'"]');"checkbox"===a.attr("type")&&(i=a.is(":checked")?i:"no"),l.each(function(){var a,e,l=c(this),t="SELECT"===l[0].nodeName||"INPUT"===l[0].nodeName||"TEXTAREA"===l[0].nodeName?l:l.find("input, select, textarea"),s=l.attr("data-value-is"),n=l.attr("data-value-is-not");switch(void 0!==s&&!1!==s?e="==":void 0!==n&&!1!==n&&(e="!="),e){case"==":a=i==s?"show":"hide";break;case"!=":a=i!=n?"show":"hide"}"show"===a?(l.show(),t.removeAttr("disabled").trigger("change")):"hide"===a&&(l.hide(),t.attr("disabled","disabled"))})},this.get_plans_array=function(){tinyMCE.triggerSave();for(var a=this.$plans.closest("form").serializeArray(),e=[],l=0;l<a.length;l++)if(-1!==a[l].name.indexOf("_llms_plans")){var t=a[l].name.replace("_llms_plans[","").split("]["),s=1*t[0]-1,n=t[1].replace("]",""),i=3===t.length?"array":"single";e[s]||(e[s]={}),"array"===i?(e[s][n]||(e[s][n]=[]),e[s][n].push(a[l].value)):e[s][n]=a[l].value}return e},this.has_plan_limit_been_reached=function(){return window.llms.product.access_plan_limit<=c("#llms-access-plans .llms-access-plan").length},this.init_plan=function(){if(!this.has_plan_limit_been_reached()){var a=c("#llms-new-access-plan-model").clone();$existing_plans=c("#llms-access-plans .llms-access-plan"),$editor=a.find("#_llms_plans_content_llms-new-access-plan-model"),a.removeAttr("id"),$editor.removeAttr("id").attr("id","_llms_plans_content_"+this.temp_id),this.temp_id++,a.find("select, input, textarea").each(function(){c(this).removeAttr("disabled")}),a.find(".llms-access-plan-datepicker").datepicker({dateFormat:"mm/dd/yy"}),a.appendTo("#llms-access-plans"),this.update_plan_orders(),a.find(".llms-collapsible-header").trigger("click"),this.has_plan_limit_been_reached()&&this.toggle_create_button("disable"),window.llms.metaboxes.post_select(a.find(".llms-availability-restrictions")),a.find("[data-controller-id]").trigger("change"),c(document).trigger("llms-plan-init",a)}},this.save_plans=function(){var e=this;e.$plans.find(".llms-access-plan").each(function(){c(this).trigger("llms-validate-plan")}),e.$plans.find("."+e.validation_class).length?e.$plans.find(".llms-access-plan."+e.validation_class).not(".opened").first().find(".llms-collapsible-header").trigger("click"):(LLMS.Spinner.start(e.$plans),window.LLMS.Ajax.call({data:{action:"llms_update_access_plans",plans:e.get_plans_array()},complete:function(){LLMS.Spinner.stop(e.$plans)},error:function(a,e,l){console.error("llms access plan save error encounterd:",a),alert(LLMS.l10n.translate("An error was encounterd during the save attempt. Please try again.")+" ["+e+": "+l+"]")},success:function(a){!a.success&&a.code&&"error"===a.code?alert(a.message):a.data&&a.data.html&&(c("#llms-product-options-access-plans").replaceWith(a.data.html),e.init(!0),window.llms.metaboxes.init(),e.update_plan_orders(),e.trigger_update_hook())}}))},this.toggle_create_button=function(a){var e=c("#llms-new-access-plan");"disable"===a?e.attr("disabled","disabled"):e.removeAttr("disabled")},this.remove_plan_el=function(a){var e=this;a.fadeOut(400),setTimeout(function(){a.remove(),e.has_plan_limit_been_reached()||e.toggle_create_button("enable")},450)},this.trigger_update_hook=function(){c(document).trigger("llms-access-plans-updated")},this.update_plan_orders=function(){c("#llms-access-plans .llms-access-plan").each(function(){var a=c(this),e=a.find(".plan-order"),l=a.find('textarea[id^="_llms_plans_content_"]').attr("id"),t=1*e.val(),s=a.index();tinyMCE.EditorManager.execCommand("mceRemoveEditor",!0,l),a.find("select, input, textarea").each(function(){var a=c(this).attr("name");a&&c(this).attr("name",a.replace(t,s))}),tinyMCE.EditorManager.execCommand("mceAddEditor",!0,l),e.val(s)})},this.init()};new window.llms.metabox_product}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxsbXMtbWV0YWJveC1wcm9kdWN0LmpzIl0sIm5hbWVzIjpbIiQiLCJ3aW5kb3ciLCJsbG1zIiwibWV0YWJveF9wcm9kdWN0IiwidGhpcyIsIiRwbGFucyIsInRlbXBfaWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJ2YWxpZGF0aW9uX2NsYXNzIiwiaW5pdCIsInNraXBfZGVwX2NoZWNrcyIsInNlbGYiLCJiaW5kX3Zpc2liaWxpdHkiLCIkbWIiLCJsZW5ndGgiLCJiaW5kIiwiTExNUyIsIlNwaW5uZXIiLCJzdGFydCIsImludGVydmFsIiwiY291bnRlciIsInNldEludGVydmFsIiwiaHRtbCIsImwxMG4iLCJ0cmFuc2xhdGUiLCJ0aW55TUNFIiwiY2xlYXJJbnRlcnZhbCIsInN0b3AiLCJoYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQiLCJ0b2dnbGVfY3JlYXRlX2J1dHRvbiIsIm9uIiwiZSIsInByZXZlbnREZWZhdWx0Iiwic2F2ZV9wbGFucyIsImNvbnRyb2xsZXJfY2hhbmdlIiwiZGF0ZXBpY2tlciIsImRhdGVGb3JtYXQiLCJ0cmlnZ2VyIiwiJGVsIiwiaW5pdF9wbGFuIiwiYXR0ciIsInNldFRpbWVvdXQiLCJyZW1vdmVBdHRyIiwic29ydGFibGUiLCJoYW5kbGUiLCJpdGVtcyIsImV2ZW50IiwidWkiLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwidXBkYXRlX3BsYW5fb3JkZXJzIiwiJGlucHV0IiwiJGRpc3BsYXkiLCJjbG9zZXN0IiwiZmluZCIsInZhbCIsInRpdGxlIiwidGV4dCIsImRhdGEiLCJjaGVja1ZhbGlkaXR5IiwidHlwZSIsInJlcG9ydFZhbGlkaXR5IiwiY2FzY2FkZSIsIiRwbGFuIiwiZWFjaCIsImhhc0NsYXNzIiwic3RvcFByb3BhZ2F0aW9uIiwiZGVsZXRlX3BsYW4iLCJtZXRhYm94ZXMiLCJwb3N0X3NlbGVjdCIsIkVkaXRvck1hbmFnZXIiLCJleGVjQ29tbWFuZCIsIiRyYWRpb3MiLCIkdG9nZ2xlIiwiJHNhdmUiLCIkY2FuY2VsIiwic2xpZGVEb3duIiwiaGlkZSIsInNsaWRlVXAiLCJzaG93IiwiJGJ0biIsInBsYW5faWQiLCJ3YXJuaW5nIiwiY29uZmlybSIsIkFqYXgiLCJjYWxsIiwiYWN0aW9uIiwic3VjY2VzcyIsInIiLCJyZW1vdmVfcGxhbl9lbCIsInRyaWdnZXJfdXBkYXRlX2hvb2siLCJtZXNzYWdlIiwiYWxlcnQiLCJpZCIsIiRjb250cm9scyIsImlzIiwib3BlcmF0b3IiLCIkYyIsIiRlbHMiLCJub2RlTmFtZSIsImVxdWFscyIsIm5vdF9lcXVhbHMiLCJnZXRfcGxhbnNfYXJyYXkiLCJ0cmlnZ2VyU2F2ZSIsImZvcm0iLCJzZXJpYWxpemVBcnJheSIsInBsYW5zIiwiaSIsIm5hbWUiLCJpbmRleE9mIiwia2V5cyIsInJlcGxhY2UiLCJzcGxpdCIsImluZGV4IiwicHVzaCIsInZhbHVlIiwicHJvZHVjdCIsImFjY2Vzc19wbGFuX2xpbWl0IiwiJGNsb25lIiwiY2xvbmUiLCIkZXhpc3RpbmdfcGxhbnMiLCIkZWRpdG9yIiwiYXBwZW5kVG8iLCJkb2N1bWVudCIsIm5vdCIsImZpcnN0IiwiY29tcGxldGUiLCJlcnJvciIsImpxWEhSIiwidGV4dFN0YXR1cyIsImVycm9yVGhyb3duIiwiY29uc29sZSIsInJlcyIsImNvZGUiLCJyZXBsYWNlV2l0aCIsInN0YXR1cyIsImZhZGVPdXQiLCJyZW1vdmUiLCIkcCIsIiRvcmRlciIsImVkaXRvcl9pZCIsIm9yaWciLCJjdXJyIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQ0FNQSxTQUFZQSxHQUVYQyxPQUFPQyxLQUFPRCxPQUFPQyxNQUFRLEdBRTdCRCxPQUFPQyxLQUFLQyxnQkFBa0IsV0FNN0JDLEtBQUtDLE9BQVMsS0FPZEQsS0FBS0UsUUFBVUMsS0FBS0MsTUFBeUIsS0FBaEJELEtBQUtFLFNBQW9CLEtBTXRETCxLQUFLTSxpQkFBbUIsZUFVeEJOLEtBQUtPLEtBQU8sU0FBVUMsR0FFckIsSUFBSUMsRUFBT1QsS0FFWFMsRUFBS1IsT0FBU0wsRUFBRyxz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LFNBR0M5SCxFQUFLaUIsK0JBQ1hqQixFQUFLa0IscUJBQXNCLFdBRTFCLE1BV0ozQixLQUFLd0Ysb0JBQXNCLFdBRTFCNUYsRUFBRzZILFVBQVd0RixRQUFTLDhCQWF4Qm5DLEtBQUtnRCxtQkFBcUIsV0FFekJwRCxFQUFHLHdDQUF5Q2tFLEtBQU0sV0FFakQsSUFBSTBFLEVBQUs1SSxFQUFHSSxNQUNYeUksRUFBU0QsRUFBR3BGLEtBQU0sZUFFbEJzRixFQURVRixFQUFHcEYsS0FBTSx3Q0FDQ2QsS0FBTSxNQUMxQnFHLEVBQXNCLEVBQWZGLEVBQU9wRixNQUNkdUYsRUFBT0osRUFBR3pCLFFBR1h4RixRQUFRNkMsY0FBY0MsWUFBYSxtQkFBbUIsRUFBTXFFLEdBRzVERixFQUFHcEYsS0FBTSwyQkFBNEJVLEtBQU0sV0FFMUMsSUFBSTRDLEVBQU85RyxFQUFHSSxNQUFPc0MsS0FBTSxRQUN0Qm9FLEdBQ0o5RyxFQUFHSSxNQUFPc0MsS0FBTSxPQUFRb0UsRUFBS0csUUFBUzhCLEVBQU1DLE1BTTlDckgsUUFBUTZDLGNBQWNDLFlBQWEsZ0JBQWdCLEVBQU1xRSxHQUV6REQsRUFBT3BGLElBQUt1RixNQU9kNUksS0FBS08sUUFJRSxJQUFJVixPQUFPQyxLQUFLQyxnQkE1cEJ6QixDQThwQks4SSIsImZpbGUiOiJsbG1zLW1ldGFib3gtcHJvZHVjdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFByb2R1Y3QgT3B0aW9ucyBNZXRhQm94XG4gKiBEaXNwbGF5cyBvbiBDb3Vyc2UgJiBNZW1iZXJzaGlwIFBvc3QgVHlwZXNcbiAqIEBzaW5jZSAgICAzLjAuMFxuICogQHZlcnNpb24gIFt2ZXJzaW9uXVxuICovXG4oIGZ1bmN0aW9uKCAkICkge1xuXG5cdHdpbmRvdy5sbG1zID0gd2luZG93LmxsbXMgfHwge307XG5cblx0d2luZG93LmxsbXMubWV0YWJveF9wcm9kdWN0ID0gZnVuY3Rpb24oKSB7XG5cblx0XHQvKipcblx0XHQgKiBqUXVlcnkgb2JqIGZvciB0aGUgbWFpbiAkKCAnI2xsbXMtYWNjZXNzLXBsYW5zJyApIGVsZW1lbnQuXG5cdFx0ICogQHR5cGUgb2JqXG5cdFx0ICovXG5cdFx0dGhpcy4kcGxhbnMgPSBudWxsO1xuXG5cdFx0LyoqXG5cdFx0ICogQSByYW5kb21seSBnZW5lcmF0ZWQgdGVtcG9yYXJ5IElEIHVzZWQgZm9yIHRoZSB0aW55TUNFIGVkaXRvcidzIGlkXG5cdFx0ICogd2hlbiBhIG5ldyBwbGFuIGlzIGFkZGVkXG5cdFx0ICogQHR5cGUgaW50XG5cdFx0ICovXG5cdFx0dGhpcy50ZW1wX2lkID0gTWF0aC5mbG9vciggKCBNYXRoLnJhbmRvbSgpICogNzc3NyApICsgNzc3ICk7XG5cblx0XHQvKipcblx0XHQgKiBDU1MgY2xhc3MgbmFtZSB1c2VkIHRvIGhpZ2hsaWdodCB2YWxpZGF0aW9uIGVycm9ycyBmb3IgcGxhbiBmaWVsZHNcblx0XHQgKiBAdHlwZSBzdHJpbmdcblx0XHQgKi9cblx0XHR0aGlzLnZhbGlkYXRpb25fY2xhc3MgPSAnbGxtcy1pbnZhbGlkJztcblxuXHRcdC8qKlxuXHRcdCAqIEluaXRpYWxpemVcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSAgIGJvb2wgc2tpcF9kZXBfY2hlY2tzIGlmIHRydWUsIHNraXBzIGRlcGVuZGVuY3kgY2hlY2tzLlxuXHRcdCAqIEByZXR1cm4gIHZvaWRcblx0XHQgKiBAc2luY2UgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uIFt2ZXJzaW9uXVxuXHRcdCAqL1xuXHRcdHRoaXMuaW5pdCA9IGZ1bmN0aW9uKCBza2lwX2RlcF9jaGVja3MgKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi4kcGxhbnMgPSAkKCAnI2xsbXMtYWNjZXNzLXBsYW5zJyApO1xuXG5cdFx0XHRzZWxmLmJpbmRfdmlzaWJpbGl0eSgpO1xuXG5cdFx0XHR2YXIgJG1iID0gJCggJyNsaWZ0ZXJsbXMtcHJvZHVjdCAjbGxtcy1wcm9kdWN0LW9wdGlvbnMtYWNjZXNzLXBsYW5zJyApO1xuXG5cdFx0XHRpZiAoICEgJG1iLmxlbmd0aCApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fSBlbHNlIGlmICggc2tpcF9kZXBfY2hlY2tzICkge1xuXHRcdFx0XHRzZWxmLmJpbmQoKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRMTE1TLlNwaW5uZXIuc3RhcnQoICRtYiApO1xuXG5cdFx0XHQvLyB3ZSByZWx5IG9uIFRpbnlNQ0UgYnV0IFdvcmRQcmVzcyBkb2Vzbid0IHJlZ2lzdGVyIFRpbnlNQ0Vcblx0XHRcdC8vIGxpa2UgZXZlcnkgb3RoZXIgYWRtaW4gc2NyaXB0IHNvIHdlJ2xsIGRvIGEgbGl0dGxlIGRlcGVuZGVuY3kgY2hlY2sgaGVyZS4uLlxuXHRcdFx0dmFyIGNvdW50ZXIgPSAwLFxuXHRcdFx0XHRpbnRlcnZhbDtcblxuXHRcdFx0aW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCggZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0Ly8gaWYgd2UgZ2V0IHRvIDMwIHNlY29uZHMgZGlzcGxheSBhbiBlcnJvciBtZXNzYWdlXG5cdFx0XHRcdGlmICggY291bnRlciA+PSAzMDAgKSB7XG5cblx0XHRcdFx0XHQkbWIuaHRtbCggTExNUy5sMTBuLnRyYW5zbGF0ZSggJ1RoZXJlIHdhcyBhbiBlcnJvciBsb2FkaW5nIHRoZSBuZWNlc3NhcnkgcmVzb3VyY2VzLiBQbGVhc2UgdHJ5IGFnYWluLicgKSApO1xuXG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gaWYgd2UgY2FuJ3QgYWNjZXNzIHRpbnlNQ0UsIGluY3JlbWVudCBhbmQgd2FpdC4uLlxuXHRcdFx0XHRlbHNlIGlmICggJ3VuZGVmaW5lZCcgPT09IHR5cGVvZiB0aW55TUNFICkge1xuXG5cdFx0XHRcdFx0Y291bnRlcisrO1xuXHRcdFx0XHRcdHJldHVybjtcblxuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIGJpbmQgdGhlIGV2ZW50cywgd2UncmUgZ29vZCFcblx0XHRcdFx0ZWxzZSB7XG5cblx0XHRcdFx0XHRzZWxmLmJpbmQoKTtcblxuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y2xlYXJJbnRlcnZhbCggaW50ZXJ2YWwgKTtcblx0XHRcdFx0TExNUy5TcGlubmVyLnN0b3AoICRtYiApO1xuXG5cdFx0XHR9LCAxMDAgKTtcblxuXHRcdH07XG5cblxuXHRcdC8qKlxuXHRcdCAqIEJpbmQgRE9NIEV2ZW50c1xuXHRcdCAqXG5cdFx0ICogQHJldHVybiB2b2lkXG5cdFx0ICogQHNpbmNlICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uIFt2ZXJzaW9uXVxuXHRcdCAqL1xuXHRcdHRoaXMuYmluZCA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdGlmICggc2VsZi5oYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQoKSApIHtcblx0XHRcdFx0c2VsZi50b2dnbGVfY3JlYXRlX2J1dHRvbigpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBzYXZlIGFjY2VzcyBwbGFucyBidXR0b24uXG5cdFx0XHQkKCAnI2xsbXMtc2F2ZS1hY2Nlc3MtcGxhbnMnICkub24oICdjbGljaycsIGZ1bmN0aW9uKCBlICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdHNlbGYuc2F2ZV9wbGFucygpO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQvLyBiaW5kIGNoYW5nZSBldmVudHMgdG8gZm9ybSBlbGVtZW50IHRoYXQgY29udHJvbHMgYW5vdGhlciBmb3JtIGVsZW1lbnRcblx0XHRcdHNlbGYuJHBsYW5zLm9uKCAnY2hhbmdlJywgJ1tkYXRhLWNvbnRyb2xsZXItaWRdJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHNlbGYuY29udHJvbGxlcl9jaGFuZ2UoICQoIHRoaXMgKSApO1xuXHRcdFx0fSApXG5cblx0XHRcdCQoICcjbGxtcy1hY2Nlc3MtcGxhbnMgLmxsbXMtYWNjZXNzLXBsYW4tZGF0ZXBpY2tlcicgKS5kYXRlcGlja2VyKCB7XG5cdFx0XHRcdGRhdGVGb3JtYXQ6IFwibW0vZGQveXlcIlxuXHRcdFx0fSApO1xuXG5cdFx0XHQvLyB0cmlnZ2VyIGNoYW5nZXMgb24gbG9hZCBmb3IgYWxsIGV4aXN0aW5nIHBsYW5zXG5cdFx0XHQkKCAnI2xsbXMtYWNjZXNzLXBsYW5zIFtkYXRhLWNvbnRyb2xsZXItaWRdJyApLnRyaWdnZXIoICdjaGFuZ2UnICk7XG5cblx0XHRcdC8vIGFkZCBhIG5ldyBlbXB0eSBwbGFuIGludGVyZmFjZSBvbiBuZXcgcGxhbiBidXR0b24gY2xpY2suXG5cdFx0XHQkKCAnI2xsbXMtbmV3LWFjY2Vzcy1wbGFuJyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyICRlbCA9ICQoIHRoaXMgKTtcblx0XHRcdFx0c2VsZi5pbml0X3BsYW4oKTtcblx0XHRcdFx0JGVsLmF0dHIoICdkaXNhYmxlZCcsICdkaXNhYmxlZCcgKTtcblx0XHRcdFx0c2V0VGltZW91dCggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0aWYgKCAhIHNlbGYuaGFzX3BsYW5fbGltaXRfYmVlbl9yZWFjaGVkKCkgKSB7XG5cdFx0XHRcdFx0XHQkZWwucmVtb3ZlQXR0ciggJ2Rpc2FibGVkJyApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSwgNTAwICk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdHNlbGYuJHBsYW5zLnNvcnRhYmxlKCB7XG5cdFx0XHRcdGhhbmRsZTogJy5sbG1zLWRyYWctaGFuZGxlJyxcblx0XHRcdFx0aXRlbXM6ICcubGxtcy1hY2Nlc3MtcGxhbicsXG5cdFx0XHRcdHN0YXJ0OiBmdW5jdGlvbiggZXZlbnQsIHVpICkge1xuXHRcdFx0XHRcdHNlbGYuJHBsYW5zLmFkZENsYXNzKCAnZHJhZ2dpbmcnICk7XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHN0b3A6IGZ1bmN0aW9uKCBldmVudCwgdWkgKSB7XG5cdFx0XHRcdFx0c2VsZi4kcGxhbnMucmVtb3ZlQ2xhc3MoICdkcmFnZ2luZycgKTtcblx0XHRcdFx0XHRzZWxmLnVwZGF0ZV9wbGFuX29yZGVycygpO1xuXHRcdFx0XHR9LFxuXHRcdFx0fSApO1xuXG5cdFx0XHQvLyBiaW5kIHRleHQgZW50ZXJlZCBpbnRvIHRoZSB0aXRsZSB0byB0aGUgZGlzcGxheWVkIHRpdGxlIGZvciBmYW5jeSBmdW5cblx0XHRcdHNlbGYuJHBsYW5zLm9uKCAna2V5dXAnLCAnaW5wdXQubGxtcy1wbGFuLXRpdGxlJywgZnVuY3Rpb24oICkge1xuXG5cdFx0XHRcdHZhciAkaW5wdXQgPSAkKCB0aGlzICksXG5cdFx0XHRcdFx0JHBsYW4gPSAkaW5wdXQuY2xvc2VzdCggJy5sbG1zLWFjY2Vzcy1wbGFuJyApLFxuXHRcdFx0XHRcdCRkaXNwbGF5ID0gJHBsYW4uZmluZCggJ3NwYW4ubGxtcy1wbGFuLXRpdGxlJyApLFxuXHRcdFx0XHRcdHZhbCA9ICRpbnB1dC52YWwoKSxcblx0XHRcdFx0XHR0aXRsZSA9ICggdmFsICkgPyB2YWwgOiAkZGlzcGxheS5hdHRyKCAnZGF0YS1kZWZhdWx0JyApO1xuXG5cdFx0XHRcdCRkaXNwbGF5LnRleHQoIHRpdGxlICk7XG5cblx0XHRcdH0gKTtcblxuXHRcdFx0Ly8gVmFsaWRhdGUgYSBzaW5nbGUgaW5wdXQgZmllbGRcblx0XHRcdHNlbGYuJHBsYW5zLm9uKCAna2V5dXAgbGxtcy12YWxpZGF0ZS1wbGFuLWZpZWxkJywgJ2lucHV0JywgZnVuY3Rpb24oIGUsIGRhdGEgKSB7XG5cblx0XHRcdFx0dmFyICRpbnB1dCA9ICQoIHRoaXMgKTtcblxuXHRcdFx0XHRpZiAoICRpbnB1dFswXS5jaGVja1ZhbGlkaXR5KCkgKSB7XG5cdFx0XHRcdFx0JGlucHV0LnJlbW92ZUNsYXNzKCBzZWxmLnZhbGlkYXRpb25fY2xhc3MgKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQkaW5wdXQuYWRkQ2xhc3MoIHNlbGYudmFsaWRhdGlvbl9jbGFzcyApO1xuXHRcdFx0XHRcdGlmICggJ2tleXVwJyA9PT0gZS50eXBlICkge1xuXHRcdFx0XHRcdFx0JGlucHV0WzBdLnJlcG9ydFZhbGlkaXR5KCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCAhIGRhdGEgfHwgZGF0YS5jYXNjYWRlICkge1xuXHRcdFx0XHRcdCRpbnB1dC5jbG9zZXN0KCAnLmxsbXMtYWNjZXNzLXBsYW4nICkudHJpZ2dlciggJ2xsbXMtdmFsaWRhdGUtcGxhbicgKTtcblx0XHRcdFx0fVxuXG5cblx0XHRcdH0gKTtcblxuXHRcdFx0c2VsZi4kcGxhbnMub24oICdsbG1zLXZhbGlkYXRlLXBsYW4nLCAnLmxsbXMtYWNjZXNzLXBsYW4nLCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHR2YXIgJHBsYW4gPSAkKCB0aGlzICk7XG5cblx0XHRcdFx0JHBsYW4uZmluZCggJ2lucHV0JyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdCQoIHRoaXMgKS50cmlnZ2VyKCAnbGxtcy12YWxpZGF0ZS1wbGFuLWZpZWxkJywgeyBjYXNjYWRlOiBmYWxzZSB9ICk7XG5cdFx0XHRcdH0gKTtcblxuXHRcdFx0XHRpZiAoICRwbGFuLmZpbmQoICcuJyArIHNlbGYudmFsaWRhdGlvbl9jbGFzcyApLmxlbmd0aCApIHtcblx0XHRcdFx0XHQkcGxhbi5hZGRDbGFzcyggc2VsZi52YWxpZGF0aW9uX2NsYXNzICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0JHBsYW4ucmVtb3ZlQ2xhc3MoIHNlbGYudmFsaWRhdGlvbl9jbGFzcyApO1xuXHRcdFx0XHR9XG5cblx0XHRcdH0gKTtcblxuXHRcdFx0c2VsZi4kcGxhbnMub24oICdsbG1zLWNvbGxhcHNpYmxlLXRvZ2dsZWQnLCAnLmxsbXMtYWNjZXNzLXBsYW4nLCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHR2YXIgJHBsYW4gPSAkKCB0aGlzICk7XG5cblx0XHRcdFx0aWYgKCAkcGxhbi5oYXNDbGFzcyggJ29wZW5lZCcgKSApIHtcblx0XHRcdFx0XHQvLyB3YWl0IGZvciBhbmltYXRpb24gdG8gY29tcGxldGUgdG8gcHJldmVudCBmb2N1c2FibGUgZXJyb3JzIGluIHRoZSBjb25zb2xlLlxuXHRcdFx0XHRcdHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0JHBsYW4uZmluZCggJ2lucHV0LmxsbXMtaW52YWxpZCcgKS5lYWNoKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdFx0JCggdGhpcyApWzBdLnJlcG9ydFZhbGlkaXR5KCk7XG5cdFx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdFx0fSwgNTAwICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSApO1xuXG5cdFx0XHRzZWxmLiRwbGFucy5vbiggJ2NsaWNrJywgJy5sbG1zLXBsYW4tZGVsZXRlJywgZnVuY3Rpb24oIGUgKSB7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdHNlbGYuZGVsZXRlX3BsYW4oICQoIHRoaXMgKSApO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQvLyBzZWxlY3QyaWZ5IG1lbWJlcnNoaXAgYXZhaWxhYmlsaXR5IGZpZWxkc1xuXHRcdFx0d2luZG93LmxsbXMubWV0YWJveGVzLnBvc3Rfc2VsZWN0KCAkKCAnI2xsbXMtYWNjZXNzLXBsYW5zIC5sbG1zLWF2YWlsYWJpbGl0eS1yZXN0cmljdGlvbnMnICkgKTtcblxuXHRcdFx0Ly8gZGlzYWJsZSB0aGUgdGV4dGFyZWEgZ2VuZXJhdGVkIGJ5IHRoZSB3cF9lZGl0b3IgZnVuY3Rpb25cblx0XHRcdC8vIGNhbid0IGZpZ3VyZSBvdXQgaG93IHRvIGRvIHRoaXMgZHVyaW5nIGluaXRpYWxpemF0aW9uXG5cdFx0XHQkKCAnI19sbG1zX3BsYW5zX2NvbnRlbnRfbGxtcy1uZXctYWNjZXNzLXBsYW4tbW9kZWwnICkuYXR0ciggJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyApO1xuXHRcdFx0dGlueU1DRS5FZGl0b3JNYW5hZ2VyLmV4ZWNDb21tYW5kKCAnbWNlUmVtb3ZlRWRpdG9yJywgdHJ1ZSwgJ19sbG1zX3BsYW5zX2NvbnRlbnRfbGxtcy1uZXctYWNjZXNzLXBsYW4tbW9kZWwnICk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQmluZCBET00gZXZlbnRzIGZvciBlZGl0aW5nIHByb2R1Y3QgdmlzaWJpbGl0eVxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuNi4wXG5cdFx0ICogQHZlcnNpb24gIDMuNi4wXG5cdFx0ICovXG5cdFx0dGhpcy5iaW5kX3Zpc2liaWxpdHkgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyICRyYWRpb3MgPSAkKCAnI2xsbXMtY2F0YWxvZy12aXNpYmlsaXR5LXNlbGVjdCcgKSxcblx0XHRcdFx0JHRvZ2dsZSA9ICQoICdhLmxsbXMtZWRpdC1jYXRhbG9nLXZpc2liaWxpdHknICksXG5cdFx0XHRcdCRzYXZlID0gJCggJ2EubGxtcy1zYXZlLWNhdGFsb2ctdmlzaWJpbGl0eScgKSxcblx0XHRcdFx0JGNhbmNlbCA9ICAkKCAnYS5sbG1zLWNhbmNlbC1jYXRhbG9nLXZpc2liaWxpdHknICk7XG5cblx0XHRcdCR0b2dnbGUub24oICdjbGljaycsIGZ1bmN0aW9uKCBlICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCRyYWRpb3Muc2xpZGVEb3duKCAnZmFzdCcgKTtcblx0XHRcdFx0JHRvZ2dsZS5oaWRlKCk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdCRzYXZlLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHQkcmFkaW9zLnNsaWRlVXAoICdmYXN0JyApO1xuXHRcdFx0XHQkdG9nZ2xlLnNob3coKTtcblx0XHRcdFx0JCggJyNsbG1zLWNhdGFsb2ctdmlzaWJpbGl0eS1kaXNwbGF5JyApLnRleHQoICQoICdpbnB1dFtuYW1lPVwiX2xsbXNfdmlzaWJpbGl0eVwiXTpjaGVja2VkJyApLmF0dHIoICdkYXRhLWxhYmVsJyApICk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdCRjYW5jZWwub24oICdjbGljaycsIGZ1bmN0aW9uKCBlICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCRyYWRpb3Muc2xpZGVVcCggJ2Zhc3QnICk7XG5cdFx0XHRcdCR0b2dnbGUuc2hvdygpO1xuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEhhbmRsZSBwaHlzaWNhbCBkZWxldGlvbiBvZiBhIHBsYW4gZWxlbWVudFxuXHRcdCAqIElmIHRoZSBwbGFuIGhhc24ndCBiZSBwZXJzaXN0ZWQgdG8gdGhlIGRhdGFic2UgaXQncyByZW1vdmVkIGZyb20gdGhlIGRvbVxuXHRcdCAqIGlmIGl0IGFscmVhZHkgZXhpc3RzIGluIHRoZSBkYXRhYmFzZSBhIGNvbmZpcm0gbW9kYWwgaXMgZGlzcGxheWVkXG5cdFx0ICogdXBvbiBjb25maXJtYXRpb24gQUpBWCBjYWxsIHdpbGwgYmUgbWFkZSB0byBtb3ZlIHRoZSBwbGFuIHRvIHRoZSB0cmFzaFxuXHRcdCAqIGFuZCB1cG9uIHN1Y2Nlc3MgdGhlIGVsZW1lbnQgd2lsbCBiZSByZW1vdmVkIGZyb20gdGhlIGRvbVxuXHRcdCAqXG5cdFx0ICogQHBhcmFtICBvYmogJGJ0biBqUXVlcnkgc2VsZWN0b3Igb2YgdGhlIFwiWFwiIGJ1dHRvbiBjbGlja2VkIHRvIGluaXRpYXRlIGRlbGV0aW9uXG5cdFx0ICogQHJldHVybiB2b2lkXG5cdFx0ICogQHNpbmNlICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICBbdmVyc2lvbl1cblx0XHQgKi9cblx0XHR0aGlzLmRlbGV0ZV9wbGFuID0gZnVuY3Rpb24oICRidG4gKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0JHBsYW4gPSAkYnRuLmNsb3Nlc3QoICcubGxtcy1hY2Nlc3MtcGxhbicgKSxcblx0XHRcdFx0cGxhbl9pZCA9ICRwbGFuLmF0dHIoICdkYXRhLWlkJyApLFxuXHRcdFx0XHR3YXJuaW5nID0gTExNUy5sMTBuLnRyYW5zbGF0ZSggJ0FmdGVyIGRlbGV0aW5nIHRoaXMgYWNjZXNzIHBsYW4sIGFueSBzdHVkZW50cyBzdWJzY3JpYmVkIHRvIHRoaXMgcGxhbiB3aWxsIHN0aWxsIGhhdmUgYWNjZXNzIGFuZCB3aWxsIGNvbnRpbnVlIHRvIG1ha2UgcmVjdXJyaW5nIHBheW1lbnRzIGFjY29yZGluZyB0byB0aGUgYWNjZXNzIHBsYW5cXCdzIHNldHRpbmdzLiBJZiB5b3Ugd2lzaCB0byB0ZXJtaW5hdGUgdGhlaXIgcGxhbnMgeW91IG11c3QgZG8gc28gbWFudWFsbHkuIFRoaXMgYWN0aW9uIGNhbm5vdCBiZSByZXZlcnNlZC4nICk7XG5cblx0XHRcdC8vIGlmIHRoZXJlJ3Mgbm8gSUQganVzdCByZW1vdmUgdGhlIGVsZW1lbnQgZnJvbSB0aGUgRE9NXG5cdFx0XHRpZiAoICEgcGxhbl9pZCApIHtcblxuXHRcdFx0XHRzZWxmLnJlbW92ZV9wbGFuX2VsKCAkcGxhbiApO1xuXG5cdFx0XHQvLyBUaHJvdyBhIGNvbmZpcm1hdGlvbiB3YXJuaW5nXG5cdFx0XHR9IGVsc2UgaWYgKCB3aW5kb3cuY29uZmlybSggd2FybmluZyApICkge1xuXG5cdFx0XHRcdExMTVMuU3Bpbm5lci5zdGFydCggJHBsYW4gKTtcblx0XHRcdFx0d2luZG93LkxMTVMuQWpheC5jYWxsKCB7XG5cdFx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdFx0YWN0aW9uOiAnZGVsZXRlX2FjY2Vzc19wbGFuJyxcblx0XHRcdFx0XHRcdHBsYW5faWQ6IHBsYW5faWQsXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbiggciApIHtcblx0XHRcdFx0XHRcdExMTVMuU3Bpbm5lci5zdG9wKCAkcGxhbiApO1xuXHRcdFx0XHRcdFx0aWYgKCByLnN1Y2Nlc3MgKSB7XG5cdFx0XHRcdFx0XHRcdHNlbGYucmVtb3ZlX3BsYW5fZWwoICRwbGFuICk7XG5cdFx0XHRcdFx0XHRcdHNlbGYudHJpZ2dlcl91cGRhdGVfaG9vaygpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIGlmICggci5tZXNzYWdlICkge1xuXHRcdFx0XHRcdFx0XHRhbGVydCggci5tZXNzYWdlICk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gKTtcblxuXHRcdFx0fVxuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEhhbmRsZSBoaWRpbmcgJiBzaG93aW5nIHZhcmlvcyBwaWVjZXMgb2YgYW4gYWNjZXNzIHBsYW4gZm9ybVxuXHRcdCAqIFRoaXMgaXMgYm91bmQgdG8gYW55IGZvcm0gZWxlbWVudCB3aXRoIGEgXCJkYXRhLWNvbnRyb2xsZXItaWRcIiBwcm9wZXJ0eVxuXHRcdCAqXG5cdFx0ICogQHBhcmFtICBvYmogICRlbCAgIGpRdWVyeSBzZWxlY3RvciBmb3IgdGhlIGNoYW5nZWQgZm9ybSBlbGVtZW50XG5cdFx0ICogQHJldHVybiB2b2lkXG5cdFx0ICogQHNpbmNlICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuY29udHJvbGxlcl9jaGFuZ2UgPSBmdW5jdGlvbiggJGVsICkge1xuXG5cdFx0XHR2YXIgaWQgPSAkZWwuYXR0ciggJ2RhdGEtY29udHJvbGxlci1pZCcgKSxcblx0XHRcdFx0dmFsID0gJGVsLnZhbCgpLFxuXHRcdFx0XHQkZm9ybSA9ICRlbC5jbG9zZXN0KCAnLmxsbXMtYWNjZXNzLXBsYW4nICksXG5cdFx0XHRcdCRjb250cm9scyA9ICRmb3JtLmZpbmQoICdbZGF0YS1jb250cm9sbGVyPVwiJyArIGlkICsgJ1wiXScpO1xuXG5cdFx0XHRpZiAoICdjaGVja2JveCcgPT09ICRlbC5hdHRyKCAndHlwZScgKSApICB7XG5cdFx0XHRcdHZhbCA9ICggJGVsLmlzKCAnOmNoZWNrZWQnICkgKSA/IHZhbCA6ICdubyc7XG5cdFx0XHR9XG5cblx0XHRcdCRjb250cm9scy5lYWNoKCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHR2YXIgJGMgPSAkKCB0aGlzICksXG5cdFx0XHRcdFx0JGVscyA9ICggJ1NFTEVDVCcgPT09ICRjWzBdLm5vZGVOYW1lIHx8ICdJTlBVVCcgID09PSAkY1swXS5ub2RlTmFtZSB8fCAnVEVYVEFSRUEnICA9PT0gJGNbMF0ubm9kZU5hbWUgKSA/ICRjIDogJGMuZmluZCggJ2lucHV0LCBzZWxlY3QsIHRleHRhcmVhJyApLFxuXHRcdFx0XHRcdGVxdWFscyA9ICRjLmF0dHIoICdkYXRhLXZhbHVlLWlzJyApLFxuXHRcdFx0XHRcdG5vdF9lcXVhbHMgPSAkYy5hdHRyKCAnZGF0YS12YWx1ZS1pcy1ub3QnICksXG5cdFx0XHRcdFx0YWN0aW9uLCBvcGVyYXRvcjtcblxuXHRcdFx0XHRpZiAoIHR5cGVvZiBlcXVhbHMgIT09IHR5cGVvZiB1bmRlZmluZWQgJiYgZXF1YWxzICE9PSBmYWxzZSApIHtcblxuXHRcdFx0XHRcdG9wZXJhdG9yID0gJz09JztcblxuXHRcdFx0XHR9IGVsc2UgaWYgKCB0eXBlb2Ygbm90X2VxdWFscyAhPT0gdHlwZW9mIHVuZGVmaW5lZCAmJiBub3RfZXF1YWxzICE9PSBmYWxzZSApIHtcblxuXHRcdFx0XHRcdG9wZXJhdG9yID0gJyE9JztcblxuXHRcdFx0XHR9XG5cblx0XHRcdFx0c3dpdGNoICggb3BlcmF0b3IgKSB7XG5cblx0XHRcdFx0XHRjYXNlICc9PSc6XG5cblx0XHRcdFx0XHRcdGlmICggdmFsID09IGVxdWFscyApIHtcblx0XHRcdFx0XHRcdFx0YWN0aW9uID0gJ3Nob3cnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0YWN0aW9uID0gJ2hpZGUnO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlICchPSc6XG5cblx0XHRcdFx0XHRcdGlmICggdmFsICE9IG5vdF9lcXVhbHMgKSB7XG5cdFx0XHRcdFx0XHRcdGFjdGlvbiA9ICdzaG93Jztcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGFjdGlvbiA9ICdoaWRlJztcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoICdzaG93JyA9PT0gYWN0aW9uICkge1xuXHRcdFx0XHRcdCRjLnNob3coKTtcblx0XHRcdFx0XHQkZWxzLnJlbW92ZUF0dHIoICdkaXNhYmxlZCcgKS50cmlnZ2VyKCAnY2hhbmdlJyApO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCAnaGlkZScgPT09IGFjdGlvbiApIHtcblx0XHRcdFx0XHQkYy5oaWRlKCk7XG5cdFx0XHRcdFx0JGVscy5hdHRyKCAnZGlzYWJsZWQnLCAnZGlzYWJsZWQnICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHJpZXZlIGFjY2VzcyBwbGFuIGRhdGEgYXMgYW4gYXJyYXkgb2YgSlNPTiBidWlsdCBmcm9tIHRoZSBkb20gZWxlbWVudCBmaWVsZCB2YWx1ZXMuXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuICBhcnJheVxuXHRcdCAqIEBzaW5jZSAgIFt2ZXJzaW9uXVxuXHRcdCAqIEB2ZXJzaW9uIFt2ZXJzaW9uXVxuXHRcdCAqL1xuXHRcdHRoaXMuZ2V0X3BsYW5zX2FycmF5ID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdC8vIGVuc3VyZSBhbGwgY29udGVudCBlZGl0b3JzIGFyZSBzYXZlZCBwcm9wZXJseS5cblx0XHRcdHRpbnlNQ0UudHJpZ2dlclNhdmUoKTtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRmb3JtID0gc2VsZi4kcGxhbnMuY2xvc2VzdCggJ2Zvcm0nICkuc2VyaWFsaXplQXJyYXkoKSxcblx0XHRcdFx0cGxhbnMgPSBbXTtcblxuXHRcdFx0Zm9yICggdmFyIGkgPSAwOyBpIDwgZm9ybS5sZW5ndGg7IGkrKyApIHtcblxuXHRcdFx0XHQvLyBTa2lwIG5vbiBwbGFuIGRhdGEgZnJvbSB0aGUgZm9ybS5cblx0XHRcdFx0aWYgKCAtMSA9PT0gZm9ybVsgaSBdLm5hbWUuaW5kZXhPZiggJ19sbG1zX3BsYW5zJyApICkge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dmFyIGtleXMgPSBmb3JtWyBpIF0ubmFtZS5yZXBsYWNlKCAnX2xsbXNfcGxhbnNbJywgJycgKS5zcGxpdCggJ11bJyApLFxuXHRcdFx0XHRcdGluZGV4ID0gKCBrZXlzWzBdICogMSApIC0gMSxcblx0XHRcdFx0XHRuYW1lID0ga2V5c1sxXS5yZXBsYWNlKCAnXScsICcnICksXG5cdFx0XHRcdFx0dHlwZSA9IDMgPT09IGtleXMubGVuZ3RoID8gJ2FycmF5JyA6ICdzaW5nbGUnO1xuXG5cdFx0XHRcdGlmICggISBwbGFuc1sgaW5kZXggXSApIHtcblx0XHRcdFx0XHRwbGFuc1sgaW5kZXggXSA9IHt9O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCAnYXJyYXknID09PSB0eXBlICkge1xuXG5cdFx0XHRcdFx0aWYgKCAhIHBsYW5zWyBpbmRleCBdWyBuYW1lIF0gKSB7XG5cdFx0XHRcdFx0XHRwbGFuc1sgaW5kZXggXVsgbmFtZSBdID0gW107XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHBsYW5zWyBpbmRleCBdWyBuYW1lIF0ucHVzaCggZm9ybVsgaSBdLnZhbHVlICk7XG5cblx0XHRcdFx0fSBlbHNlIHtcblxuXHRcdFx0XHRcdHBsYW5zWyBpbmRleCBdWyBuYW1lIF0gPSBmb3JtWyBpIF0udmFsdWU7XG5cblx0XHRcdFx0fVxuXG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBwbGFucztcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBEZXRlcm1pbmUgaWYgdGhlIGFjY2VzcyBwbGFuIGxpbWl0IGhhcyBiZWVuIHJlYWNoZWRcblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gQm9vbGVhbiAgICAgdHJ1ZSBpZiBpdCdzIGJlZW4gcmVhY2hlZCwgZmFsc2Ugb3RoZXJ3aXNlXG5cdFx0ICogQHNpbmNlICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuaGFzX3BsYW5fbGltaXRfYmVlbl9yZWFjaGVkID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBsaW1pdCA9IHdpbmRvdy5sbG1zLnByb2R1Y3QuYWNjZXNzX3BsYW5fbGltaXQsXG5cdFx0XHRcdGN1cnIgPSAkKCAnI2xsbXMtYWNjZXNzLXBsYW5zIC5sbG1zLWFjY2Vzcy1wbGFuJyApLmxlbmd0aDtcblxuXHRcdFx0cmV0dXJuIGN1cnIgPj0gbGltaXQ7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogSW5pdGFsaXplcyBhIG5ldyBwbGFuIGFuZCBhZGRzIGl0IHRvIHRoZSBsaXN0IG9mIHBsYW5zIGluIHRoZSBET01cblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjIzLjBcblx0XHQgKi9cblx0XHR0aGlzLmluaXRfcGxhbiA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHQvLyBkb24ndCBkbyBhbnl0aGluZyBpZiB3ZSd2ZSByZWFjaGVkIHRoZSBwbGFuIGxpbWl0XG5cdFx0XHRpZiAoIHRoaXMuaGFzX3BsYW5fbGltaXRfYmVlbl9yZWFjaGVkKCkgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dmFyICRjbG9uZSA9ICQoICcjbGxtcy1uZXctYWNjZXNzLXBsYW4tbW9kZWwnICkuY2xvbmUoKVxuXHRcdFx0XHQkZXhpc3RpbmdfcGxhbnMgPSAkKCAnI2xsbXMtYWNjZXNzLXBsYW5zIC5sbG1zLWFjY2Vzcy1wbGFuJyApLFxuXHRcdFx0XHQkZWRpdG9yID0gJGNsb25lLmZpbmQoICcjX2xsbXNfcGxhbnNfY29udGVudF9sbG1zLW5ldy1hY2Nlc3MtcGxhbi1tb2RlbCcgKTtcblxuXHRcdFx0Ly8gcmVtb3ZlIElEIGZyb20gdGhlIGl0ZW1cblx0XHRcdCRjbG9uZS5yZW1vdmVBdHRyKCAnaWQnICk7XG5cblx0XHRcdC8vIGdpdmUgYSB0ZW1wb3JhcnkgaWQgdG8gdGhlIGVkaXRvciBlbGVtZW50XG5cdFx0XHQkZWRpdG9yLnJlbW92ZUF0dHIoICdpZCcgKS5hdHRyKCAnaWQnLCAnX2xsbXNfcGxhbnNfY29udGVudF8nICsgdGhpcy50ZW1wX2lkICk7XG5cdFx0XHR0aGlzLnRlbXBfaWQrKzsgLy8gaW5jcmVtZW50IHRoZSB0ZW1wX2lkIElEIHNvIHdlIGRvbid0IHVzZSBpdCBhZ2FpblxuXG5cblx0XHRcdC8vIGFjdGl2YXRlIGFsbCBlbGVtZW50c1xuXHRcdFx0JGNsb25lLmZpbmQoICdzZWxlY3QsIGlucHV0LCB0ZXh0YXJlYScgKS5lYWNoKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0JCggdGhpcyApLnJlbW92ZUF0dHIoICdkaXNhYmxlZCcgKTsgLy8gZW5hYmxlZCB0aGUgZmllbGRcblx0XHRcdH0gKTtcblxuXG5cdFx0XHQkY2xvbmUuZmluZCggJy5sbG1zLWFjY2Vzcy1wbGFuLWRhdGVwaWNrZXInICkuZGF0ZXBpY2tlcigge1xuXHRcdFx0XHRkYXRlRm9ybWF0OiBcIm1tL2RkL3l5XCJcblx0XHRcdH0gKTtcblxuXHRcdFx0JGNsb25lLmFwcGVuZFRvKCAnI2xsbXMtYWNjZXNzLXBsYW5zJyApO1xuXG5cdFx0XHQvLyByZXdyaXRlIHRoZSBvcmRlciBvZiBhbGwgZWxlbWVudHNcblx0XHRcdHRoaXMudXBkYXRlX3BsYW5fb3JkZXJzKCk7XG5cblx0XHRcdCRjbG9uZS5maW5kKCAnLmxsbXMtY29sbGFwc2libGUtaGVhZGVyJyApLnRyaWdnZXIoICdjbGljaycgKTtcblxuXHRcdFx0Ly8gY2hlY2sgaWYgdGhlIGxpbWl0IGhhcyBiZWVuIHJlYWNoZWQgYW5kIHRvZ2dsZSB0aGUgYnV0dG9uIGlmIGl0IGhhc1xuXHRcdFx0aWYgKCB0aGlzLmhhc19wbGFuX2xpbWl0X2JlZW5fcmVhY2hlZCgpICkge1xuXHRcdFx0XHR0aGlzLnRvZ2dsZV9jcmVhdGVfYnV0dG9uKCAnZGlzYWJsZScgKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gc2VsZWN0MmlmeSBtZW1iZXJzaGlwIGF2YWlsYWJpbGl0eSBmaWVsZFxuXHRcdFx0d2luZG93LmxsbXMubWV0YWJveGVzLnBvc3Rfc2VsZWN0KCAkY2xvbmUuZmluZCggJy5sbG1zLWF2YWlsYWJpbGl0eS1yZXN0cmljdGlvbnMnICkgKTtcblxuXHRcdFx0JGNsb25lLmZpbmQoICdbZGF0YS1jb250cm9sbGVyLWlkXScgKS50cmlnZ2VyKCAnY2hhbmdlJyApO1xuXHRcdFx0JCggZG9jdW1lbnQgKS50cmlnZ2VyKCAnbGxtcy1wbGFuLWluaXQnLCAkY2xvbmUgKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBQZXJzaXN0IGFjY2VzcyBwbGFucyB0byB0aGUgREIgaWYgdGhleSBwYXNzIHZhbGlkYXRpb25cblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gIHtbdHlwZV19XG5cdFx0ICogQHNpbmNlICAgW3ZlcnNpb25dXG5cdFx0ICogQHZlcnNpb24gW3ZlcnNpb25dXG5cdFx0ICovXG5cdFx0dGhpcy5zYXZlX3BsYW5zID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0c2VsZi4kcGxhbnMuZmluZCggJy5sbG1zLWFjY2Vzcy1wbGFuJyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKCB0aGlzICkudHJpZ2dlciggJ2xsbXMtdmFsaWRhdGUtcGxhbicgKTtcblx0XHRcdH0gKTtcblxuXHRcdFx0aWYgKCBzZWxmLiRwbGFucy5maW5kKCAnLicgKyBzZWxmLnZhbGlkYXRpb25fY2xhc3MgKS5sZW5ndGggKSB7XG5cdFx0XHRcdHNlbGYuJHBsYW5zLmZpbmQoICcubGxtcy1hY2Nlc3MtcGxhbi4nICsgc2VsZi52YWxpZGF0aW9uX2NsYXNzICkubm90KCAnLm9wZW5lZCcgKS5maXJzdCgpLmZpbmQoICcubGxtcy1jb2xsYXBzaWJsZS1oZWFkZXInICkudHJpZ2dlciggJ2NsaWNrJyApO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdExMTVMuU3Bpbm5lci5zdGFydCggc2VsZi4kcGxhbnMgKTtcblx0XHRcdHdpbmRvdy5MTE1TLkFqYXguY2FsbCgge1xuXHRcdFx0XHRkYXRhOiB7XG5cdFx0XHRcdFx0YWN0aW9uOiAnbGxtc191cGRhdGVfYWNjZXNzX3BsYW5zJyxcblx0XHRcdFx0XHRwbGFuczogc2VsZi5nZXRfcGxhbnNfYXJyYXkoKSxcblx0XHRcdFx0fSxcblx0XHRcdFx0Y29tcGxldGU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdExMTVMuU3Bpbm5lci5zdG9wKCBzZWxmLiRwbGFucyApO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRlcnJvcjogZnVuY3Rpb24oIGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93biApIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKCAnbGxtcyBhY2Nlc3MgcGxhbiBzYXZlIGVycm9yIGVuY291bnRlcmQ6JywganFYSFIgKTtcblx0XHRcdFx0XHRhbGVydCggTExNUy5sMTBuLnRyYW5zbGF0ZSggJ0FuIGVycm9yIHdhcyBlbmNvdW50ZXJkIGR1cmluZyB0aGUgc2F2ZSBhdHRlbXB0LiBQbGVhc2UgdHJ5IGFnYWluLicgKSArICcgWycgICsgdGV4dFN0YXR1cyArICc6ICcgKyBlcnJvclRocm93biArICddJyApO1xuXHRcdFx0XHR9LFxuXHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbiggcmVzICkge1xuXG5cdFx0XHRcdFx0aWYgKCAhIHJlcy5zdWNjZXNzICYmIHJlcy5jb2RlICYmICdlcnJvcicgPT09IHJlcy5jb2RlICkge1xuXHRcdFx0XHRcdFx0YWxlcnQoIHJlcy5tZXNzYWdlICk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICggcmVzLmRhdGEgJiYgcmVzLmRhdGEuaHRtbCApIHtcblxuXHRcdFx0XHRcdFx0Ly8gcmVwbGFjZSB0aGUgbWV0YWJveCB3aXRoIHVwZGF0ZWQgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIuXG5cdFx0XHRcdFx0XHQkKCAnI2xsbXMtcHJvZHVjdC1vcHRpb25zLWFjY2Vzcy1wbGFucycgKS5yZXBsYWNlV2l0aCggcmVzLmRhdGEuaHRtbCApO1xuXG5cdFx0XHRcdFx0XHQvLyByZWluaXQuXG5cdFx0XHRcdFx0XHRzZWxmLmluaXQoIHRydWUgKTtcblx0XHRcdFx0XHRcdHdpbmRvdy5sbG1zLm1ldGFib3hlcy5pbml0KCk7XG5cdFx0XHRcdFx0XHRzZWxmLnVwZGF0ZV9wbGFuX29yZGVycygpO1xuXG5cdFx0XHRcdFx0XHQvLyBub3RpZnkgdGhlIGJsb2NrIGVkaXRvclxuXHRcdFx0XHRcdFx0c2VsZi50cmlnZ2VyX3VwZGF0ZV9ob29rKCk7XG5cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSxcblxuXHRcdFx0fSApO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDb250cm9sIHRoZSBzdGF0dXMgb2YgdGhlIFwiTmV3IEFjY2VzcyBQbGFuXCIgQnV0dG9uXG5cdFx0ICogRW5hYmxlcyAvIERpc2FibGVzIHRoZSBidXR0b24gYW5kIHNob3dzIC8gaGlkZXMgdGhlIGFzc29jaWF0ZWQgbWVzc2FnZVxuXHRcdCAqXG5cdFx0ICogQHBhcmFtICBzdHJpbmcgc3RhdHVzICAgIGVuYWJsZSBvciBkaXNhYmxlXG5cdFx0ICogQHJldHVybiB2b2lkXG5cdFx0ICogQHNpbmNlICAzLjAuMFxuXHRcdCAqIEBzaW5jZSAgW3ZlcnNpb25dXG5cdFx0ICovXG5cdFx0dGhpcy50b2dnbGVfY3JlYXRlX2J1dHRvbiA9IGZ1bmN0aW9uKCBzdGF0dXMgKSB7XG5cblx0XHRcdHZhciAkYnRuID0gJCggJyNsbG1zLW5ldy1hY2Nlc3MtcGxhbicgKTtcblxuXHRcdFx0aWYgKCAnZGlzYWJsZScgPT09IHN0YXR1cyApIHtcblx0XHRcdFx0JGJ0bi5hdHRyKCAnZGlzYWJsZWQnLCAnZGlzYWJsZWQnICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQkYnRuLnJlbW92ZUF0dHIoICdkaXNhYmxlZCcgKTtcblx0XHRcdH1cblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBWaXN1YWxseSBoaWRlIGFuZCB0aGVuIHBoeXNpY2FsbHkgcmVtb3ZlIGEgcGxhbiBlbGVtZW50IGZyb20gdGhlIERPTVxuXHRcdCAqIEFkZGl0aW9uYWxseSBkZXRlcm1pbmVzIGlmIHRoZSBOZXcgUGxhbiBCdXR0b24gc2hvdWxkIGJlIHJlLWVuYWJsZWRcblx0XHQgKiBhZnRlciBkZWxldGlvblxuXHRcdCAqXG5cdFx0ICogQHBhcmFtICBvYmogICAkcGxhbiBqUXVlcnkgc2VsZWN0b3Igb2YgdGhlIHBsYW4gZWxlbWVudFxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqIEBzaW5jZSAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMucmVtb3ZlX3BsYW5fZWwgPSBmdW5jdGlvbiggJHBsYW4gKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0Ly8gZmFkZSBvdXQgbmljZWx5XG5cdFx0XHQkcGxhbi5mYWRlT3V0KCA0MDAgKTtcblxuXHRcdFx0Ly8gcmVtb3ZlIGZyb20gZG9tIGFmdGVyIGl0J3MgaGlkZGVuIHZpc3VhbGx5XG5cdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdCRwbGFuLnJlbW92ZSgpO1xuXG5cdFx0XHRcdC8vIGNoZWNrIGlmIHdlIG5lZWQgdG8gcmVlbmFibGUgdGhlIGNyZWF0ZSBidXR0b24gYW5kIGhpZGUgdGhlIG1lc3NhZ2Vcblx0XHRcdFx0aWYgKCAhIHNlbGYuaGFzX3BsYW5fbGltaXRfYmVlbl9yZWFjaGVkKCkgKSB7XG5cdFx0XHRcdFx0c2VsZi50b2dnbGVfY3JlYXRlX2J1dHRvbiggJ2VuYWJsZScgKTtcblx0XHRcdFx0fVxuXHRcdFx0fSwgNDUwICk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogVHJpZ2dlciBXUCBCbG9jayBFZGl0b3IgaG9vayBzbyB0aGUgcHJpY2luZyB0YWJsZSBibG9jayBjYW4gYmUgcmUtcmVuZGVyZWQgd2l0aCBuZXcgcGxhbiBpbmZvcm1hdGlvbi5cblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gIHZvaWRcblx0XHQgKiBAc2luY2UgICBbdmVyc2lvbl1cblx0XHQgKiBAdmVyc2lvbiBbdmVyc2lvbl1cblx0XHQgKi9cblx0XHR0aGlzLnRyaWdnZXJfdXBkYXRlX2hvb2sgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0JCggZG9jdW1lbnQgKS50cmlnZ2VyKCAnbGxtcy1hY2Nlc3MtcGxhbnMtdXBkYXRlZCcgKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZW9yZGVyIHRoZSBhcnJheSBpbmRleGVzIGFuZCB0aGUgbWVudSBvcmRlciBoaWRkZW4gaW5wdXRzXG5cdFx0ICogQ2FsbGVkIGJ5IGpRdWVyeSBVSSBTb3J0YWJsZSBvbiBzb3J0IGNvbXBsZXRpb25cblx0XHQgKiBBbHNvIGNhbGxlZCBhZnRlciBhZGRpbmcgYSBuZXcgcGxhbiB0byB0aGUgRE9NIHNvIHRoZSBuZXdlc3QgaXRlbSBpcyBhbHdheXNcblx0XHQgKiBwZXJzaXN0ZWQgYXMgdGhlIGxhc3QgaW4gdGhlIGRhdGFiYXNlIGlmIG5vIFVYIHJlb3JkZXJzIHRoZSBpdGVtXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuIHZvaWRcblx0XHQgKiBAc2luY2UgIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy51cGRhdGVfcGxhbl9vcmRlcnMgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0JCggJyNsbG1zLWFjY2Vzcy1wbGFucyAubGxtcy1hY2Nlc3MtcGxhbicgKS5lYWNoKCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHR2YXIgJHAgPSAkKCB0aGlzICksXG5cdFx0XHRcdFx0JG9yZGVyID0gJHAuZmluZCggJy5wbGFuLW9yZGVyJyApLFxuXHRcdFx0XHRcdCRlZGl0b3IgPSAkcC5maW5kKCAndGV4dGFyZWFbaWRePVwiX2xsbXNfcGxhbnNfY29udGVudF9cIl0nICksXG5cdFx0XHRcdFx0ZWRpdG9yX2lkID0gJGVkaXRvci5hdHRyKCAnaWQnICksXG5cdFx0XHRcdFx0b3JpZyA9ICRvcmRlci52YWwoKSAqIDEsXG5cdFx0XHRcdFx0Y3VyciA9ICRwLmluZGV4KCk7XG5cblx0XHRcdFx0Ly8gZGUtaW5pdCB0aW55TUNFIGZyb20gdGhlIGVkaXRvclxuXHRcdFx0XHR0aW55TUNFLkVkaXRvck1hbmFnZXIuZXhlY0NvbW1hbmQoICdtY2VSZW1vdmVFZGl0b3InLCB0cnVlLCBlZGl0b3JfaWQgKTtcblxuXHRcdFx0XHQvLyB1cGRhdGUgdGhlIG9yZGVyIG9mIGVhY2ggZmllbGQgaW4gdGhlIHBsYW5cblx0XHRcdFx0JHAuZmluZCggJ3NlbGVjdCwgaW5wdXQsIHRleHRhcmVhJyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdFx0dmFyIG5hbWUgPSAkKCB0aGlzICkuYXR0ciggJ25hbWUnICk7XG5cdFx0XHRcdFx0aWYgKCBuYW1lICkge1xuXHRcdFx0XHRcdFx0JCggdGhpcyApLmF0dHIoICduYW1lJywgbmFtZS5yZXBsYWNlKCBvcmlnLCBjdXJyICkgKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdC8vIHJlLWluaXQgdGlueU1DRSBvbiB0aGUgZWRpdG9yXG5cdFx0XHRcdHRpbnlNQ0UuRWRpdG9yTWFuYWdlci5leGVjQ29tbWFuZCggJ21jZUFkZEVkaXRvcicsIHRydWUsIGVkaXRvcl9pZCApO1xuXG5cdFx0XHRcdCRvcmRlci52YWwoIGN1cnIgKTtcblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8vIGdvXG5cdFx0dGhpcy5pbml0KCk7XG5cblx0fTtcblxuXHR2YXIgYSA9IG5ldyB3aW5kb3cubGxtcy5tZXRhYm94X3Byb2R1Y3QoKTtcblxufSApKCBqUXVlcnkgKTtcbiJdfQ==
