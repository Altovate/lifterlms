!function(t,a){window.llms=window.llms||{};var e=function(){return this.charts_loaded=!1,this.data={},this.query=t.parseJSON(t("#llms-analytics-json").text()),this.timeout=8e3,this.$widgets=t(".llms-widget[data-method]"),this.init=function(){google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(this.charts_ready),this.bind(),this.load_widgets()},this.bind=function(){t(".llms-datepicker").datepicker({dateFormat:"yy-mm-dd",maxDate:0}),t("#llms-students-ids-filter").llmsStudentsSelect2({multiple:!0,placeholder:LLMS.l10n.translate("Filter by Student(s)")}),t('a[href="#llms-toggle-filters"]').on("click",function(a){a.preventDefault(),t(".llms-analytics-filters").slideToggle(100)}),t("#llms-custom-date-submit").on("click",function(){t('input[name="range"]').val("custom")}),t("#llms-date-quick-filters a.llms-nav-link[data-range]").on("click",function(a){a.preventDefault(),t('input[name="range"]').val(t(this).attr("data-range")),t("form.llms-reporting-nav").submit()})},this.charts_ready=function(){window.llms.analytics.charts_loaded=!0,window.llms.analytics.draw_chart()},this.draw_chart=function(){if(this.charts_loaded&&this.is_loading_finished()){var t=document.getElementById("llms-charts-wrapper");if(t){var a=this,e=new google.visualization.ComboChart(t),i=a.get_chart_data(),s={chartArea:{height:"75%",width:"85%"},colors:["#606C38","#E85D75","#EF8354","#C64191","#731963"],height:560,lineWidth:4,seriesType:"bars",series:a.get_chart_series_options(),vAxes:{0:{format:"currency"},1:{format:""}}};i.length&&(i=google.visualization.arrayToDataTable(i),i.sort([{column:0}]),e.draw(i,s))}}},this.is_loading_finished=function(){return!t(".llms-widget.is-loading").length},this.load_widgets=function(){var a=this;this.$widgets.each(function(){a.load_widget(t(this))})},this.load_widget=function(a){var e,i=this,s=a.attr("data-method"),r=a.find("h1"),n=a.find(".llms-reload-widget"),d=LLMS.l10n.translate("Error");a.addClass("is-loading"),t.ajax({data:{action:"llms_widget_"+s,dates:i.query.dates,courses:i.query.current_courses,memberships:i.query.current_memberships,students:i.query.current_students},method:"POST",timeout:i.timeout,url:window.ajaxurl,success:function(t){e="success","undefined"!=typeof t.response&&(d=t.response,i.data[s]={chart_data:t.chart_data,response:t.response,results:t.results},n.remove())},error:function(t){e="error"},complete:function(s){"error"===e&&(d="timeout"===s.statusText?LLMS.l10n.translate("Request timed out"):LLMS.l10n.translate("Error"),n.length||(n=t('<a class="llms-reload-widget" href="#">'+LLMS.l10n.translate("Retry")+"</a>"),n.on("click",function(t){t.preventDefault(),i.load_widget(a)}),a.append(n))),a.removeClass("is-loading"),r.html(d),i.widget_finished(a)}})},this.get_date_diff=function(){var t=new Date(this.query.dates.end),a=new Date(this.query.dates.start);return Math.abs(t.getTime()-a.getTime())},this.get_chart_data_object=function(){var t,a,e,i,s=this,r=10368e6,n=this.get_date_diff(),d={};for(var l in s.data)if(s.data.hasOwnProperty(l)&&"object"==typeof s.data[l].chart_data&&"object"==typeof s.data[l].results&&(t=s.data[l].results))for(a=0;a<t.length;a++)switch(e=this.init_date(t[a].date),i=n<=r?new Date(e.getFullYear(),e.getMonth(),e.getDate()):new Date(e.getFullYear(),e.getMonth(),1),d[i]||(d[i]=this.get_empty_data_object(i)),s.data[l].chart_data.type){case"amount":d[i][l]=d[i][l]+1*t[a][s.data[l].chart_data.key];break;case"count":default:d[i][l]++}return d},this.get_chart_data=function(){var t=this,a=t.get_chart_data_object(),e=t.get_chart_headers();for(var i in a)if(a.hasOwnProperty(i)){var s=[a[i]._date];for(var r in a[i])a[i].hasOwnProperty(r)&&0!==r.indexOf("_")&&s.push(a[i][r]);e.push(s)}return e},this.get_empty_data_object=function(t){var a=this,e={_date:t};for(var i in a.data)a.data.hasOwnProperty(i)&&a.data[i].chart_data&&(e[i]=0);return e},this.get_chart_headers=function(){var t=this,a=[];a.push({label:LLMS.l10n.translate("Date"),id:"date",type:"date"});for(var e in t.data)t.data.hasOwnProperty(e)&&t.data[e].chart_data&&a.push(t.data[e].chart_data.header);return[a]},this.get_chart_series_options=function(){var t=this,a={};i=0;for(var e in t.data)if(t.data.hasOwnProperty(e)){if(t.data[e].chart_data){var s=t.data[e].chart_data.type;a[i]={type:"count"===s?"bars":"line",targetAxisIndex:"count"===s?1:0}}i++}return a},this.init_date=function(t){var a,e,i;return a=t.split(" "),e=a[0].split("-"),i=a[1].split(":"),new Date(e[0],e[1]-1,e[2],i[0],i[1],i[2])},this.widget_finished=function(t){this.is_loading_finished()&&this.draw_chart()},this.init(),this};window.llms.analytics=new e}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxsbXMtYW5hbHl0aWNzLmpzIl0sIm5hbWVzIjpbIiQiLCJ1bmRlZmluZWQiLCJ3aW5kb3ciLCJsbG1zIiwiQW5hbHl0aWNzIiwidGhpcyIsImNoYXJ0c19sb2FkZWQiLCJkYXRhIiwicXVlcnkiLCJwYXJzZUpTT04iLCJ0ZXh0IiwidGltZW91dCIsIiR3aWRnZXRzIiwiaW5pdCIsImdvb2dsZSIsImNoYXJ0cyIsImxvYWQiLCJwYWNrYWdlcyIsInNldE9uTG9hZENhbGxiYWNrIiwiY2hhcnRzX3JlYWR5IiwiYmluZCIsImxvYWRfd2lkZ2V0cyIsImRhdGVwaWNrZXIiLCJkYXRlRm9ybWF0IiwibWF4RGF0ZSIsImxsbXNTdHVkZW50c1NlbGVjdDIiLCJtdWx0aXBsZSIsInBsYWNlaG9sZGVyIiwiTExNUyIsImwxMG4iLCJ0cmFuc2xhdGUiLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInNsaWRlVG9nZ2xlIiwidmFsIiwiYXR0ciIsInN1Ym1pdCIsImFuYWx5dGljcyIsImRyYXdfY2hhcnQiLCJpc19sb2FkaW5nX2ZpbmlzaGVkIiwiZWwiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwic2VsZiIsImNoYXJ0IiwidmlzdWFsaXphdGlvbiIsIkNvbWJvQ2hhcnQiLCJnZXRfY2hhcnRfZGF0YSIsIm9wdGlvbnMiLCJjaGFydEFyZWEiLCJoZWlnaHQiLCJ3aWR0aCIsImNvbG9ycyIsImxpbmVXaWR0aCIsInNlcmllc1R5cGUiLCJzZXJpZXMiLCJnZXRfY2hhcnRfc2VyaWVzX29wdGlvbnMiLCJ2QXhlcyIsIjAiLCJmb3JtYXQiLCIxIiwibGVuZ3RoIiwiYXJyYXlUb0RhdGFUYWJsZSIsInNvcnQiLCJjb2x1bW4iLCJkcmF3IiwiZWFjaCIsImxvYWRfd2lkZ2V0IiwiJHdpZGdldCIsInN0YXR1cyIsIm1ldGhvZCIsIiRjb250ZW50IiwiZmluZCIsIiRyZXRyeSIsImNvbnRlbnRfdGV4dCIsImFkZENsYXNzIiwiYWpheCIsImFjdGlvbiIsImRhdGVzIiwiY291cnNlcyIsImN1cnJlbnRfY291cnNlcyIsIm1lbWJlcnNoaXBzIiwiY3VycmVudF9tZW1iZXJzaGlwcyIsInN0dWRlbnRzIiwiY3VycmVudF9zdHVkZW50cyIsInVybCIsImFqYXh1cmwiLCJzdWNjZXNzIiwiciIsInJlc3BvbnNlIiwiY2hhcnRfZGF0YSIsInJlc3VsdHMiLCJyZW1vdmUiLCJlcnJvciIsImNvbXBsZXRlIiwic3RhdHVzVGV4dCIsImFwcGVuZCIsInJlbW92ZUNsYXNzIiwiaHRtbCIsIndpZGdldF9maW5pc2hlZCIsImdldF9kYXRlX2RpZmYiLCJlbmQiLCJEYXRlIiwic3RhcnQiLCJNYXRoIiwiYWJzIiwiZ2V0VGltZSIsImdldF9jaGFydF9kYXRhX29iamVjdCIsInJlcyIsImkiLCJkIiwiZGF0ZSIsIm1heF9mb3JfZGF5cyIsImRpZmYiLCJoYXNPd25Qcm9wZXJ0eSIsImluaXRfZGF0ZSIsImdldEZ1bGxZZWFyIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZ2V0X2VtcHR5X2RhdGFfb2JqZWN0IiwidHlwZSIsImtleSIsIm9iaiIsImdldF9jaGFydF9oZWFkZXJzIiwicm93IiwiX2RhdGUiLCJpdGVtIiwiaW5kZXhPZiIsInB1c2giLCJoIiwibGFiZWwiLCJpZCIsImhlYWRlciIsInRhcmdldEF4aXNJbmRleCIsInN0cmluZyIsInBhcnRzIiwidGltZSIsInNwbGl0IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQ0FLQyxTQUFZQSxFQUFHQyxHQUVmQyxPQUFPQyxLQUFPRCxPQUFPQyxRQU9yQixJQUFJQyxHQUFZLFdBd2hCZixNQXRoQkFDLE1BQUtDLGVBQWdCLEVBQ3JCRCxLQUFLRSxRQUNMRixLQUFLRyxNQUFRUixFQUFFUyxVQUFXVCxFQUFHLHdCQUF5QlUsUUFDdERMLEtBQUtNLFFBQVUsSUFFZk4sS0FBS08sU0FBV1osRUFBRyw2QkFRbkJLLEtBQUtRLEtBQU8sV0FFWEMsT0FBT0MsT0FBT0MsS0FBTSxXQUNuQkMsVUFDQyxlQUdHSCxPQUFPQyxPQUFPRyxrQkFBbUJiLEtB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LE9BS3pDLFFBQVNILElBVVY3SCxLQUFLb0QseUJBQTJCLFdBRS9CLEdBQUliLEdBQU92QyxLQUNWNEMsSUFDQTZELEdBQUksQ0FFTCxLQUFNLEdBQUl2QyxLQUFVM0IsR0FBS3JDLEtBQ3hCLEdBQU9xQyxFQUFLckMsS0FBSzRHLGVBQWdCNUMsR0FBakMsQ0FJQSxHQUFLM0IsRUFBS3JDLEtBQU1nRSxHQUFTb0IsV0FBYSxDQUVyQyxHQUFJOEIsR0FBTzdFLEVBQUtyQyxLQUFNZ0UsR0FBU29CLFdBQVc4QixJQUUxQ3hFLEdBQVM2RCxJQUNSVyxLQUFRLFVBQVlBLEVBQVMsT0FBUyxPQUN0Q2EsZ0JBQW1CLFVBQVliLEVBQVMsRUFBSSxHQUs5Q1gsSUFJRCxNQUFPN0QsSUFXUjVDLEtBQUsrRyxVQUFZLFNBQVVtQixHQUUxQixHQUFJQyxHQUFPeEIsRUFBTXlCLENBT2pCLE9BTEFELEdBQVFELEVBQU9HLE1BQU8sS0FFdEIxQixFQUFPd0IsRUFBTSxHQUFHRSxNQUFPLEtBQ3ZCRCxFQUFPRCxFQUFNLEdBQUdFLE1BQU8sS0FFaEIsR0FBSW5DLE1BQU1TLEVBQUssR0FBSUEsRUFBSyxHQUFLLEVBQUdBLEVBQUssR0FBSXlCLEVBQUssR0FBSUEsRUFBSyxHQUFJQSxFQUFLLEtBWXhFcEksS0FBSytGLGdCQUFrQixTQUFVL0IsR0FFM0JoRSxLQUFLbUMsdUJBQ1RuQyxLQUFLa0MsY0FNUGxDLEtBQUtRLE9BR0VSLEtBSVJILFFBQU9DLEtBQUttQyxVQUFZLEdBQUlsQyxJQUV4QnVJIiwiZmlsZSI6ImxsbXMtYW5hbHl0aWNzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGlmdGVyTE1TIEFkbWluIFJlcG9ydGluZyBXaWRnZXRzICYgQ2hhcnRzXG4gKiBAc2luY2UgICAgMy4wLjBcbiAqIEB2ZXJzaW9uICAzLjE3LjZcbiAqL1xuOyggZnVuY3Rpb24oICQsIHVuZGVmaW5lZCApIHtcblxuXHR3aW5kb3cubGxtcyA9IHdpbmRvdy5sbG1zIHx8IHt9O1xuXG5cdC8qKlxuXHQgKiBMaWZ0ZXJMTVMgQWRtaW4gQW5hbHl0aWNzXG5cdCAqIEBzaW5jZSAgICAzLjAuMFxuXHQgKiBAdmVyc2lvbiAgMy41LjBcblx0ICovXG5cdHZhciBBbmFseXRpY3MgPSBmdW5jdGlvbigpIHtcblxuXHRcdHRoaXMuY2hhcnRzX2xvYWRlZCA9IGZhbHNlO1xuXHRcdHRoaXMuZGF0YSA9IHt9O1xuXHRcdHRoaXMucXVlcnkgPSAkLnBhcnNlSlNPTiggJCggJyNsbG1zLWFuYWx5dGljcy1qc29uJyApLnRleHQoKSApO1xuXHRcdHRoaXMudGltZW91dCA9IDgwMDA7XG5cblx0XHR0aGlzLiR3aWRnZXRzID0gJCggJy5sbG1zLXdpZGdldFtkYXRhLW1ldGhvZF0nICk7XG5cblx0XHQvKipcblx0XHQgKiBJbml0aWFsaXplclxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5pbml0ID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdGdvb2dsZS5jaGFydHMubG9hZCggJ2N1cnJlbnQnLCB7XG5cdFx0XHRcdHBhY2thZ2VzOiBbXG5cdFx0XHRcdFx0J2NvcmVjaGFydCdcblx0XHRcdFx0XVxuXHRcdFx0fSApO1xuICAgICAgXHRcdGdvb2dsZS5jaGFydHMuc2V0T25Mb2FkQ2FsbGJhY2soIHRoaXMuY2hhcnRzX3JlYWR5ICk7XG5cblx0XHRcdHRoaXMuYmluZCgpO1xuXHRcdFx0dGhpcy5sb2FkX3dpZGdldHMoKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBCaW5kIERPTSBldmVudHNcblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuYmluZCA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHQkKCAnLmxsbXMtZGF0ZXBpY2tlcicgKS5kYXRlcGlja2VyKCB7XG5cdFx0XHRcdGRhdGVGb3JtYXQ6ICd5eS1tbS1kZCcsXG5cdFx0XHRcdG1heERhdGU6IDAsXG5cdFx0XHR9ICk7XG5cblxuXHRcdFx0JCggJyNsbG1zLXN0dWRlbnRzLWlkcy1maWx0ZXInICkubGxtc1N0dWRlbnRzU2VsZWN0Migge1xuXHRcdFx0XHRtdWx0aXBsZTogdHJ1ZSxcblx0XHRcdFx0cGxhY2Vob2xkZXI6IExMTVMubDEwbi50cmFuc2xhdGUoICdGaWx0ZXIgYnkgU3R1ZGVudChzKScgKSxcblx0XHRcdH0gKTtcblxuXHRcdFx0JCggJ2FbaHJlZj1cIiNsbG1zLXRvZ2dsZS1maWx0ZXJzXCJdJyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHQkKCAnLmxsbXMtYW5hbHl0aWNzLWZpbHRlcnMnICkuc2xpZGVUb2dnbGUoIDEwMCApO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQkKCAnI2xsbXMtY3VzdG9tLWRhdGUtc3VibWl0JyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0JCggJ2lucHV0W25hbWU9XCJyYW5nZVwiXScgKS52YWwoICdjdXN0b20nICk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdCQoICcjbGxtcy1kYXRlLXF1aWNrLWZpbHRlcnMgYS5sbG1zLW5hdi1saW5rW2RhdGEtcmFuZ2VdJyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCQoICdpbnB1dFtuYW1lPVwicmFuZ2VcIl0nICkudmFsKCAkKCB0aGlzICkuYXR0ciggJ2RhdGEtcmFuZ2UnICkgKTtcblxuXHRcdFx0XHQkKCAnZm9ybS5sbG1zLXJlcG9ydGluZy1uYXYnICkuc3VibWl0KCk7XG5cblx0XHRcdH0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDYWxsZWQgIGJ5IEdvb2dsZSBDaGFydHMgd2hlbiB0aGUgbGlicmFyeSBpcyBsb2FkZWQgYW5kIHJlYWR5XG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmNoYXJ0c19yZWFkeSA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR3aW5kb3cubGxtcy5hbmFseXRpY3MuY2hhcnRzX2xvYWRlZCA9IHRydWU7XG5cdFx0XHR3aW5kb3cubGxtcy5hbmFseXRpY3MuZHJhd19jaGFydCgpO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJlbmRlciB0aGUgY2hhcnRcblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjE3LjZcblx0XHQgKi9cblx0XHR0aGlzLmRyYXdfY2hhcnQgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0aWYgKCAhIHRoaXMuY2hhcnRzX2xvYWRlZCB8fCAhIHRoaXMuaXNfbG9hZGluZ19maW5pc2hlZCgpICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnbGxtcy1jaGFydHMtd3JhcHBlcicgKTtcblxuXHRcdFx0aWYgKCAhIGVsICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0Y2hhcnQgPSBuZXcgZ29vZ2xlLnZpc3VhbGl6YXRpb24uQ29tYm9DaGFydCggZWwgKSxcblx0XHRcdFx0ZGF0YSA9IHNlbGYuZ2V0X2NoYXJ0X2RhdGEoKSxcblx0XHRcdFx0b3B0aW9ucyA9IHtcblx0XHRcdFx0XHRjaGFydEFyZWE6IHtcblx0XHRcdFx0XHRcdGhlaWdodDogJzc1JScsXG5cdFx0XHRcdFx0XHR3aWR0aDogJzg1JScsXG5cdFx0XHRcdFx0XHQvLyBib3R0b206IDIwLFxuXHRcdFx0XHRcdFx0Ly8gbGVmdDogMjAsXG5cdFx0XHRcdFx0XHQvLyByaWdodDogMjAsXG5cdFx0XHRcdFx0XHQvLyB0b3A6IDIwLFxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Y29sb3JzOiBbJyM2MDZDMzgnLCcjRTg1RDc1JywnI0VGODM1NCcsJyNDNjQxOTEnLCcjNzMxOTYzJ10sXG5cdFx0XHRcdFx0aGVpZ2h0OiA1NjAsXG5cdFx0XHRcdFx0bGluZVdpZHRoOiA0LFxuXHRcdFx0XHRcdHNlcmllc1R5cGU6ICdiYXJzJyxcblx0XHRcdFx0XHRzZXJpZXM6IHNlbGYuZ2V0X2NoYXJ0X3Nlcmllc19vcHRpb25zKCksXG5cdFx0XHRcdFx0dkF4ZXM6IHtcblx0XHRcdFx0XHRcdDA6IHtcblx0XHRcdFx0XHRcdFx0Zm9ybWF0OiAnY3VycmVuY3knLFxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdDE6IHtcblx0XHRcdFx0XHRcdFx0Zm9ybWF0OiAnJyxcblx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0fTtcblx0XHRcdFx0Ly8gZGF0YSA9IGdvb2dsZS52aXN1YWxpemF0aW9uLmFycmF5VG9EYXRhVGFibGUoIFtcblx0XHRcdFx0Ly8gXHQvLyBbJ01vbnRoJywgJ0JvbGl2aWEnLCAnRWN1YWRvcicsICdNYWRhZ2FzY2FyJywgJ1BhcHVhIE5ldyBHdWluZWEnLCAnUndhbmRhJywgJ0F2ZXJhZ2UnXSxcblx0XHRcdFx0Ly8gXHQvLyBbJzIwMDQvMDUnLCAgMTY1LCAgICAgIDkzOCwgICAgICAgICA1MjIsICAgICAgICAgICAgIDk5OCwgICAgICAgICAgIDQ1MCwgICAgICA2MTQuNl0sXG5cdFx0XHRcdC8vIFx0Ly8gWycyMDA1LzA2JywgIDEzNSwgICAgICAxMTIwLCAgICAgICAgNTk5LCAgICAgICAgICAgICAxMjY4LCAgICAgICAgICAyODgsICAgICAgNjgyXSxcblx0XHRcdFx0Ly8gXHQvLyBbJzIwMDYvMDcnLCAgMTU3LCAgICAgIDExNjcsICAgICAgICA1ODcsICAgICAgICAgICAgIDgwNywgICAgICAgICAgIDM5NywgICAgICA2MjNdLFxuXHRcdFx0XHQvLyBcdC8vIFsnMjAwNy8wOCcsICAxMzksICAgICAgMTExMCwgICAgICAgIDYxNSwgICAgICAgICAgICAgOTY4LCAgICAgICAgICAgMjE1LCAgICAgIDYwOS40XSxcblx0XHRcdFx0Ly8gXHQvLyBbJzIwMDgvMDknLCAgMTM2LCAgICAgIDY5MSwgICAgICAgICA2MjksICAgICAgICAgICAgIDEwMjYsICAgICAgICAgIDM2NiwgICAgICA1NjkuNl1cblx0XHRcdFx0Ly8gXSApXG5cblx0XHRcdGlmICggZGF0YS5sZW5ndGggKSB7XG5cblx0XHRcdFx0ZGF0YSA9IGdvb2dsZS52aXN1YWxpemF0aW9uLmFycmF5VG9EYXRhVGFibGUoIGRhdGEgKTtcblx0XHRcdFx0ZGF0YS5zb3J0KFt7Y29sdW1uOiAwfV0pXG5cdFx0XHRcdGNoYXJ0LmRyYXcoIGRhdGEsIG9wdGlvbnMgKTtcblxuXHRcdFx0fVxuXG5cblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDaGVjayBpZiBhIHdpZGdldCBpcyBzdGlsbCBsb2FkaW5nXG5cdFx0ICogQHJldHVybiAgIGJvb2xcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmlzX2xvYWRpbmdfZmluaXNoZWQgPSBmdW5jdGlvbigpIHtcblx0XHRcdGlmICggJCggJy5sbG1zLXdpZGdldC5pcy1sb2FkaW5nJyApLmxlbmd0aCApIHtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFN0YXJ0IGxvYWRpbmcgYWxsIHdpZGdldHMgb24gdGhlIGN1cnJlbnQgc2NyZWVuXG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmxvYWRfd2lkZ2V0cyA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdHRoaXMuJHdpZGdldHMuZWFjaCggZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0c2VsZi5sb2FkX3dpZGdldCggJCggdGhpcyApICk7XG5cblx0XHRcdH0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBMb2FkIGEgc3BlY2lmaWMgd2lkZ2V0XG5cdFx0ICogQHBhcmFtICAgIG9iaiAgICR3aWRnZXQgIGpRdWVyeSBzZWxlY3RvciBvZiB0aGUgd2lkZ2V0IGVsZW1lbnRcblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjE2Ljhcblx0XHQgKi9cblx0XHR0aGlzLmxvYWRfd2lkZ2V0ID0gZnVuY3Rpb24oICR3aWRnZXQgKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0bWV0aG9kID0gJHdpZGdldC5hdHRyKCAnZGF0YS1tZXRob2QnICksXG5cdFx0XHRcdCRjb250ZW50ID0gJHdpZGdldC5maW5kKCAnaDEnICksXG5cdFx0XHRcdCRyZXRyeSA9ICR3aWRnZXQuZmluZCggJy5sbG1zLXJlbG9hZC13aWRnZXQnICksXG5cdFx0XHRcdGNvbnRlbnRfdGV4dCA9IExMTVMubDEwbi50cmFuc2xhdGUoICdFcnJvcicgKSxcblx0XHRcdFx0c3RhdHVzO1xuXG5cdFx0XHQkd2lkZ2V0LmFkZENsYXNzKCAnaXMtbG9hZGluZycgKTtcblxuXHRcdFx0JC5hamF4KCB7XG5cblx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdGFjdGlvbjogJ2xsbXNfd2lkZ2V0XycgKyBtZXRob2QsXG5cdFx0XHRcdFx0ZGF0ZXM6IHNlbGYucXVlcnkuZGF0ZXMsXG5cdFx0XHRcdFx0Y291cnNlczogc2VsZi5xdWVyeS5jdXJyZW50X2NvdXJzZXMsXG5cdFx0XHRcdFx0bWVtYmVyc2hpcHM6IHNlbGYucXVlcnkuY3VycmVudF9tZW1iZXJzaGlwcyxcblx0XHRcdFx0XHRzdHVkZW50czogc2VsZi5xdWVyeS5jdXJyZW50X3N0dWRlbnRzLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHRtZXRob2Q6ICdQT1NUJyxcblx0XHRcdFx0dGltZW91dDogc2VsZi50aW1lb3V0LFxuXHRcdFx0XHR1cmw6IHdpbmRvdy5hamF4dXJsLFxuXHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbiggciApIHtcblxuXHRcdFx0XHRcdHN0YXR1cyA9ICdzdWNjZXNzJztcblxuXHRcdFx0XHRcdGlmKCAndW5kZWZpbmVkJyAhPT0gdHlwZW9mIHIucmVzcG9uc2UgKSB7XG5cblx0XHRcdFx0XHRcdGNvbnRlbnRfdGV4dCA9IHIucmVzcG9uc2U7XG5cblx0XHRcdFx0XHRcdHNlbGYuZGF0YVttZXRob2RdID0ge1xuXHRcdFx0XHRcdFx0XHRjaGFydF9kYXRhOiByLmNoYXJ0X2RhdGEsXG5cdFx0XHRcdFx0XHRcdHJlc3BvbnNlOiByLnJlc3BvbnNlLFxuXHRcdFx0XHRcdFx0XHRyZXN1bHRzOiByLnJlc3VsdHMsXG5cdFx0XHRcdFx0XHR9O1xuXG5cdFx0XHRcdFx0XHQkcmV0cnkucmVtb3ZlKCk7XG5cblx0XHRcdFx0XHR9XG5cblxuXHRcdFx0XHR9LFxuXHRcdFx0XHRlcnJvcjogZnVuY3Rpb24oIHIgKSB7XG5cblx0XHRcdFx0XHRzdGF0dXMgPSAnZXJyb3InO1xuXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGNvbXBsZXRlOiBmdW5jdGlvbiggciApIHtcblxuXHRcdFx0XHRcdGlmICggJ2Vycm9yJyA9PT0gc3RhdHVzICkge1xuXG5cdFx0XHRcdFx0XHRpZiggJ3RpbWVvdXQnID09PSByLnN0YXR1c1RleHQgKSB7XG5cblx0XHRcdFx0XHRcdFx0Y29udGVudF90ZXh0ID0gTExNUy5sMTBuLnRyYW5zbGF0ZSggJ1JlcXVlc3QgdGltZWQgb3V0JyApO1xuXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdGNvbnRlbnRfdGV4dCA9IExMTVMubDEwbi50cmFuc2xhdGUoICdFcnJvcicgKTtcblxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoICEgJHJldHJ5Lmxlbmd0aCApIHtcblxuXHRcdFx0XHRcdFx0XHQkcmV0cnkgPSAkKCAnPGEgY2xhc3M9XCJsbG1zLXJlbG9hZC13aWRnZXRcIiBocmVmPVwiI1wiPicgKyBMTE1TLmwxMG4udHJhbnNsYXRlKCAnUmV0cnknICkgKyAnPC9hPicgKTtcblx0XHRcdFx0XHRcdFx0JHJldHJ5Lm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblxuXHRcdFx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdFx0XHRzZWxmLmxvYWRfd2lkZ2V0KCAkd2lkZ2V0ICk7XG5cblx0XHRcdFx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdFx0XHRcdCR3aWRnZXQuYXBwZW5kKCAkcmV0cnkgKTtcblxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0JHdpZGdldC5yZW1vdmVDbGFzcyggJ2lzLWxvYWRpbmcnICk7XG5cdFx0XHRcdFx0JGNvbnRlbnQuaHRtbCggY29udGVudF90ZXh0ICk7XG5cblx0XHRcdFx0XHRzZWxmLndpZGdldF9maW5pc2hlZCggJHdpZGdldCApO1xuXG5cdFx0XHRcdH1cblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEdldCB0aGUgdGltZSBpbiBzZWNvbmRzIGJldHdlZW4gdGhlIHF1ZXJpZWQgZGF0ZXNcblx0XHQgKiBAcmV0dXJuICAgaW50XG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5nZXRfZGF0ZV9kaWZmID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBlbmQgPSBuZXcgRGF0ZSggdGhpcy5xdWVyeS5kYXRlcy5lbmQgKSxcblx0XHRcdFx0c3RhcnQgPSBuZXcgRGF0ZSggdGhpcy5xdWVyeS5kYXRlcy5zdGFydCApO1xuXG5cdFx0XHRyZXR1cm4gTWF0aC5hYnMoIGVuZC5nZXRUaW1lKCkgLSBzdGFydC5nZXRUaW1lKCkgKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBCdWlsZHMgYW4gb2JqZWN0IG9mIGRhdGEgdGhhdCBjYW4gYmUgdXNlZCB0bywgdWx0aW1hdGVseSwgZHJhdyB0aGUgc2NyZWVuJ3MgY2hhcnRcblx0XHQgKiBAcmV0dXJuICAgb2JqXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMS42XG5cdFx0ICovXG5cdFx0dGhpcy5nZXRfY2hhcnRfZGF0YV9vYmplY3QgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRtYXhfZm9yX2RheXMgPSAoICggMTAwMCAqIDM2MDAgKiAyNCApICogMzAgKSAqIDQsIC8vIDQgbW9udGhzIGluIHNlY29uZHNcblx0XHRcdFx0ZGlmZiA9IHRoaXMuZ2V0X2RhdGVfZGlmZigpLFxuXHRcdFx0XHRkYXRhID0ge30sXG5cdFx0XHRcdHJlcywgaSwgZCwgZGF0ZTtcblxuXHRcdFx0Zm9yICggdmFyIG1ldGhvZCBpbiBzZWxmLmRhdGEgKSB7XG5cblx0XHRcdFx0aWYgKCAhIHNlbGYuZGF0YS5oYXNPd25Qcm9wZXJ0eSggbWV0aG9kICkgKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoICdvYmplY3QnICE9PSB0eXBlb2Ygc2VsZi5kYXRhWyBtZXRob2QgXS5jaGFydF9kYXRhIHx8ICdvYmplY3QnICE9PSB0eXBlb2Ygc2VsZi5kYXRhWyBtZXRob2QgXS5yZXN1bHRzICkge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmVzID0gc2VsZi5kYXRhWyBtZXRob2QgXS5yZXN1bHRzO1xuXG5cdFx0XHRcdGlmICggcmVzICkge1xuXG5cdFx0XHRcdFx0Zm9yICggaSA9IDA7IGkgPCByZXMubGVuZ3RoOyBpKysgKSB7XG5cblx0XHRcdFx0XHRcdGQgPSB0aGlzLmluaXRfZGF0ZSggcmVzW2ldLmRhdGUgKTtcblxuXHRcdFx0XHRcdFx0Ly8gZ3JvdXAgYnkgZGF5c1xuXHRcdFx0XHRcdFx0aWYgKCBkaWZmIDw9IG1heF9mb3JfZGF5cyApIHtcblx0XHRcdFx0XHRcdFx0ZGF0ZSA9IG5ldyBEYXRlKCBkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgZC5nZXREYXRlKCkgKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdC8vIGdyb3VwIGJ5IG1vbnRoc1xuXHRcdFx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGRhdGUgPSBuZXcgRGF0ZSggZC5nZXRGdWxsWWVhcigpLCBkLmdldE1vbnRoKCksIDEgKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0aWYgKCAhIGRhdGFbIGRhdGUgXSApIHtcblx0XHRcdFx0XHRcdFx0ZGF0YVsgZGF0ZSBdID0gdGhpcy5nZXRfZW1wdHlfZGF0YV9vYmplY3QoIGRhdGUgKVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRzd2l0Y2ggKCBzZWxmLmRhdGFbIG1ldGhvZCBdLmNoYXJ0X2RhdGEudHlwZSApIHtcblxuXHRcdFx0XHRcdFx0XHRjYXNlICdhbW91bnQnOlxuXHRcdFx0XHRcdFx0XHRcdGRhdGFbIGRhdGUgXVsgbWV0aG9kIF0gPSBkYXRhWyBkYXRlIF1bIG1ldGhvZCBdICsgKCByZXNbaV1bIHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YS5rZXkgXSAqIDEgKTtcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdFx0Y2FzZSAnY291bnQnOlxuXHRcdFx0XHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdFx0XHRcdGRhdGFbIGRhdGUgXVsgbWV0aG9kIF0rKztcblx0XHRcdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9XG5cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGRhdGE7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogR2V0IHRoZSBkYXRhIGdvb2dsZSBjaGFydHMgbmVlZHMgdG8gaW5pdGlhdGUgdGhlIGN1cnJlbnQgY2hhcnRcblx0XHQgKiBAcmV0dXJuICAgb2JqXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5nZXRfY2hhcnRfZGF0YSA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdG9iaiA9IHNlbGYuZ2V0X2NoYXJ0X2RhdGFfb2JqZWN0KCksXG5cdFx0XHRcdGRhdGEgPSBzZWxmLmdldF9jaGFydF9oZWFkZXJzKCk7XG5cblx0XHRcdGZvciAoIHZhciBkYXRlIGluIG9iaiApIHtcblxuXHRcdFx0XHRpZiAoICEgb2JqLmhhc093blByb3BlcnR5KCBkYXRlICkgKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR2YXIgcm93ID0gWyBvYmpbIGRhdGUgXS5fZGF0ZSBdO1xuXG5cdFx0XHRcdGZvciAoIHZhciBpdGVtIGluIG9ialsgZGF0ZSBdICkge1xuXHRcdFx0XHRcdGlmICggISBvYmpbIGRhdGUgXS5oYXNPd25Qcm9wZXJ0eSggaXRlbSApICkge1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Ly8gc2tpcCBtZXRhIGl0ZW1zXG5cdFx0XHRcdFx0aWYgKCAwID09PSBpdGVtLmluZGV4T2YoICdfJyApICkge1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cm93LnB1c2goIG9ialsgZGF0ZSBdWyBpdGVtIF0gKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGRhdGEucHVzaCggcm93ICk7XG5cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIGRhdGE7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogR2V0IGEgc3R1YiBvZiB0aGUgZGF0YSBvYmplY3QgdXNlZCBieSB0aGlzLmdldF9kYXRhX29iamVjdFxuXHRcdCAqIEBwYXJhbSAgICBzdHJpbmcgICBkYXRlICBkYXRlIHRvIGludGF0bmlhdGUgdGhlIG9iamVjdCB3aXRoXG5cdFx0ICogQHJldHVybiAgIG9ialxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuZ2V0X2VtcHR5X2RhdGFfb2JqZWN0ID0gZnVuY3Rpb24oIGRhdGUgKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0b2JqID0ge1xuXHRcdFx0XHRcdF9kYXRlOiBkYXRlLFxuXHRcdFx0XHR9O1xuXG5cdFx0XHRmb3IgKCB2YXIgbWV0aG9kIGluIHNlbGYuZGF0YSApIHtcblx0XHRcdFx0aWYgKCAhIHNlbGYuZGF0YS5oYXNPd25Qcm9wZXJ0eSggbWV0aG9kICkgKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YSApIHtcblx0XHRcdFx0XHRvYmpbIG1ldGhvZCBdID0gMDtcblx0XHRcdFx0fVxuXG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBvYmo7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQnVpbGRzIGFuIGFycmF5IG9mIGNoYXJ0IGhlYWRlciBkYXRhXG5cdFx0ICogQHJldHVybiAgIGFycmF5XG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5nZXRfY2hhcnRfaGVhZGVycyA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdGggPSBbXTtcblxuXHRcdFx0Ly8gZGF0ZSBoZWFkZXJzIGdvIGZpcnN0XG5cdFx0XHRoLnB1c2goIHtcblx0XHRcdFx0bGFiZWw6IExMTVMubDEwbi50cmFuc2xhdGUoICdEYXRlJyApLFxuXHRcdFx0XHRpZDogJ2RhdGUnLFxuXHRcdFx0XHR0eXBlOiAnZGF0ZScsXG5cdFx0XHR9ICk7XG5cblxuXHRcdFx0Zm9yICggdmFyIG1ldGhvZCBpbiBzZWxmLmRhdGEgKSB7XG5cdFx0XHRcdGlmICggISBzZWxmLmRhdGEuaGFzT3duUHJvcGVydHkoIG1ldGhvZCApICkge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCBzZWxmLmRhdGFbIG1ldGhvZCBdLmNoYXJ0X2RhdGEgKSB7XG5cdFx0XHRcdFx0aC5wdXNoKCBzZWxmLmRhdGFbIG1ldGhvZCBdLmNoYXJ0X2RhdGEuaGVhZGVyICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gWyBoIF07XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogR2V0IGEgb2JqZWN0IG9mIHNlcmllcyBvcHRpb25zIG5lZWRlZCB0byBkcmF3IHRoZSBjaGFydFxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5nZXRfY2hhcnRfc2VyaWVzX29wdGlvbnMgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRvcHRpb25zID0ge31cblx0XHRcdFx0aSA9IDA7XG5cblx0XHRcdGZvciAoIHZhciBtZXRob2QgaW4gc2VsZi5kYXRhICkge1xuXHRcdFx0XHRpZiAoICEgc2VsZi5kYXRhLmhhc093blByb3BlcnR5KCBtZXRob2QgKSApIHtcblx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggc2VsZi5kYXRhWyBtZXRob2QgXS5jaGFydF9kYXRhICkge1xuXG5cdFx0XHRcdFx0dmFyIHR5cGUgPSBzZWxmLmRhdGFbIG1ldGhvZCBdLmNoYXJ0X2RhdGEudHlwZTtcblxuXHRcdFx0XHRcdG9wdGlvbnNbIGkgXSA9IHtcblx0XHRcdFx0XHRcdHR5cGU6ICggJ2NvdW50JyA9PT0gdHlwZSApID8gJ2JhcnMnIDogJ2xpbmUnLFxuXHRcdFx0XHRcdFx0dGFyZ2V0QXhpc0luZGV4OiAoICdjb3VudCcgPT09IHR5cGUgKSA/IDEgOiAwLFxuXHRcdFx0XHRcdH07XG5cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGkrKztcblxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gb3B0aW9ucztcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBJbnN0YW50aWF0ZSBhIERhdGUgaW5zdGFuY2UgdmlhIGEgZGF0ZSBzdHJpbmdcblx0XHQgKiBAcGFyYW0gICAgc3RyaW5nICAgc3RyaW5nICBkYXRlIHN0cmluZywgZXhwZWN0ZWQgZm9ybWF0IHNob3VsZCBiZSBmcm9tIHBocCBkYXRlKCAnWS1tLWQgSDppOnMnIClcblx0XHQgKiBAcmV0dXJuICAgb2JqXG5cdFx0ICogQHNpbmNlICAgIDMuMS40XG5cdFx0ICogQHZlcnNpb24gIDMuMS41XG5cdFx0ICovXG5cdFx0dGhpcy5pbml0X2RhdGUgPSBmdW5jdGlvbiggc3RyaW5nICkge1xuXG5cdFx0XHR2YXIgcGFydHMsIGRhdGUsIHRpbWU7XG5cblx0XHRcdHBhcnRzID0gc3RyaW5nLnNwbGl0KCAnICcgKTtcblxuXHRcdFx0ZGF0ZSA9IHBhcnRzWzBdLnNwbGl0KCAnLScgKTtcblx0XHRcdHRpbWUgPSBwYXJ0c1sxXS5zcGxpdCggJzonICk7XG5cblx0XHRcdHJldHVybiBuZXcgRGF0ZSggZGF0ZVswXSwgZGF0ZVsxXSAtIDEsIGRhdGVbMl0sIHRpbWVbMF0sIHRpbWVbMV0sIHRpbWVbMl0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDYWxsZWQgd2hlbiBhIHdpZGdldCBpcyBmaW5pc2hlZCBsb2FkaW5nXG5cdFx0ICogVXBkYXRlcyB0aGUgY3VycmVudCBjaGFydCB3aXRoIHRoZSBuZXcgZGF0YSBmcm9tIHRoZSB3aWRnZXRcblx0XHQgKiBAcGFyYW0gICAgb2JqICAgJHdpZGdldCAgalF1ZXJ5IHNlbGVjdG9yIG9mIHRoZSB3aWRnZXQgZWxlbWVudFxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy53aWRnZXRfZmluaXNoZWQgPSBmdW5jdGlvbiggJHdpZGdldCApIHtcblxuXHRcdFx0aWYgKCB0aGlzLmlzX2xvYWRpbmdfZmluaXNoZWQoKSApIHtcblx0XHRcdFx0dGhpcy5kcmF3X2NoYXJ0KCk7XG5cdFx0XHR9XG5cblx0XHR9O1xuXG5cdFx0Ly8gZ29cblx0XHR0aGlzLmluaXQoKTtcblxuXHRcdC8vIHJldHVyblxuXHRcdHJldHVybiB0aGlzO1xuXG5cdH07XG5cblx0d2luZG93LmxsbXMuYW5hbHl0aWNzID0gbmV3IEFuYWx5dGljcygpO1xuXG59ICkoIGpRdWVyeSApO1xuIl19
