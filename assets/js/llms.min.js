var LLMS=window.LLMS||{};!function(e){"use strict";LLMS.Ajax={url:window.ajaxurl||window.llms.ajaxurl,type:"post",data:[],cache:!1,dataType:"json",async:!0,response:[],init:function(e){if(null===e||"object"!=typeof e)return!1;e.url=this.url,e.type="type"in e?e.type:this.type,e.data="data"in e?e.data:this.data,e.cache="cache"in e?e.cache:this.cache,e.dataType="dataType"in e?e.dataType:this.dataType,e.async="async"in e?e.async:this.async,e.data._ajax_nonce=wp_ajax_data.nonce;var s=LLMS.Rest,t=s.get_query_vars();return e.data.post_id="post"in t?t.post:null,e},call:function(e){var s=this.init(e);return s?(this.request(s),this):!1},request:function(s){return e.ajax(s),this}},LLMS.MB_Course_Outline={init:function(){e("#llms_post_edit_type").length&&"course"===e("#llms_post_edit_type").val()&&this.bind()},alreadySubmitted:!1,bind:function(){function s(){e("#llms-outline-add").removeClass("clicked"),e("#llms-outline-add").addClass("bt"),e("#llms-outline-menu").removeClass("fade-in"),e("#triangle").show()}var t=this;e(".llms-modal-cancel").click(function(s){s.preventDefault(),e(window).trigger("build")}),e(document).ready(function(){e(".llms-chosen-select").chosen({width:"100%"})}),e(".tab-link").on("click",function(){e("#content_ifr").css("height","300px"),e("#excerpt_ifr").css("height","300px")}),e("#_has_prerequisite").attr("checked")?(e(".llms-prereq-top").addClass("top"),e(".llms-prereq-bottom").show()):e(".llms-prereq-bottom").hide(),e("#_has_prerequisite").change(function(){e("#_has_prerequisite").attr("checked")?(e(".llms-prereq-top").addClass("top"),e(".llms-prereq-bottom").show()):(e(".llms-prereq-top").removeClass("top"),e(".llms-prereq-bottom").hide())}),e("a.llms-modal").click(function(){e("#"+e(this).attr("data-modal_id")).topModal({title:e(this).attr("data-modal_title"),closed:function(){t.alreadySubmitted=!1}})}),e("a.llms-modal-new-lesson-link").click(function(){e("#"+e(this).attr("data-modal_id")).topModal({title:e(this).attr("data-modal_title"),open:function(){t.getSections(),e("#llms_create_lesson").find('input[value="Create Lesson"]').removeProp("disabled")},closed:function(){t.alreadySubmitted=!1}})}),e("a.llms-modal-existing-lesson-link").click(function(){e("#"+e(this).attr("data-modal_id")).topModal({title:e(this).attr("data-modal_title"),open:function(){t.getSections(),t.getLessons()},closed:function(){t.alreadySubmitted=!1}})}),this.setup_course(),e(window).click(function(t){"llms-outline-add"!==t.target.id&&e("#llms-outline-add").hasClass("clicked")&&(e("#llms-outline-menu").css("display","none"),s())}),e(window).scroll(function(){if(e("#llms-outline-add").hasClass("clicked")){e("#triangle").hide();var s=e("#llms-outline-menu"),t=-e("#llms-outline-add").offset().top-81+e(window).scrollTop()+e(window).height()/2;s.css("top",t)}}),e("#llms-outline-add").click(function(s){s.preventDefault(),console.log("button clicked");var t=e("#llms-outline-menu");if(e(this).hasClass("bt")){if(e(this).offset().top-e(window).scrollTop()<200)t.css("top","43px"),e(window).width()<851&&(t.find("#triangle").css("left","164px"),t.css("top","57px"),t.css("left","-138px"),t.css("bottom","15px"));else if(t.css("top",""),e(window).width()<851){t.css("top","-54px");var o=e(window).width()<400?-Math.abs(e(window).width()/2):-242;o+="px",t.css("left",o),t.css("bottom","15px"),t.find("#triangle").css("left","227px")}e(this).removeClass("bt"),e(this).addClass("clicked"),t.addClass("fade-in"),t.css("display","block")}else e(this).removeClass("clicked"),e(this).addClass("bt"),t.removeClass("fade-in"),t.css("display","none"),t.find("#triangle").show()}),e("#tooltip_menu a").click(function(s){var t=e("#llms-outline-menu");t.removeClass("fade-in"),t.css("display","none"),s.preventDefault()}),e("a.tooltip").click(function(e){e.preventDefault()}),e(".llms-lesson-tree").sortable({connectWith:".llms-lesson-tree",axis:"y",placeholder:"placeholder",cursor:"move",forcePlaceholderSize:!0,stop:function(){t.resortLessons()}}).disableSelection(),t.addSectionRowFunctionality(),t.addLessonRowFunctionality(),e("#llms_create_section").on("submit",function(s){console.log("section form submitted"),s.preventDefault();var o={};e.each(e(this).serializeArray(),function(e,s){o[s.name]=s.value}),t.alreadySubmitted===!1&&(console.log("alreadySubmitted is false"),t.alreadySubmitted=!0,t.createSection(o))}),e("#llms_create_lesson").on("submit",function(s){console.log("form submitted"),s.preventDefault();var o={};e.each(e(this).serializeArray(),function(e,s){o[s.name]=s.value}),t.alreadySubmitted===!1&&(t.alreadySubmitted=!0,t.createLesson(o))}),e("#llms_add_existing_lesson").on("submit",function(s){console.log("form submitted"),s.preventDefault();var o={};e.each(e(this).serializeArray(),function(e,s){o[s.name]=s.value}),t.alreadySubmitted===!1&&(t.alreadySubmitted=!0,t.addExistingLesson(o))}),e("#llms_edit_lesson").on("submit",function(s){console.log("form submitted"),s.preventDefault();var o={};e.each(e(this).serializeArray(),function(e,s){o[s.name]=s.value}),t.updateLesson(o)}),e("#llms_edit_section").on("submit",function(s){console.log("form submitted"),s.preventDefault();var o={};e.each(e(this).serializeArray(),function(e,s){o[s.name]=s.value}),t.updateSection(o)}),e("#llms_delete_section").on("submit",function(s){console.log("form submitted"),s.preventDefault();var o={};e.each(e(this).serializeArray(),function(e,s){o[s.name]=s.value}),t.deleteSection(o)})},resortSections:function(){var s={};e(".llms-section").each(function(t){t++,e(this).find('[name="llms_section_order[]"]').val(t),e(this).find(".llms-section-order").html(t);var o=e(this).find('[name="llms_section_id[]"]').val();s[o]=t}),LLMS.MB_Course_Outline.updateSectionOrder(s)},updateSectionOrder:function(e){console.log(e),LLMS.Ajax.call({data:{action:"update_section_order",sections:e},beforeSend:function(){console.log("hell ya! i just did a before send")},success:function(e){console.log(e),e.success===!0&&console.log("WOOOOOO total success!!!!!")}})},updateLessonOrder:function(e){console.log(e),LLMS.Ajax.call({data:{action:"update_lesson_order",lessons:e},beforeSend:function(){console.log("hell ya! i just did a before send")},success:function(e){console.log(e),e.success===!0&&console.log("udpate lesson success!")}})},resortLessons:function(){var s={};e(".llms-lesson-tree").each(function(){e(this).find(".llms-lesson").each(function(t){t++;var o=e(this).parent().parent().find('[name="llms_section_id[]"]').val();e(this).find('[name="llms_lesson_parent_section[]"]').val(o),e(this).find('[name="llms_lesson_order[]"]').val(t),e(this).find(".llms-lesson-order").html(t),console.log(o);var l=e(this).find('[name="llms_lesson_id[]"]').val();s[l]={parent_section:o,order:t}})}),LLMS.MB_Course_Outline.updateLessonOrder(s)},createSection:function(s){console.log(s.llms_section_name),console.log("about to do an ajax call"),LLMS.Ajax.call({data:{action:"create_section",title:s.llms_section_name},beforeSend:function(){console.log("hell ya! i just did a before send")},success:function(s){console.log(s),s.success===!0&&(console.log("WOOOOOO total success!!!!!"),e("#llms_course_outline_sort").append(s.data),e(window).trigger("build"),LLMS.MB_Course_Outline.addSectionRowFunctionality(),e("#llms_create_section").each(function(){this.reset()}))}})},addSectionRowFunctionality:function(){e(".llms-lesson-tree").sortable({connectWith:".llms-lesson-tree",axis:"y",placeholder:"placeholder",cursor:"move",forcePlaceholderSize:!0,stop:function(){LLMS.MB_Course_Outline.resortLessons()}}).disableSelection(),e("#llms_course_outline_sort").sortable({connectWith:".sortablewrapper",axis:"y",placeholder:"placeholder",cursor:"move",forcePlaceholderSize:!0,stop:function(){LLMS.MB_Course_Outline.resortSections()}}).disableSelection(),e("a.llms-edit-section-link").click(function(){var s=e(this);e("#"+e(this).attr("data-modal_id")).topModal({title:e(this).attr("data-modal_title"),open:function(){var e=s.parent().parent().find('[name="llms_section_id[]"]').val();LLMS.MB_Course_Outline.getSection(e)}})}),e("a.llms-delete-section-link").click(function(){var s=e(this);e("#"+e(this).attr("data-modal_id")).topModal({title:e(this).attr("data-modal_title"),open:function(){var t=s.parent().parent().find('[name="llms_section_id[]"]').val();e("#llms-section-delete-id").val(t)}})})},addLessonRowFunctionality:function(){e("a.llms-edit-lesson-link").click(function(){var s=e(this);e("#"+e(this).attr("data-modal_id")).topModal({title:e(this).attr("data-modal_title"),open:function(){var e=s.parent().parent().parent().find('[name="llms_lesson_id[]"]').val();LLMS.MB_Course_Outline.getLesson(e)}})}),e(".llms-remove-lesson-link").on("click",function(s){console.log("remove link clicked"),s.preventDefault();var t=e(this).parent().parent().parent().find('[name="llms_lesson_id[]"]').val();LLMS.MB_Course_Outline.removeLesson(t)})},createLesson:function(s){console.log("about to do an ajax call"),LLMS.Ajax.call({data:{action:"create_lesson",title:s.llms_lesson_name,excerpt:s.llms_lesson_excerpt,section_id:s.llms_section},beforeSend:function(){console.log("hell ya! i just did a before send")},success:function(t){console.log(t),t.success===!0&&(console.log("WOOOOOO total success!!!!!"),e(".llms-section").each(function(){var o=e(this).find('[name="llms_section_id[]"]').val();console.log(o),o===s.llms_section&&(console.log("found one"),console.log(e(this)),console.log(e(this).find(".llms_lesson_tree")),e(this).find("#llms_section_tree_"+s.llms_section).append(t.data))}),e(window).trigger("build"),LLMS.MB_Course_Outline.addLessonRowFunctionality(),e("#llms_create_lesson").each(function(){this.reset()}))}})},addExistingLesson:function(s){console.log("about to do an ajax call"),LLMS.Ajax.call({data:{action:"add_lesson_to_course",lesson_id:s.llms_lesson,section_id:s.llms_section},beforeSend:function(){console.log("hell ya! i just did a before send")},success:function(t){console.log(t),t.success===!0&&(console.log("WOOOOOO total success!!!!!"),e(".llms-section").each(function(){var o=e(this).find('[name="llms_section_id[]"]').val();console.log(o),o===s.llms_section&&(console.log("found one"),console.log(e(this)),e(this).find("#llms_section_tree_"+s.llms_section).append(t.data))}),e(window).trigger("build"),LLMS.MB_Course_Outline.addLessonRowFunctionality(),e("#llms_add_existing_lesson").each(function(){this.reset()}))}})},getSections:function(){LLMS.Ajax.call({data:{action:"get_course_sections"},success:function(s){console.log("success came back"),console.log(s),s.success===!0&&(console.log("WOOOOOO total success!!!!!"),e("#llms-section-select").empty(),e.each(s.data,function(s,t){var o=e('<option value="'+t.ID+'">'+t.post_title+"</option>");e("#llms-section-select").append(o)}),e("#llms-section-select").trigger("chosen:updated"))}})},getSection:function(s){console.log(s),LLMS.Ajax.call({data:{action:"get_course_section",section_id:s},success:function(s){console.log("success came back"),console.log(s),s.success===!0&&(console.log("WOOOOOO section total success!!!!!"),e("#llms-section-edit-name").val(s.data.post.post_title),e("#llms-section-edit-id").val(s.data.id))}})},getLesson:function(s){console.log(s),LLMS.Ajax.call({data:{action:"get_course_lesson",lesson_id:s},success:function(s){console.log("success came back"),console.log(s),s.success===!0&&(console.log("WOOOOOO section total success!!!!!"),e("#llms-lesson-edit-name").val(s.data.post.post_title),e("#llms-lesson-edit-excerpt").val(s.data.post.post_excerpt),e("#llms-lesson-edit-id").val(s.data.id))}})},updateSection:function(s){LLMS.Ajax.call({data:{action:"update_course_section",section_id:s.llms_section_edit_id,title:s.llms_section_edit_name},success:function(t){console.log("success came back"),console.log(t),t.success===!0&&(console.log("WOOOOOO section total success!!!!!"),e(".llms-section").each(function(){var o=e(this).find('[name="llms_section_id[]"]').val();console.log(o),o===s.llms_section_edit_id&&(console.log("found one"),console.log(e(this)),console.log(e(this).find(".llms-section-title")),e(this).find(".llms-section-title").html(t.data.title))}),e(window).trigger("build"),e("#llms_edit_section").each(function(){this.reset()}))}})},updateLesson:function(s){LLMS.Ajax.call({data:{action:"update_course_lesson",lesson_id:s.llms_lesson_edit_id,title:s.llms_lesson_edit_name,excerpt:s.llms_lesson_edit_excerpt},success:function(t){console.log("success came back"),console.log(t),t.success===!0&&(console.log("WOOOOOO section total success!!!!!"),e(".llms-lesson").each(function(){var o=e(this).find('[name="llms_lesson_id[]"]').val();console.log(o),o===s.llms_lesson_edit_id&&(e(this).find(".llms-lesson-title").html(t.data.title.title),e(this).find(".llms-lesson-excerpt").html(t.data.excerpt.post_excerpt))}),e(window).trigger("build"),e("#llms_edit_lesson").each(function(){this.reset()}))}})},removeLesson:function(s){LLMS.Ajax.call({data:{action:"remove_course_lesson",lesson_id:s},success:function(t){console.log("success came back"),console.log(t),t.success===!0&&(console.log("WOOOOOO section total success!!!!!"),e(".llms-lesson").each(function(){var t=e(this).find('[name="llms_lesson_id[]"]').val();console.log(t),t===s&&(e(this).remove(),LLMS.MB_Course_Outline.resortLessons())}))}})},deleteSection:function(s){LLMS.Ajax.call({data:{action:"delete_course_section",section_id:s.llms_section_delete_id},success:function(t){console.log("success came back"),console.log(t),t.success===!0&&(console.log("WOOOOOO section total success!!!!!"),e(".llms-section").each(function(){var t=e(this).find('[name="llms_section_id[]"]').val();console.log(t),t===s.llms_section_delete_id&&(e(this).remove(),LLMS.MB_Course_Outline.resortSections())}),e(window).trigger("build"))}})},getLessons:function(){LLMS.Ajax.call({data:{action:"get_lesson_options_for_select"},success:function(s){console.log("success came back"),console.log(s),s.success===!0&&(e("#llms-lesson-select").empty(),e.each(s.data,function(s,t){var o=e('<option value="'+s+'">'+t+"</option>");e("#llms-lesson-select").append(o)}),e("#llms-lesson-select").trigger("chosen:updated"))}})},setup_course:function(){var s=LLMS.Rest,t=["post-new.php"],o="course",l=s.get_query_vars();s.is_path(t)&&l.post_type===o&&(e(document).ready(function(){e("#pop1").topModal({title:"Create New Course"})}),e("#llms-create-course-submit").click(function(s){e("#title").val(e("#llms-course-name").val()),e("#save-post").click(),s.preventDefault()}))}},LLMS.Quiz={init:function(){var e=LLMS.Rest,s=["llms_quiz"];e.is_path(s)&&this.bind()},bind:function(){var s=this;e("#llms-quiz-timer").hide(),e("#llms_start_quiz").click(function(){return s.start_quiz(),!1}),e(".view-summary").click(function(){var s=e(".accordion");s.hasClass("hidden")?(s.fadeIn(300),s.removeClass("hidden"),e(this).text("Hide Summary")):(s.fadeOut(300),s.addClass("hidden"),e(this).text("View Summary"))}),this.chart_quiz_grade()},chart_quiz_grade:function(){var s=e(".llms-animated-circle"),t=e(".llms-progress-circle-count"),o=e("#llms-grade-value").val(),l=430*o/100;s.css({"stroke-dashoffset":430-l}),t.html(Math.round(o)+"%")},start_quiz:function(){var s=e("#llms-quiz").val(),t=e("#llms-user").val(),o=new Ajax("post",{action:"start_quiz",quiz_id:s,user_id:t},!0);o.start_quiz(s,t)},answer_question:function(){if(e("input[name=llms_option_selected]:checked").length<=0)e("#llms-quiz-question-wrapper .llms-error").remove(),e("#llms-quiz-question-wrapper").prepend('<div class="llms-error">You must enter an answer to continue.</div>');else{var s=e("#llms-quiz").val(),t=e("#question-type").val(),o=e("#question-id").val(),l=e("input[name=llms_option_selected]:checked").val(),n=new Ajax("post",{action:"answer_question",quiz_id:s,question_type:t,question_id:o,answer:l},!0);n.answer_question(t,o,l)}},previous_question:function(){var s=e("#llms-quiz").val(),t=e("#question-id").val(),o=new Ajax("post",{action:"previous_question",quiz_id:s,question_id:t},!0);o.previous_question(s,t)},start_quiz_timer:function(){var s=e("#set-time").val();if(s){var t,o,l,n,i=(new Date).getTime()+60*s*1e3,a=60*s*1e3,c=document.getElementById("tiles"),r=this;setTimeout(function(){r.complete_quiz()},a),this.getCountdown(s,i,a,t,o,l,n,c),setInterval(function(){r.getCountdown(s,i,a,t,o,l,n,c)},1e3)}},getCountdown:function(s,t,o,l,n,i,a,c){var r=(new Date).getTime(),d=(t-r)/1e3;d>=0&&(o/2>1e3*d&&(e("#tiles").removeClass("color-full"),e("#tiles").addClass("color-half")),o/4>1e3*d&&(e("#tiles").removeClass("color-half"),e("#tiles").addClass("color-empty")),l=this.pad(parseInt(d/86400)),d%=86400,n=this.pad(parseInt(d/3600)),d%=3600,i=this.pad(parseInt(d/60)),a=this.pad(parseInt(d%60)),c.innerHTML="<span>"+n+":</span><span>"+i+":</span><span>"+a+"</span>")},pad:function(e){return(10>e?"0":"")+e},complete_quiz:function(){var s=e("#llms-quiz").val(),t=e("#question-type").val(),o=e("#question-id").val(),l=e("input[name=llms_option_selected]:checked").val(),n=new Ajax("post",{action:"complete_quiz",quiz_id:s,question_id:o,question_type:t,answer:l},!0);n.complete_quiz(s,o,t,l)}},LLMS.Review={init:function(){console.log("Initializing Review "),this.bind()},bind:function(){parent=this,e("#llms_review_submit_button").click(function(){""!==e("#review_title").val()&&""!==e("#review_text").val()?parent.SubmitReview():(""===e("#review_title").val()?e("#review_title_error").show("swing"):e("#review_title_error").hide("swing"),""===e("#review_text").val()?e("#review_text_error").show("swing"):e("#review_text_error").hide("swing"))}),e("#_llms_display_reviews").attr("checked")?(e(".llms-num-reviews-top").addClass("top"),e(".llms-num-reviews-bottom").show()):e(".llms-num-reviews-bottom").hide(),e("#_llms_display_reviews").change(function(){e("#_llms_display_reviews").attr("checked")?(e(".llms-num-reviews-top").addClass("top"),e(".llms-num-reviews-bottom").show()):(e(".llms-num-reviews-top").removeClass("top"),e(".llms-num-reviews-bottom").hide())}),console.log("Review Methods Bound")},SubmitReview:function(){jQuery.ajax({type:"post",dataType:"json",url:window.llms.ajaxurl,data:{action:"LLMSSubmitReview",review_title:e("#review_title").val(),review_text:e("#review_text").val(),pageID:e("#post_ID").val()},success:function(){console.log("Review success"),e("#review_box").hide("swing"),e("#thank_you_box").show("swing")},error:function(e,s,t){console.log(e),console.log(s),console.log(t)}})}},LLMS.Tabs={init:function(){this.bind()},bind:function(){e("ul.tabs li").click(function(){var s=e(this).attr("data-tab");e("ul.tabs li").removeClass("current"),e(".tab-content").removeClass("current"),e(this).addClass("current"),e("#"+s).addClass("current")})}},LLMS.Rest={init:function(){console.log("Initializing Rest Methods "),this.bind()},bind:function(){console.log("Rest Methods Bound")},is_path:function(e){for(var s=!1,t=window.location.href,o=0;o<e.length;o++)t.search(e[o])>0&&!s&&(s=!0);return s},get_query_vars:function(){for(var e,s=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<t.length;o++)e=t[o].split("="),s.push(e[0]),s[e[0]]=e[1];return s}},LLMS.init=function(){for(var e in LLMS)"object"==typeof LLMS[e]&&null!==LLMS[e]&&void 0!==LLMS[e].init&&"function"==typeof LLMS[e].init&&LLMS[e].init()},LLMS.init(e)}(jQuery);