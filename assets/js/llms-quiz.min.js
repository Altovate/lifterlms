!function(t){var e={$buttons:null,$container:null,$ui:null,attempt_key:null,current_question:0,total_questions:0,questions:{},validators:{},status:null,bind:function(){var e=this;t("#llms_start_quiz").on("click",function(t){t.preventDefault(),e.start_quiz()}),t(".llms-donut").each(function(){LLMS.Donut(t(this))}),t("#llms-quiz-attempt-select").on("change",function(){var e=t(this).val();e&&(window.location.href=e)}),t(window).on("beforeunload",function(){if(e.status)return LLMS.l10n.translate("Are you sure you wish to quit this quiz attempt?")}),t(window).on("unload",function(){e.status&&e.complete_quiz()}),t(document).on("llms-post-append-question",e.post_append_question),this.register_validator("content",this.validate),this.register_validator("choice",this.validate_choice),this.register_validator("picture_choice",this.validate_choice),this.register_validator("true_false",this.validate_choice)},add_error:function(e){var i=this;i.$container.find(".llms-error").remove();var s=t('<p class="llms-error">'+e+'<a href="#"><i class="fa fa-times-circle" aria-hidden="true"></i></a></p>');s.on("click","a",function(t){t.preventDefault(),s.fadeOut("200"),setTimeout(function(){s.remove()},210)}),i.$container.append(s)},answer_question:function(t){var e,i=this,s=this.$container.find(".llms-question-wrapper"),n=s.attr("data-type");return this.validators[n]?(e=this.validators[n](s),e&&!0===e.valid&&e.answer?void LLMS.Ajax.call({data:{action:"quiz_answer_question",answer:e.answer,attempt_key:i.attempt_key,question_id:s.attr("data-id"),question_type:s.attr("data-type")},beforeSend:function(){var e=t.hasClass("llms-button-quiz-complete")?"Grading Quiz...":"Loading Question...";i.toggle_loader("show",e),i.update_progress_bar("increment")},success:function(t){if(i.toggle_loader("hide"),t.data&&t.data.html)t.data.question_id&&i.questions["q-"+t.data.question_id]?i.load_question(i.questions["q-"+t.data.question_id]):i.load_question(t.data.html);else if(t.data&&t.data.redirect)i.redirect(t.data.redirect);else if(t.message)i.$container.append("<p>"+t.message+"</p>");else{var e=LLMS.l10n.translate("An unknown error occurred. Please try again.");i.$container.append("<p>"+e+"</p>")}}}):i.add_error(e.valid)):void console.log("No validator registered for question type "+n)},complete_quiz:function(){var t=this;LLMS.Ajax.call({data:{action:"quiz_end",attempt_key:t.attempt_key},beforeSend:function(){t.toggle_loader("show","Grading Quiz...")},success:function(e){if(t.toggle_loader("hide"),e.data&&e.data.redirect)t.redirect(e.data.redirect);else if(e.message)t.$container.append("<p>"+e.message+"</p>");else{var i=LLMS.l10n.translate("An unknown error occurred. Please try again.");t.$container.append("<p>"+i+"</p>")}}})},get_question_index:function(t){return Object.keys(this.questions).indexOf("q-"+t)},redirect:function(t){this.toggle_loader("show","Grading Quiz..."),this.status=null,window.location.href=t},previous_question:function(){var t=this;t.toggle_loader("show","Loading Question..."),t.update_progress_bar("decrement");var e=Object.keys(t.questions),i=e.indexOf("q-"+t.current_question),s=e[0];i>=1&&(s=e[i-1]),setTimeout(function(){t.toggle_loader("hide"),t.load_question(t.questions[s])},100)},register_validator:function(t,e){this.validators[t]=e},start_quiz:function(){var e=this;this.load_ui_elements(),this.$ui=t("#llms-quiz-ui"),this.$buttons=t("#llms-quiz-nav button"),this.$container=t("#llms-quiz-question-wrapper"),t("#llms-next-question, #llms-complete-quiz").on("click",function(i){i.preventDefault(),e.answer_question(t(this))}),t("#llms-prev-question").on("click",function(t){t.preventDefault(),e.previous_question()}),LLMS.Ajax.call({data:{action:"quiz_start",attempt_key:t("#llms-attempt-key").val(),lesson_id:t("#llms-lesson-id").val(),quiz_id:t("#llms-quiz-id").val()},beforeSend:function(){e.status=!0,t("#llms-quiz-wrapper, #quiz-start-button").remove(),t("html, body").stop().animate({scrollTop:0},500),e.toggle_loader("show","Loading Quiz...")},error:function(t,e,i){console.log(t,e,i)},success:function(t){if(e.toggle_loader("hide"),t.data&&t.data.html)t.data.time_limit&&e.start_quiz_timer(t.data.time_limit),e.attempt_key=t.data.attempt_key,e.total_questions=t.data.total,e.load_question(t.data.html);else if(t.message)e.$container.append("<p>"+t.message+"</p>");else{var i=LLMS.l10n.translate("An unknown error occurred. Please try again.");e.$container.append("<p>"+i+"</p>")}}})},start_quiz_timer:function(e){var i=t('<div class="llms-quiz-timer" id="llms-quiz-timer" />'),s=LLMS.l10n.translate("Time Remaining");i.append('<i class="fa fa-clock-o" aria-hidden="true"></i><span class="screen-reader-text">'+s+"</span>"),i.append('<div id="llms-tiles" class="llms-tiles"></div>'),t("#llms-quiz-header").append(i);var n,a,o,l,r=this,u=(new Date).getTime()+60*e*1e3,d=60*e*1e3,c=document.getElementById("llms-tiles");setTimeout(function(){r.complete_quiz()},d+1e3),this.getCountdown(e,u,d,n,a,o,l,c),setInterval(function(){r.getCountdown(e,u,d,n,a,o,l,c)},1e3)},trigger:function(e){var i=this;"answer_question"===e&&(this.get_question_index(i.current_question)===i.total_questions?t("#llms-complete-quiz").trigger("click"):t("#llms-next-question").trigger("click"))},load_question:function(e){var i=t(e),s=i.attr("data-id");this.questions["q-"+s]||(this.questions["q-"+s]=i),this.update_progress(s),this.current_question=s,t(document).trigger("llms-pre-append-question",i),this.$container.append(i),t(document).trigger("llms-post-append-question",i)},load_ui_elements:function(){var e=t('<div class="llms-quiz-ui" id="llms-quiz-ui" />'),i=t('<header class="llms-quiz-header" id="llms-quiz-header" />');$footer=t('<footer class="llms-quiz-nav" id="llms-quiz-nav" />'),$footer.append('<button class="button large llms-button-action" id="llms-next-question" name="llms_next_question" type="submit">'+LLMS.l10n.translate("Next Question")+"</button>"),$footer.append('<button class="button large llms-button-action llms-button-quiz-complete" id="llms-complete-quiz" name="llms_complete_quiz" type="submit" style="display:none;">'+LLMS.l10n.translate("Complete Quiz")+"</button>"),$footer.append('<button class="button llms-button-secondary" id="llms-prev-question" name="llms_prev_question" type="submit" style="display:none;">'+LLMS.l10n.translate("Prevous Question")+"</button>"),i.append('<div class="llms-progress"><div class="progress-bar-complete"></div></div>'),$footer.append('<div class="llms-quiz-counter" id="llms-quiz-counter"><span class="llms-current"></span><span class="llms-sep">/</span><span class="llms-total"></span></div>'),e.append(i).append('<div class="llms-quiz-question-wrapper" id="llms-quiz-question-wrapper" />').append($footer),t("#llms-quiz-wrapper").after(e)},post_append_question:function(e,i){var s=t(i);s.find("audio").length&&wp.mediaelement.initialize()},toggle_loader:function(t,e){"show"===t?(e=e||"Loading...",this.$buttons.attr("disabled","disabled"),this.$container.empty(),LLMS.Spinner.start(this.$container),this.$container.append('<div class="llms-quiz-loading">'+LLMS.l10n.translate(e)+"</div>")):(LLMS.Spinner.stop(this.$container),this.$buttons.removeAttr("disabled"),this.$container.find(".llms-quiz-loading").remove())},update_progress:function(e){var i=this.get_question_index(e);-1!==i&&(i++,t("#llms-quiz-counter .llms-current").text(i),1===i&&(t("#llms-quiz-counter .llms-total").text(this.total_questions),t("#llms-quiz-counter").show()),i>=2?t("#llms-prev-question").show():t("#llms-prev-question").hide(),i===this.total_questions?(t("#llms-next-question").hide(),t("#llms-complete-quiz").show()):(t("#llms-next-question").show(),t("#llms-complete-quiz").hide()))},update_progress_bar:function(t){var e=this.get_question_index(this.current_question);"increment"===t?e++:e--,progress=e/this.total_questions*100,this.$ui.find(".progress-bar-complete").css("width",progress+"%")},getCountdown:function(e,i,s,n,a,o,l,r){var u=(new Date).getTime(),d=(i-u)/1e3;d>=0&&(1e3*d<s/2&&t("#llms-quiz-timer").addClass("color-half"),1e3*d<s/4&&(t("#llms-quiz-timer").removeClass("color-half"),t("#llms-quiz-timer").addClass("color-empty")),n=this.pad(parseInt(d/86400)),d%=86400,a=this.pad(parseInt(d/3600)),d%=3600,o=this.pad(parseInt(d/60)),l=this.pad(parseInt(d%60)),r.innerHTML='<span class="hours">'+a+'</span>:<span class="minutes">'+o+'</span>:<span class="seconds">'+l+"</span>")},pad:function(t){return(t<10?"0":"")+t},validate:function(t){return{answer:[],valid:!0}},validate_choice:function(e){var i=window.llms.quizzes.validate(e),s=e.find("input:checked");return s.length?s.each(function(){i.answer.push(t(this).val())}):i.valid=LLMS.l10n.translate("You must select an answer to continue."),i}};e.bind(),window.llms=window.llms||{},window.llms.quizzes=e}(jQuery);