function wait(){var e=jQuery.Deferred();return setTimeout(function(){e.resolve()},2500),e.promise()}jQuery(document).ready(function($){var e={".chosen-select":{},".chosen-select-deselect":{allow_single_deselect:!0},".chosen-select-no-single":{disable_search_threshold:10},".chosen-select-no-results":{no_results_text:"Oops, nothing found!"},".chosen-select-width":{width:"95%"}};for(var t in e)$(t).chosen(e[t]);$("select").each(function(){reverse_selection(this)}),$(".section-select").click(function(){reverse_selection(this)}),$(".section-select").attr("disabled","disbaled"),$(".lesson-select").attr("disabled","disbaled"),$(".section-select").change(function(){}),$(".lesson-select").change(function(){update_syllabus()}),$("#addNewSection").click(function(e){return add_new_section(),!1}),$(".addNewLesson").click(function(e){return add_new_lesson(e),!1}),$(".deleteBtn").click(function(){return delete_this(this),!1}),$(".section-dismiss").click(function(){return delete_this(this),!1}),lessons_sortable(),load_ajax_animation(),sections_sortable(),order_lessons()}),reverse_selection=function(e){jQuery(e).data("last_selected",jQuery(e).val())},catch_blanks=function(){jQuery(".section-select").each(function(){null==jQuery(this).val()||""==jQuery(this).val()?alert("Unable to save. Please make sure all of your sections are assigned."):(console.log("catch_blanks update called"),update_syllabus())})},catch_duplicates=function(e){console.log("catch_duplicates update called");var t=jQuery(this),s=[],a=jQuery(e).val(),n=jQuery(e).data("last_selected");jQuery(".section-select").each(function(){return a==jQuery(this).val()&&s.push(jQuery(this).val()),s.length>1?(alert("You cannot select a section already assigned to this course."),jQuery(e).val(n).attr("selected",!0),!1):void 0});var o=wait();o.done(update_syllabus);var i=jQuery(e).parent().parent().attr("id");get_associated_lessons(a,i)},lessons_sortable=function(){jQuery(".dad-list").sortable({items:".list_item",axis:"y",placeholder:"placeholder",cursor:"move",forcePlaceholderSize:!0,helper:function(e,t){var s=t.children(),a=t.clone();return a.children().each(function(e){jQuery(this).width(s.eq(e).width())}),a},start:function(e,t){var s=t.item.index();t.item.data("start_pos",s)},update:function(e,t){var s=t.item.data("start_pos"),a=jQuery(t.item).index();jQuery(t.item).attr("data-order",a),order_lessons(),update_syllabus()}})},order_lessons=function(){jQuery(".course-section").each(function(e){jQuery(this).find(".list_item").each(function(e){jQuery(this).attr("data-order",e+1)})})},sections_sortable=function(){jQuery("#syllabus").sortable({items:".course-section",axis:"y",placeholder:"sortable-placeholder section-placeholder",cursor:"move",start:function(e,t){var s=t.item.index();t.item.data("start_pos",s)},update:function(e,t){var s=t.item.data("start_pos"),a=jQuery(t.item).index();jQuery(t.item).attr("data-order",a),jQuery(".course-section").each(function(e){jQuery(this).attr("id",e+1),jQuery(this).find("label").text("Section "+(e+1)+":"),jQuery(this).find("a.add-lesson").attr("data-section",e+1)}),update_syllabus()}})},get_sections=function(){var e=[],t=0;return jQuery("#syllabus .section-select").each(function(){t++;var s={},a=jQuery(this).val();s.section_id=jQuery(this).val(),s.position=t;var n=jQuery(this).parent().parent().attr("id");jQuery("#"+n).find("a").attr("data-section_id",a),jQuery("#"+n).find("tr").attr("data-section_id",a),s.lessons=parse_lessons(a),e.push(s)}),e},parse_lessons=function(e){var e=e,t=[];return jQuery(".course-section tbody select").each(function(){var s=jQuery(this).parent().parent().parent().parent().parent().attr("id"),a=jQuery("#"+s+" .list_item").length+1,n={};n.lesson_id=jQuery(this).val();var o=jQuery(this).parent().parent().attr("data-order");o=o.substr(o.lastIndexOf("_")+1),n.position=o,jQuery(this).parent().parent().attr("data-section_id")==e&&t.push(n)}),t},update_syllabus=function(){console.log("update syllabus called");var e=get_sections(),t={action:"update_syllabus",post_id:jQuery("#syllabus").data("post_id"),sections:e},s=new Ajax("post",t,!1);s.update_syllabus()},get_associated_lessons=function(e,t){console.log("get_associated_lessons called");var s=new Ajax("post",{action:"get_associated_lessons",section_id:e,section_position:t},!0);s.get_associated_lessons(e,t)},add_associated_lessons=function(e,t,s){console.log("add_associated_lessons triggered"),console.log(e),console.log(t),console.log(s),associated_lesson_template(e,t,s)},get_lessons=function(e,t){var s=new Ajax("post",{action:"get_lessons"},!0);s.get_lessons(e,t)},add_new_lesson=function(e){var t=jQuery(e.target).attr("data-section_id");if(void 0===typeof jQuery(e.target).attr("data-section"))var s=1;else var s=jQuery(e.target).attr("data-section");get_lessons(t,s)},lesson_template=function(e,t,s){var a=jQuery("#"+s+" .list_item").length+1,n="list_item_"+a,o="row_"+a,i=jQuery("#"+s+" .dad-list").length;jQuery('<tr class="list_item" id="'+o+'" data-section_id="'+t+'" data-order="'+a+'"> 		<td><select data-type="lesson" id="'+n+'" data-placeholder="Choose a Section" class="chosen-select lesson-select" 		></select></td><td><i class="fa fa-bars llms-fa-move-lesson"></i><i data-code="f153" class="dashicons dashicons-dismiss deleteBtn"></i></td></tr>').appendTo("#"+s+" .dad-list tbody").hide().fadeIn(300),jQuery(r).change(function(){update_syllabus(jQuery(r).val())}),jQuery("#"+s+" .dad-list tbody .lesson-select").change(function(){get_edit_link(jQuery(this)),update_syllabus(),jQuery(this).attr("disabled","disbaled")}),jQuery(".deleteBtn").click(function(){var e=jQuery(this).attr("class");jQuery(this).parent().parent().remove(),update_syllabus()});for(var l in e)if(e.hasOwnProperty(l)){var r=jQuery("#"+s+" #"+n),c='<option value="'+e[l].ID+'">'+e[l].post_title+"</option>";jQuery(r).append(c)}jQuery(r).prepend('<option value="" selected disabled>Please select a lesson...</option>')},get_edit_link=function(e){console.log("get edit link called"),console.log(e);var t=jQuery(e).val(),s=jQuery(e).attr("id");console.log("element_id"),console.log(s);var a=jQuery(e).attr("data-type");console.log(t);var n=new Ajax("post",{action:"get_lesson",lesson_id:t},!0);n.get_lesson(t,s,a)},add_edit_link=function(e,t,s,a){console.log("add_edit_link called"),console.log(t),console.log(e),console.log(s),console.log("type"),console.log(a);var n=document.createElement("a");n.setAttribute("href",encodeURI(e.edit_url));var o=document.createElement("i");o.setAttribute("class","fa fa-pencil-square-o llms-fa-edit-lesson"),n.appendChild(o),"lesson"==a&&jQuery("#"+s).parent().next().append(n),"section"==a&&(console.log("trying to append the emelemnt"),jQuery("#"+s).parent().append(n))},associated_lesson_template=function(e,t,s){for(var a in e){var n=jQuery("#"+s+" .list_item").length+1,o="list_item_"+n,i="row_"+n,l=jQuery("#"+s+" .dad-list").length;if(jQuery('<tr class="list_item" id="'+i+'" data-section_id="'+t+'" data-order="'+n+'"> 			<td><select id="'+o+'" data-placeholder="Choose a Section" class="chosen-select lesson-select" disabled="disabled" 			></select></td><td><a href="'+e[a].edit_url+'"><i class="fa fa-pencil-square-o llms-fa-edit-lesson"></i></a> 			<i class="fa fa-bars llms-fa-move-lesson"></i><i data-code="f153" class="dashicons dashicons-dismiss deleteBtn"></i></td></tr>').appendTo("#"+s+" .dad-list tbody").hide().fadeIn(300),jQuery(r).change(function(){update_syllabus(jQuery(r).val())}),jQuery("#"+s+" .dad-list tbody .lesson-select").change(function(){update_syllabus(),jQuery(this).attr("disabled","disbaled")}),jQuery(".deleteBtn").click(function(){var e=jQuery(this).attr("class");jQuery(this).parent().parent().remove(),update_syllabus()}),e.hasOwnProperty(a)){var r=jQuery("#"+s+" #"+o),c='<option selected value="'+e[a].ID+'">'+e[a].post_title+"</option>";jQuery(r).append(c)}}},delete_this=function(e){jQuery(e).parent().parent().remove(),jQuery(".course-section").each(function(e){jQuery(this).attr("id",e+1),jQuery(this).find("label").text("Section "+(e+1)+":"),jQuery(this).find("a.add-lesson").attr("data-section",e+1)}),update_syllabus()},function($){add_new_section=function(){var e=new Ajax("post",{action:"get_sections"},!1);e.get_sections()},section_template=function(e){var t=e,s=$(".course-section").length+1,a="section_"+s,n=document.createElement("div");n.setAttribute("class","course-section"),n.setAttribute("id",s);var o=document.createElement("p");o.setAttribute("class","title");var i=document.createElement("label");i.setAttribute("class","order"),$(i).text("Section "+s+":");var l=document.createElement("select");l.setAttribute("class","chosen-select chosen select section-select"),l.setAttribute("data-placeholder","Select a Section"),l.setAttribute("data-type","section"),l.setAttribute("id","section_item_"+s),$(l).click(function(){reverse_selection($(l))}),$(l).change(function(){get_edit_link(jQuery(this)),catch_duplicates($(l)),$(this).attr("disabled","disbaled")}),$(l).attr("selectedIndex",-1);var r=document.createElement("i");r.setAttribute("data-code","f153"),r.setAttribute("class","dashicons dashicons-dismiss section-dismiss"),$(r).click(function(){delete_this($(l))});var c=document.createElement("i");c.setAttribute("class","fa fa-bars llms-fa-move-lesson");var d=document.createElement("a");d.setAttribute("class","button button-primary add-lesson"),$("#"+a).data("section",{ID:s}),$(d).attr("data-section",s),$(d).text("Add Lesson"),$(d).on("click",function(e){add_new_lesson(e)});var u='<table class="wp-list-table widefat fixed posts dad-list"> 		<thead><tr><th>Name</th><th></th></tr></thead> 		<tfoot><tr><th>Name</th><th></th></tr> 		</tfoot><tbody></tbody></table>';$(l).append('<option value="" selected disabled>Please select a section...</option>');for(var p in t)if(t.hasOwnProperty(p)){var _=$("<option />").val(t[p].ID).text(t[p].post_title);$(l).append(_)}o.appendChild(i),o.appendChild(l),o.appendChild(r),o.appendChild(c),n.appendChild(o),$(n).append(u),$(n).append(d),$("#syllabus").hide().append(n).fadeIn(1e3),$(l).trigger("chosen:updated"),lessons_sortable()}}(jQuery);