!function(e){var t=function(){var t=[],s=[];return this.$checkout_form=e("#llms-product-purchase-form"),this.$checkout_sections=this.$checkout_form.find(".llms-checkout-section"),this.init=function(){this.$checkout_form.length&&(this.$checkout_form.on("submit",this,this.submit),e(".llms-password-strength-meter").length&&this.add_before_submit_event({data:LLMS.PasswordStrength,handler:LLMS.PasswordStrength.checkout}),this.bind_login(),this.bind_coupon(),this.bind_gateways())},this.add_before_submit_event=function(e){e.handler&&"function"==typeof e.handler&&(e.data||(e.data=null),t.push(e))},this.add_error=function(t,s){var l="llms-checkout-errors";$err=e("#"+l),$err.length||($err=e('<ul class="llms-notice llms-error" id="'+l+'" />'),e(".llms-checkout-wrapper").prepend($err)),$err.append("<li>"+errors[i]+"</li>")},this.clear_errors=function(){e("#llms-checkout-errors").remove()},this.focus_errors=function(){e("html, body").animate({scrollTop:e("#llms-checkout-errors").offset().top-50},200)},this.add_gateway=function(e){s.push(e)},this.bind_coupon=function(){var t=this;e('a[href="#llms-coupon-toggle"]').on("click",function(t){t.preventDefault(),e(".llms-coupon-entry").slideToggle(400)}),e("#llms-apply-coupon").on("click",function(s){s.preventDefault(),t.coupon_apply(e(this))}),e("#llms-remove-coupon").on("click",function(s){s.preventDefault(),t.coupon_remove(e(this))})},this.bind_gateways=function(){this.load_gateways(),e('input[name="llms_payment_gateway"]').length||e("#llms_create_pending_order").removeAttr("disabled"),e('input[name="llms_payment_gateway"]').on("change",function(){e('input[name="llms_payment_gateway"]').each(function(){var t=e(this),s=t.closest(".llms-payment-gateway"),l=s.find(".llms-gateway-fields").find("input, textarea, select"),n=t.is(":checked"),o=n?"addClass":"removeClass";s[o]("is-selected"),n?(l.removeAttr("disabled"),e(".llms-payment-gateways").trigger("llms-gateway-selected",{id:t.val(),$selector:s})):l.attr("disabled","disabled")})}),e(".llms-payment-gateways").on("llms-gateway-selected",function(t,s){var l=e("#llms_create_pending_order");s.$selector&&s.$selector.find(".llms-gateway-fields .invalid").length?l.attr("disabled","disabled"):l.removeAttr("disabled")})},this.bind_login=function(){e('a[href="#llms-show-login"]').on("click",function(t){t.preventDefault(),e(this).closest(".llms-info").slideUp(400),e("form.llms-login").slideDown(400)})},this.coupon_apply=function(t){var s=this,l=e("#llms_coupon_code"),n=l.val(),o=e(".llms-coupon-messages"),a=o.find(".llms-error"),r=e("form.llms-checkout");LLMS.Spinner.start(r),window.LLMS.Ajax.call({data:{action:"validate_coupon_code",code:n,plan_id:e("#llms-plan-id").val()},beforeSend:function(){a.hide()},success:function(t){if(LLMS.Spinner.stop(r),"error"===t.code){var l=e("<li>"+t.message+"</li>");a.length?a.empty():(a=e('<ul class="llms-notice llms-error" />'),o.append(a)),l.appendTo(a),a.show()}else t.success&&(e(".llms-coupon-wrapper").replaceWith(t.data.coupon_html),s.bind_coupon(),e(".llms-payment-gateways").replaceWith(t.data.gateways_html),s.bind_gateways(),e(".llms-order-summary").replaceWith(t.data.summary_html))}})},this.coupon_remove=function(t){var s=this,l=e("form.llms-checkout");LLMS.Spinner.start(l),window.LLMS.Ajax.call({data:{action:"remove_coupon_code",plan_id:e("#llms-plan-id").val()},success:function(t){LLMS.Spinner.stop(l),t.success&&(e(".llms-coupon-wrapper").replaceWith(t.data.coupon_html),s.bind_coupon(),e(".llms-order-summary").replaceWith(t.data.summary_html),e(".llms-payment-gateways").replaceWith(t.data.gateways_html),s.bind_gateways())}})},this.load_gateways=function(){for(var e=0;e<=s.length;e++){var t=s[e];"object"==typeof t&&null!==t&&void 0!==t.bind&&"function"==typeof t.bind&&t.bind()}},this.processing=function(e){var t;switch(e){case"stop":t="removeClass";break;case"start":default:t="addClass"}this.$checkout_form[t]("llms-is-processing"),LLMS.Spinner[e](this.$checkout_sections)},this.submit=function(e){var s,l=e.data,n=t.length,o=0,a=6e4,r=[],i=0,c=0;e.preventDefault(),l.processing("start"),l.clear_errors();for(var d=0;d<t.length;d++){var m=t[d];m.handler(m.data,function(e){i++,!0===e?c++:"string"==typeof e&&r.push(e)})}s=setInterval(function(){var e=!1,t=!1;if(o>=a)e=!0,t=!0;else if(n===i)if(n===c)e=!0,l.$checkout_form.off("submit",l.submit),l.$checkout_form.trigger("submit");else if(r.length){e=!0,t=!0;for(var d=0;d<r.length;d++)l.add_error(r[d]);l.focus_errors()}e&&clearInterval(s),t&&l.processing("stop"),o++},100)},this.init(),this};window.llms=window.llms||{},window.llms.checkout=new t}(jQuery);